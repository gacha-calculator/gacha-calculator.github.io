import{c as G,C as Y,D as j,a as V,r as J,b as $,u as K,g as Q,d as X,e as Z,f as tt,i as et,h as at,j as T,k as nt,l as st,m as L,n as N,s as O,o as ot}from"./solvers-gGrm_kck.js";/* empty css               */import{c as rt,W as it,g as lt}from"./cashback-helpers-BxOf6jdA.js";import{c as ct}from"./cashback-B-BcIKHX.js";const k=[.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.066,.126,.186,.246,.306,.366,.426,.486,.546,.606,.666,.726,.786,.846,.906,.966,1],A=[.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.077,.147,.217,.287,.357,.427,.497,.567,.637,.707,.777,.847,.917,.987,1],x=[.051,.051,.051,.051,.051,.051,.051,.051,.561,1],y={maxCharacterConstelation:6,rateUpCharacterSR:3,rateUpWeaponSR:5,poolStandardCharSSR:8,poolCharSR:44,configSR:{maxType:7,regularPoints:.4,specialPoints:1},configSSR:{maxType:7,regularPoints:2,specialPoints:5},configWep:{pointsSR:.4,pointsSSR:2},paths:{char:["None","c0","c1","c2","c3","c4","c5","c6"],wep:["None","r1","r2","r3","r4","r5"]},pity:{pitySSRChar:k.length,pitySSRWep:A.length,pitySRChar:x.length,pitySRWep:x.length},default:0},pt=[{value:"unknown",text:"Unknown"},{value:"none",text:"Not Owned"},{value:"c0",text:"C0"},{value:"c1",text:"C1"},{value:"c2",text:"C2"},{value:"c3",text:"C3"},{value:"c4",text:"C4"},{value:"c5",text:"C5"},{value:"c6",text:"C6"},{value:"new",text:"New Character"}],R={none:0,c0:1,c1:2,c2:3,c3:4,c4:5,c5:6,c6:7},H=new Set(["dehya","diluc","jean","keqing","mona","qiqi","tighnari","yumemizuki_mizuki"]),U=new Set(["aino","barbara","beidou","bennett","candace","charlotte","chevreuse","chongyun","collei","dahlia","diona","dori","faruzan","fischl","freminet","gaming","gorou","iansan","ifa","kachina","kaveh","kirara","kujou_sara","kuki_shinobu","lan_yan","layla","lynette","mika","ningguang","noelle","ororon","razor","rosaria","sayu","sethos","shikanoin_heizou","sucrose","thoma","xiangling","xingqiu","xinyan","yanfei","yaoyao","yun_jin"]),ut=new Set(["amos_bow","aquila_favonia","lost_prayer_to_the_sacred_winds","primordial_jade_winged-spear","skyward_atlas","skyward_blade","skyward_harp","skyward_pride","skyward_spine","wolfs_gravestone"]),ht=new Set(["dragons_bane","eye_of_perception","favonius_codex","favonius_greatsword","favonius_lance","favonius_sword","favonius_warbow","lions_roar","rainslasher","rust","sacrificial_bow","sacrificial_fragments","sacrificial_greatsword","sacrificial_sword","the_bell","the_flute","the_stringless","the_widsith","akuoumaru","alley_hunter","flower-wreathed_feathers","fruitful_hook","lithic_blade","lithic_spear","makhaira_aquamarine","mitternachts_waltz","mountain-bracing_bolt","mouuns_moon","portable_power_saw","prospectors_drill","range_gauge","sturdy_bone","the_alley_flash","the_dockhands_assistant","wandering_evenstar","wavebreakers_fin","waveriding_whirl","wine_and_song","xiphos_moonlight"]),dt=new Set(["black_tassel","bloodtainted_greatsword","cool_steel","debate_club","emerald_orb","ferrous_shadow","harbinger_of_dawn","magic_guide","raven_bow","sharpshooters_oath","skyrider_sword","slingshot","thrilling_tales_of_dragon_slayers","white_tassel"]);function ft(t){if(!t||!t.characters||!t["wish-counter-character-event"])return console.error("Imported data is missing key Paimon.moe properties."),null;console.log("Paimon.moe data format detected. Running adapter...");const n=t["wish-counter-character-event"]?.pulls||[],i=t["wish-counter-weapon-event"]?.pulls||[],o=z(n,"character"),a=z(i,"weapon"),s=[{banner:"character",...o,caprad:"0",epPath:"0"},{banner:"weapon",...a,caprad:"0",epPath:"0"}],r=yt(t.characters);return{pity:s,constellation:r}}function z(t,n){let i=0,o=0,a=!1,s=!1,r=!1,e=!1;const c=l=>U.has(l)?{type:"character",rarity:4}:ht.has(l)?{type:"weapon",rarity:4}:dt.has(l)?{type:"weapon",rarity:3}:H.has(l)?{type:"character",rarity:5,standard:!0}:ut.has(l)?{type:"weapon",rarity:5,standard:!0}:{type:"unknown",rarity:5,standard:!1};for(let l=t.length-1;l>=0;l--){const p=t[l],u=c(p.id);u.rarity===5?r||(a=p.rate===0,r=!0):r||i++,u.rarity===4?e||(n==="character"&&(s=u.type==="weapon"),e=!0):e||o++}return{pity4:String(o),pity5:String(i),guarantee4:s,guarantee5:a}}function yt(t){const n=new Array(Object.keys(R).length).fill(0),i=new Array(Object.keys(R).length).fill(0);let o=0,a=0;for(const l in t){let p=0;if(U.has(l)?p=4:H.has(l)&&(p=5),p===0)continue;const u=t[l],d=(u.default||0)+(u.wish||0)+(u.manual||0);if(d>0){p===4?o++:p===5&&a++;const h=Math.min(d-1,6),f=R[`c${h}`];f!==void 0&&(p===4?n[f]++:p===5&&i[f]++)}}const s=y.poolCharSR,r=y.poolStandardCharSSR,e=s-o,c=r-a;return n[0]=Math.max(0,e),i[0]=Math.max(0,c),{0:i.map(String),1:n.map(String)}}const gt=`
    <div class="chibi-group">
        <div class="bubble-wrapper bubble-wrapper--big">
            <svg class="bubble-svg-background" viewBox="0 0 1820 858" xmlns="http://www.w3.org/2000/svg">
                <path style="fill:#232338; stroke:#0b091b; stroke-width: 1px"
                    d="M 787.500 1.005 C 640.632 4.659, 524.925 15.685, 414 36.596 C 305.731 57.006, 229.612 80.375, 165.037 113.026 C 88.008 151.975, 38.939 199.840, 15.519 258.874 C 8.496 276.575, 3.327 301.798, 0.941 330 C -2.027 365.084, 6.008 405.046, 22.959 439.500 C 43.249 480.744, 73.516 513.346, 120 544.028 C 209.228 602.924, 363.734 646.238, 553 665.416 C 650.260 675.270, 808.209 681.908, 948.500 682.035 C 999.011 682.081, 1061.358 683.505, 1068.623 684.778 C 1072.726 685.497, 1072.776 685.559, 1079.177 698 C 1096.318 731.313, 1116.859 760.237, 1136.746 779.061 C 1155.047 796.384, 1181.968 815.466, 1202.839 825.908 C 1232.446 840.721, 1273.797 852.517, 1310.770 856.698 C 1324.340 858.232, 1326.511 858.262, 1330.270 856.962 C 1332.596 856.158, 1334.500 855.138, 1334.500 854.696 C 1334.500 854.254, 1331.125 852.760, 1327 851.377 C 1314.484 847.179, 1287.809 833.665, 1277.295 826.195 C 1265.925 818.116, 1226.275 778.561, 1216.635 765.680 C 1206.358 751.947, 1188.566 715.606, 1185.906 702.916 C 1185.282 699.937, 1183.944 693.900, 1182.931 689.500 C 1181.919 685.100, 1180.809 679.883, 1180.464 677.906 L 1179.836 674.312 1189.168 673.673 C 1234.976 670.533, 1307.910 662.018, 1358.500 653.902 C 1387.862 649.192, 1405.290 645.828, 1437.500 638.654 C 1443.550 637.306, 1457.500 634.310, 1468.500 631.995 C 1491.435 627.169, 1506.239 623.528, 1520.500 619.205 C 1526 617.538, 1538.150 614.072, 1547.500 611.504 C 1604.081 595.961, 1658.813 573.047, 1691.807 551.088 C 1716.705 534.517, 1726.861 526.038, 1752.999 500 C 1782.013 471.097, 1799.115 442.990, 1810.458 405.568 C 1814.346 392.741, 1819 366.582, 1819 357.554 C 1819 354.499, 1819.450 352, 1820 352 C 1821.274 352, 1821.299 340.366, 1820.046 330.791 C 1819.521 326.781, 1818.582 319.225, 1817.959 314 C 1809.521 243.236, 1771.421 185.672, 1703 140.314 C 1640.860 99.120, 1548.917 64.910, 1443 43.576 C 1339.978 22.824, 1215.062 9.498, 1072 3.996 C 994.931 1.032, 848.352 -0.509, 787.500 1.005 M 776 4.600 C 771.325 4.777, 754 5.405, 737.500 5.995 C 561.542 12.295, 402.823 35.450, 277.947 73.040 C 210.624 93.305, 153.205 120.092, 109 151.857 C 80.401 172.408, 53.246 200.489, 37.044 226.269 C 19.796 253.711, 10.505 280.375, 6.026 315.288 C 1.913 347.340, 4.080 374.322, 13.106 403.467 C 26.641 447.170, 50.753 482.527, 90 516.224 C 101.716 526.283, 126.303 543.639, 138.425 550.406 C 140.926 551.802, 146.466 554.925, 150.736 557.345 C 194.368 582.071, 259.942 606.163, 334.540 624.875 C 473.407 659.708, 622.538 674.025, 888 678.008 C 1034.249 680.203, 1070.594 680.938, 1073.423 681.757 C 1075.031 682.222, 1076.681 683.255, 1077.088 684.051 C 1077.496 684.848, 1079.729 689.325, 1082.051 694 C 1091.185 712.393, 1108.924 740.328, 1121.008 755.350 C 1129.418 765.805, 1144.301 780.492, 1156.104 789.986 C 1170.999 801.967, 1195.222 817.726, 1208.500 824.072 C 1231.867 835.241, 1272.170 847.555, 1298 851.418 C 1323.491 855.230, 1327.055 855.493, 1319.528 853.009 C 1311.535 850.371, 1284.081 836.370, 1276.055 830.838 C 1260.944 820.423, 1225.667 785.179, 1211.929 766.772 C 1201.655 753.007, 1184.830 717.485, 1182.499 704.638 C 1181.787 700.712, 1180.261 693.675, 1179.109 689 C 1176.730 679.347, 1176.376 672.148, 1178.250 671.514 C 1178.938 671.282, 1190.300 670.164, 1203.500 669.029 C 1239.066 665.973, 1275.315 662.018, 1309.500 657.465 C 1360.426 650.682, 1388.027 645.725, 1449 632.411 C 1463.025 629.349, 1479.778 625.754, 1486.229 624.424 C 1492.681 623.093, 1501.906 620.694, 1506.729 619.093 C 1511.553 617.492, 1527.169 612.983, 1541.432 609.074 C 1573.458 600.295, 1586.835 595.827, 1618.030 583.493 C 1644.114 573.179, 1671.994 559.215, 1688.966 547.965 C 1703.153 538.560, 1722.730 523.374, 1729.500 516.522 C 1732.800 513.182, 1739.501 506.636, 1744.391 501.975 C 1758.521 488.506, 1771.430 473.645, 1779.115 462 C 1788.491 447.791, 1793.962 437.449, 1800.288 421.977 C 1815.087 385.778, 1819.761 344.986, 1813.433 307.269 C 1804.545 254.291, 1779.063 209.320, 1736.709 171.866 C 1691.153 131.580, 1625.043 98.185, 1538.202 71.592 C 1418.757 35.015, 1261.222 14.066, 1048 6.407 C 1008.502 4.988, 802.012 3.616, 776 4.600 M 0.355 344.500 C 0.352 349.450, 0.521 351.601, 0.731 349.280 C 0.940 346.959, 0.943 342.909, 0.736 340.280 C 0.530 337.651, 0.358 339.550, 0.355 344.500"
                </svg>
            <div class="bubble-text"> </div>
        <img src="/images/37_chibi.png" alt="Tutorial Assistant" class="tutorial-chibi">
        </div>
        <button class="btn btn--tutorial_next">>></button>
        <button class="btn btn--tutorial_end">x</button>
    </div>`,mt=[{text:"<p>Welcome to the Gacha Calculator! Let me show you around.</p>",size:"small"},{id:"pity-input-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#pity-panel"]',text:"<p>First, input your current pity count, guarantee status, Capturing Radiance, and Epitomized Path points here. You can import this data directly from paimon.moe. (Press the <strong>?</strong> near respective element for more details.)</p>",position:"right",size:"big"},{id:"pull-plan-step",element:".pull-plan-section",text:"<p>Next, build your pull plan here. Add all the characters and weapons in the order you want to get them.</p>",position:"left",chibiSide:"left"},{id:"target-step",element:".header-controls",text:"<p>Now, set your target. This can be your desired confidence level (e.g., a 70% chance of getting all planned items) or your total pull budget.</p>",position:"top",chibiSide:"left",size:"big"},{id:"calculate-button-step",element:"#calculate-btn",text:"<p>Once your plan and target are set, press <strong>Calculate</strong>.</p>",position:"right",size:"small"},{element:".chart-wrapper",text:"<p>You'll see a chart showing the probability of success for different numbers of pulls, all the way up to 100%. Use this to plan your strategy.</p>",position:"top"},{id:"constellation-input-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#constellation-panel"]',text:"<p>Input your owned character constellations for accurate cashback calculations. If you are only interested in character/weapon pull chances, you can skip this for now.</p>",position:"right",size:"big"},{id:"rate-ups-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#rateup-panel"]',text:"<p>If you know the rate-up 4-star characters, you can input their constellations on your account. This improves cashback accuracy and reduces unnecessary computation.</p>",position:"right",size:"big"},{element:"#probability-table",text:"<p>And down here, you can see a detailed table with cashback estimates, for the given amount of pulls, it's only accurate if you inputed your data correctly. Good luck with your pulls.</p>",position:"top"}],I={"pity-input-step":{tourStepId:"pity-input-step"},"constellation-input-step":{tourStepId:"constellation-input-step"},"pull-plan-step":{tourStepId:"pull-plan-step"},"calculate-button-step":{tourStepId:"calculate-button-step"},"import-help":{element:".tab-panel-card",text:'<p>You can import your pity data directly from <a href="https://paimon.moe/" target="_blank">paimon.moe</a>. Click the "Import Data" button and paste the exported JSON data.</p>',position:"right",size:"big"},"export-help":{element:".tab-panel-card",text:"<p>You can export your pity data as a JSON file to make a reserve copy or to carry over data when you are switching to a different browser/new device.</p>",position:"right",size:"big"},"pity-help":{element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#pity-panel"]',text:"<p>Input your current pity and guarantees here, as well as Capturing Radiance and Epitomized Path points. You can import data from paimon.moe directly(press ? near respective elements to learn more)</p>",position:"right",size:"big"},"constelation-help":{element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#constellation-panel"]',text:"<p>You can insert how many characters of every constellation level you have, it's necessary to provide accurate cashback prediction.</p>",position:"right",size:"big"},"rate-up-help":{element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#rateup-panel"]',text:"<p>If you know the 4*, you can then check what constellation it has on your account, entering these will help cashback accuracy and reduce unneeded computation.</p>",position:"right",size:"big"},"caprad-help":{element:".tab-panel-card",text:"<p>Capturing Radiance starts at 1 on your account, 50/50 loses raise it by 1, wins reduce it by 1 till 0, unless it was 3, then it goes back to 1. At 2 it increases rate up character odds, at 3 it's guaranteed. To count it pull history since 5.0 is required.</p>",position:"right",size:"big"},"eppath-help":{element:".tab-panel-card",text:"<p>Not getting selected weapon gives you 1 point, which guarantees it on the next 5* pull. Be careful, it does not carry over, you should only pull if you want both weapons or have good chances of getting 5* twice.</p>",position:"right",size:"big"},"pull-plan-help":{element:".pull-plan-section",text:"<p>Build your pull plan here. Add all the characters and weapons in order you want to get them.</p>",position:"left",chibiSide:"left"},"target-help":{element:".header-controls",text:"<p>Here you need to set your target, either the confidence level you want, for example 70% chance of getting all planned items, or your pull budget.</p>",position:"top",chibiSide:"left",size:"big"},"cashback-help":{element:"#probability-table",text:"<p>Expected cashback for each 5* target reached with their respective probabilities, percentiles give you a reasonable range by cutting off extreme results(10% from each side).</p>",size:"big",position:"top"}},B={CHARACTER:"character",WEAPON:"weapon"},v={PITY_ROW:"[data-banner]",CONSTELLATION_ROW:"[data-rarity]",PITY_TABLE:"#pity-table",CONSTELLATION_TABLE:"#constellation-table"},M={pitySettings:{[B.CHARACTER]:{pity4:0,pity5:0,caprad:1},[B.WEAPON]:{pity4:0,pity5:0,epPath:0}},isCharacter:!0,isWeapon:!0,isCapRad:!0,isEpitPath:!0,constellationColumns:8},W={probability:70,pulls:119};class bt{constructor(n){this.parts=n,this.persistence=G("genshin",v);const i=rt({cashbackCalculator:this.parts.cashbackFn,uiUpdater:this.parts.updateTableFn});this.tutorial=new Y(gt);const o={getPageConfiguration:tt,getLabels:Z,getPullPlan:X,getTarget:Q,updateChart:K,convertToChartData:$,recalcInputs:J,calculatorFunction:this.parts.runCalcFn,calculatorConfig:{gachaConfig:this.parts.gachaConfig,CONSTELLATION_MAP:this.parts.CONSTELLATION_MAP},pageConfig:{SELECTORS:v,INITIAL_CONFIG:M},postCalculationHooks:[i],persistence:this.persistence,chibi:this.tutorial};this.validator=new j(this.parts.CONSTELLATION_MAP),this.calculationHandler=new V(o),this.expandBtn=document.getElementById("expand-button"),this.expandedMenu=document.getElementById("expandedMenu"),this.calculateBtn=document.getElementById("calculate-btn"),this.exportBtn=document.getElementById("export-btn"),this.startTourBtn=document.getElementById("start-tour-btn"),this.toggleButtonsBtn=document.getElementById("toggle-buttons-btn")}initialize(){this.validator.initialize(),et(this.persistence,this.parts.gachaConfig,this.validator,M,pt,v),at(),T(),nt(this.persistence),this.#t(),this.#a()}#t(){let n=null;this.expandBtn&&this.expandBtn.addEventListener("click",()=>{this.expandBtn.classList.toggle("dropdown--open"),this.expandedMenu.classList.toggle("active")});const i=document.querySelectorAll(".nav-button");i.forEach(e=>{e.addEventListener("dragstart",function(c){n=this,setTimeout(()=>{this.classList.add("dragging")},0)}),e.addEventListener("dragend",function(){this.classList.remove("dragging"),n=null,i.forEach(c=>{c.classList.remove("drop-zone")})}),e.addEventListener("dragover",function(c){c.preventDefault(),n&&n!==this&&this.classList.add("drop-zone")}),e.addEventListener("dragleave",function(){this.classList.remove("drop-zone")}),e.addEventListener("drop",function(c){if(c.preventDefault(),this.classList.remove("drop-zone"),n&&n!==this){const l=n.parentNode,p=this.parentNode,u=document.createElement("div"),d=document.createElement("div");l.insertBefore(u,n),p.insertBefore(d,this),l.insertBefore(this,u),p.insertBefore(n,d),l.removeChild(u),p.removeChild(d),o()}})});function o(){const e=document.querySelector(".nav-list"),c=document.querySelector(".nav-container--expanded .nav-list"),l={main:Array.from(e.children).slice(0,-1).map(p=>p.querySelector(".nav-button").getAttribute("href")),expanded:Array.from(c.children).map(p=>p.querySelector(".nav-button").getAttribute("href"))};localStorage.setItem("navOrder",JSON.stringify(l))}function a(){const e=JSON.parse(localStorage.getItem("navOrder"));if(!e)return;const c=document.querySelector(".nav-list"),l=document.querySelector(".nav-container--expanded .nav-list"),p=c.lastElementChild,u=new Map;document.querySelectorAll("li").forEach(h=>{const f=h.querySelector(".nav-button");f&&u.set(f.getAttribute("href"),h)}),Array.from(c.children).slice(0,-1).forEach(h=>h.remove()),l.innerHTML="",e.main.forEach(h=>{const f=u.get(h);f&&c.insertBefore(f,p)}),e.expanded.forEach(h=>{const f=u.get(h);f&&l.appendChild(f)})}a();const s=document.querySelector(".nav-container");s.style.opacity="1",this.calculateBtn&&this.calculateBtn.addEventListener("click",async()=>{this.#e()&&await this.calculationHandler.runCalculation()}),this.exportBtn&&this.exportBtn.addEventListener("click",()=>st(this.persistence)),this.startTourBtn&&this.startTourBtn.addEventListener("click",()=>{this.tutorial.startTour(mt)}),T(this.persistence,ft,this.validator,v),document.querySelectorAll(".help-btn").forEach(e=>{e.addEventListener("click",c=>{c.preventDefault();const l=e.getAttribute("data-help-key")||e.getAttribute("data-tour-step-id");if(l&&I[l]){const p=I[l];this.tutorial.showHelp(p,e)}else console.warn(`ChibiTutorial: No help configuration found for key '${l}'.`,e)})}),this.toggleButtonsBtn&&this.toggleButtonsBtn.addEventListener("click",()=>{document.querySelectorAll(".help-btn").forEach(c=>{c.classList.toggle("hidden")}),this.persistence.saveButtons()})}#e(){if(document.querySelectorAll(".is-invalid").forEach(a=>a.classList.remove("is-invalid")),this.validator.isDataValid())return!0;console.warn("Validation failed. Calculation blocked."),this.validator.validateAll();const n=document.querySelectorAll(".is-invalid"),i=new Set;n.forEach(a=>{const s=a.closest(".tab-pane");if(s){const r=document.querySelector(`.tab-link[data-tab-target="#${s.id}"]`);r&&i.add(r)}a.classList.add("flicker"),a.addEventListener("animationend",()=>a.classList.remove("flicker"),{once:!0})}),i.forEach(a=>{a.classList.add("is-invalid","flicker"),a.addEventListener("animationend",()=>a.classList.remove("flicker"),{once:!0})});const o=Array.from(i)[0];return o&&o.click(),setTimeout(()=>{n[0]?.scrollIntoView({behavior:"smooth",block:"center"})},100),!1}#a(){const n=this.persistence.loadCalculation(),i=n?n.input:null;n?(L(this.parts.gachaConfig.paths,i),N(W,n),O(n.persistInput)):(L(this.parts.gachaConfig.paths),N(W),O()),this.calculationHandler.runCalculation()}}function St(t,n){let i=!0;const o=4;if(n)for(let a=0;a<t.length-1;a++){let s=!0;for(let r=0;r<o;r++){for(const e of t[a][r].states)e>0&&(s=!1,i=!1);t[a][r].isEmpty=s}t[a].isEmpty=s}else for(let a=0;a<t.length-1;a++){let s=!0;for(let r=0;r<o;r++){for(const e of t[a][r].states)e.size>0&&(s=!1,i=!1);t[a][r].isEmpty=s}t[a].isEmpty=s}return i}function Ct(t){const n=[];if(Array.isArray(t[0]))for(let a=0;a<t.length;a++){let s="None";a>0&&a<=t.length&&t[a-1]&&(s=t[a-1][0].type||"None");let r={offRates:new Map,type:s};for(let e=0;e<4;e++){const c=t[a][e].states;for(const l of c)l.size>0&&i(r.offRates,l)}n.push(r)}else for(let o=0;o<t.length;o++){const a=t[o].states;let s="None";o>0&&o<=t.length&&t[o-1]&&(s=t[o-1].type||"None");let r={offRates:new Map,type:s};for(const e of a)e.size>0&&i(r.offRates,e);n.push(r)}return n;function i(o,a){for(const[s,r]of a)o.has(s)?o.get(s).prob+=r.prob:o.set(s,{...r})}}function wt(t){const n=new Array(t.length),i=4;for(let o=0;o<t.length;o++){let a=0;for(let s=0;s<i;s++){const r=t[o][s].states;for(let e=0;e<r.length;e++)a+=r[e]}n[o]=a}return n}function vt(t){const n=[];for(let i=0;i<t.length;i++){const o=t[i];let a=0;for(let s=0;s<o.length;s++){const r=o[s].states;for(let e=0;e<r.length;e++)for(const[c,l]of r[e])a+=l.prob}n.push(a)}return n}function Rt(t){let o=0;for(let a=0,s=t.length;a<s;a++)for(let r=0;r<4;r++){const e=t[a][r].states;for(let c=0,l=e.length;c<l;c++)e[c]>0&&e[c]<=1e-10&&(o+=e[c],e[c]=0)}if(o>0){const a=1/(1-o);for(let s=0,r=t.length;s<r;s++)for(let e=0;e<4;e++){const c=t[s][e].states;for(let l=0,p=c.length;l<p;l++)c[l]!=0&&(c[l]*=a)}}}function _t(t){for(let i=0;i<t.length;i++)for(let o=0;o<4;o++){const a=t[i][o].states;for(let s=0;s<a.length;s++){const r=a[s];let e=0;for(const c of r.values())e+=c.prob;a[s]=e}}}function Et(t,n,i){if(!Array.isArray(t.SSR.pullPlan))throw new Error("Invalid pull plan");const{pullPlan:o}=t.SSR,a=[];for(const[r,e]of o.entries())e.type==="char"?(a.push(Array.from({length:3},()=>({states:Array.from({length:i.CHARACTER_SSR_5050},()=>new Map),type:"Character",isEmpty:!0}))),a[r].push({states:Array.from({length:i.CHARACTER_SSR_GUARANTEED},()=>new Map),type:"Character",isEmpty:!0})):a.push(Array.from({length:4},()=>({states:Array.from({length:i.WEAPON_SSR},()=>new Map),type:"Weapon",isEmpty:!0})));return a.push(Array.from({length:4},()=>({states:Array.from({length:1},()=>new Map)}))),s(n),{distributionSSR:a};function s(r){let e=0;r[0].type==="firstChar"&&(e=r[0].special),a[0][e].states[r[0].pity].set(0,{prob:1}),a[0][e].isEmpty=!1}}function kt(t,n){let i=!1,o=!1,a=0,s=0;const r=[];a+=t.SSR.pity.char,a+=t.SSR.guarantee.char*n.pitySSRChar,s+=t.SSR.pity.wep,s+=t.SSR.special.epitPath===0?t.SSR.guarantee.wep*n.pitySSRWep:2*n.pitySSRWep;for(const e of t.SSR.pullPlan)e.type==="char"&&!i?(i=!0,r.push({type:"firstChar",pity:a,special:t.SSR.special.capRad})):e.type==="wep"&&!o?(o=!0,r.push({pity:s})):r.push({pity:0});return r.push({pity:0}),r}function At(t,n){const o=(n.SR-1)/2,a=[{states:Array.from({length:n.SR},()=>new Map)}],s=[{states:Array.from({length:n.SR},()=>new Map)}],r=t.SR.guarantee.char*o+t.SR.pity.char,e=t.SR.guarantee.wep*o+t.SR.pity.wep;c(a[0].states[r]),c(s[0].states[e]);function c(l){l.set(0,{prob:1})}return{distributionCharSR:a,distributionWepSR:s}}const C=1e-10;function xt(t,n,i,o,a,s){const r=t.length-2;for(let e=r;e>=0;e--){const c=s[e+1],l=c.pity;let p=null;if(c.type==="firstChar"&&(p=c.special),!t[e].isEmpty)for(let u=0;u<4;u++){const d=t[e][u];if(!d.isEmpty)if(d.type==="Character")Pt(n,e,t,o,l,u);else if(d.type==="Weapon")Tt(i,e,t,a,l,u,p);else throw new Error(`Unknown SSR array type: ${d.type}`)}}}function Pt(t,n,i,o,a,s){const r=Math.floor(s/2),e=i[n][s].states;if(s!=3){const c=i[n][s].states.length;let l=.5;s===2&&(l=.55);const p=i[n+1][r].states,u=i[n+1][s+1].states;for(let d=c-2;d>=0;d--){const h=e[d],f=d>=o,b=t[d-o*f],g=h*b,_=h-g;let S=g;if(S>C){let m=u;f||(S*=l,m=p),m[a]+=S}if(!f){let m=g*(1-l);m>C&&(e[o]+=m)}let w=_;w>C&&(e[d+1]+=w),e[d]=0}}else{const c=i[n+1][r].states,l=i[n][s].states.length;for(let p=l-2;p>=0;p--){const u=e[p],d=t[p],h=u*d,f=u-h;let b=h;b>C&&(c[a]+=b);let g=f;g>C&&(e[p+1]+=g),e[p]=0}}}function Tt(t,n,i,o,a,s,r){let e=s;r!=null&&(e=r);const c=i[n][s].states.length,l=.375,p=.625,u=i[n][s].states,d=i[n+1][e].states;for(let h=c-2;h>=0;h--){const f=u[h],b=h>=2*o;let g=!1;b||(g=h>=o);const _=t[h-o*g-o*b*2],S=f*_,w=f-S;let m=S;if(m>C&&(b||(g?m*=p:m*=l),d[a]+=m),!b){let E=S*(1-l);g&&(E=S*(1-p)),E>C&&(u[o*2]+=E)}let P=w;P>C&&(u[h+1]+=P),u[h]=0}}const Lt="genshin",D=y.pity.pitySSRChar,F=y.pity.pitySSRWep,Nt=y.pity.pitySRChar,q={CHARACTER_SSR_5050:y.pity.pitySSRChar*2+1,CHARACTER_SSR_GUARANTEED:y.pity.pitySSRChar+1,WEAPON_SSR:y.pity.pitySSRWep*3+1,SR:y.pity.pitySRChar*2+1},Ot={distributionArrays:{makeSSR:(t,n)=>Et(t,n,q),makeSR:t=>At(t,q),sortPity:t=>kt(t,y.pity)},pullLogic:{rankUpSSRCheap:(t,n)=>xt(t,k,A,D,F,n)},workerManager:new it,contexts:{contextSSR:{ODDS_CHARACTER_SSR:k,ODDS_WEAPON_SSR:A,SSR_CHAR_PITY:D,SSR_WEP_PITY:F},contextSR:{ODDS_SR:x,SR_PITY:Nt},moduleType:Lt},helpers:{consolidateDistributionForCashback:Ct,consolidateProbabilitiesCheap:wt,consolidateProbabilities:vt,simplifyDistribution:_t,normalizeCheap:Rt,checkIsEmpty:St}};function zt(t,n){return new lt(y,Ot).runGachaCalculation(t,n)}document.addEventListener("DOMContentLoaded",()=>{const t={gachaConfig:y,CONSTELLATION_MAP:R,runCalcFn:zt,cashbackFn:ct,updateTableFn:ot};new bt(t).initialize()});

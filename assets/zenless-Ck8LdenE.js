import{e as k,f as y,T as A,h as L,i as E,j as D,l as I,k as O,m as C,n as b,s as R,u as z,q as N}from"./cashback-DiFGDUic.js";/* empty css               */import{s as W,m as _,a as w,r as B,b as f}from"./pullLogic-Bz6sPKyd.js";import{a as o,c as H,s as x}from"./commonHelpers-UftpUM4s.js";class F{constructor(t){this.parts=t,this.persistence=k("zzz");const i=y({cashbackCalculator:this.parts.cashbackFn,uiUpdater:this.parts.updateTableFn}),s={calculatorFunction:this.parts.runCalcFn,calculatorConfig:{gachaConfig:this.parts.gachaConfig,CONSTELLATION_MAP:this.parts.CONSTELLATION_MAP},postCalculationHooks:[i]};this.validator=new A(this.parts.CONSTELLATION_MAP),this.calculationHandler=L(s,this.persistence),this.calculateBtn=document.getElementById("calculate-btn"),this.exportBtn=document.getElementById("export-btn")}initialize(){this.validator.initialize(),E(this.persistence,this.parts.gachaConfig,this.validator),D(),this.#t(),this.#i()}#t(){if(!this.calculateBtn){console.error("Calculate button not found!");return}this.calculateBtn.addEventListener("click",()=>{this.#a()&&this.calculationHandler()}),this.exportBtn&&this.exportBtn.addEventListener("click",()=>I(this.persistence)),O(this.persistence,null,this.validator)}#a(){if(document.querySelectorAll(".is-invalid").forEach(a=>a.classList.remove("is-invalid")),this.validator.isDataValid())return!0;console.warn("Validation failed. Calculation blocked."),this.validator.validateAll();const t=document.querySelectorAll(".is-invalid"),i=new Set;t.forEach(a=>{const n=a.closest(".tab-pane");if(n){const l=document.querySelector(`.tab-link[data-tab-target="#${n.id}"]`);l&&i.add(l)}a.classList.add("flicker"),a.addEventListener("animationend",()=>a.classList.remove("flicker"),{once:!0})}),i.forEach(a=>{a.classList.add("is-invalid","flicker"),a.addEventListener("animationend",()=>a.classList.remove("flicker"),{once:!0})});const s=Array.from(i)[0];return s&&s.click(),setTimeout(()=>{t[0]?.scrollIntoView({behavior:"smooth",block:"center"})},100),!1}#i(){const t=this.persistence.loadCalculation(),i=t?t.input:null;t?(C(this.parts.gachaConfig.paths,i),b(t),R(t.persistInput)):(C(this.parts.gachaConfig.paths),b(),R()),this.calculationHandler()}}const P=[.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.066,.126,.186,.246,.306,.366,.426,.486,.546,.606,.666,.726,.786,.846,.906,.966,1],g=[.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.077,.147,.217,.287,.357,.427,.497,.567,.637,.707,.777,.847,.917,.987,1],c=[.051,.051,.051,.051,.051,.051,.051,.051,.561,1],r={maxCharacterConstelation:6,rateUpCharacterSR:2,rateUpWeaponSR:2,poolStandardCharSSR:6,poolCharSR:11,configSR:{maxType:7,regularPoints:.4,specialPoints:1},configSSR:{maxType:7,regularPoints:2,specialPoints:5},configWep:{pointsSR:.4,pointsSSR:2},paths:{char:["None","m0","m1","m2","m3","m4","m5","m6"],wep:["None","r1","r2","r3","r4","r5"]},pity:{pitySSRChar:P.length,pitySSRWep:g.length,pitySRChar:c.length,pitySRWep:c.length},default:0},U={none:0,m0:1,m1:2,m2:3,m3:4,m4:5,m5:6,m6:7};function M(e){const t={CHARACTER:r.pity.pitySSRChar*2+1,WEAPON:r.pity.pitySSRWep*2+1,SR:r.pity.pitySRChar*2+1,FINAL:1},i=W(e,t);let s={char:{},wep:{}};const{distributionSSR:a}=_(e,i,t),{distributionCharSR:n,distributionWepSR:l}=w(e,t);let p=[],h=[],u=[],d=0;for(;d<.999;){B(a,P,g,i,e.SSR.pullPlan,s,t),f(s.char,n,c,t),f(s.wep,l,c,t);let m=0;for(let v of a[a.length-1])m+=v.totalSum;d=m,p.push(o(a)),h.push(o(l)),u.push(o(n))}const T=o(n);let S=H(T);return S=x(S,r.rateUpCharacterSR),{SSR:p,WepSR:h,CharSR:u}}document.addEventListener("DOMContentLoaded",()=>{const e={gachaConfig:r,CONSTELLATION_MAP:U,runCalcFn:M,cashbackFn:N,updateTableFn:z};new F(e).initialize()});

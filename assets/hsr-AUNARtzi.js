import{c as Y,C as q,D as G,a as $,r as j,b as J,u as K,g as X,d as Q,e as Z,f as e0,i as t0,h as n0,k as a0,m as i0,l as s0,j as o0,n as T,o as x,s as E,p as l0}from"./solvers-DNokfUJ7.js";/* empty css               */import{c as r0,W as c0,g as u0}from"./cashback-helpers-DALc-p6m.js";import{c as p0,n as S0,s as h0,a as d0,b as w0,d as C0}from"./common-helpers-CPLJV1Gy.js";import{s as f0,m as b0,a as g0}from"./make-distribution-arrays-Cl3ImG5G.js";import{r as m0}from"./common-pull-logic-CWsuZInA.js";import{c as y0}from"./cashback-F4_2H4tU.js";function v0(a,n,e){const t=document.querySelectorAll('select[data-control^="standard-slot-"]'),l=document.getElementById("custom-standards-panel").querySelectorAll('select[data-control^="rate-up-slot-"]');if(t.length===0)return;let i=e._load("hsr-constellations");if(i===null){i={},i.constValues={};for(let o=0;o<a.length;o++){let r=a[o].value;i.constValues[r]="none"}i.selectedChars=[];for(let o=0;o<7;o++){let r=a[o].value;i.selectedChars.push(r)}}const c=[...a];let p=k0(c,i);function C(){const o=new Set(p.map(r=>r.value));t.forEach((r,S)=>{const u=i.selectedChars[S],f=c.filter(d=>!o.has(d.value)||d.value===u).map(d=>`<option value="${d.value}">${d.text}</option>`).join("");r.innerHTML=f,r.value=u})}if(C(),t.forEach((o,r)=>{o.addEventListener("change",()=>{const S=o.value,u=c.find(f=>f.value===S);u&&(p[r]={...u},A(t,i.selectedChars),e._save("hsr-constellations",i),C(),R(l,i),P(t,i.constValues))})}),l.length===0)return;const h=n.slice(1,-1).map(o=>`<option value="${o.value}">${o.text}</option>`).join("");l.forEach(o=>{o.innerHTML=h,o.value="none",o.addEventListener("change",()=>{T0(t,l,i.constValues),A(t,i.selectedChars),e._save("hsr-constellations",i),P(t,i.constValues)})}),R(l,i)}function k0(a,n){const e=[];for(const t of a)n.selectedChars.includes(t.value)&&e.push(t);return e}function R(a,n){for(let e=0;e<a.length;e++)a[e].value=n.constValues[n.selectedChars[e]]}function A(a,n){for(let e=0;e<a.length;e++)n[e]=a[e].value}function T0(a,n,e){for(let t=0;t<a.length;t++){let s=a[t].value;e[s]=n[t].value}}function P(a,n){const t=document.querySelector('[data-validation-type="row-sum"]').querySelectorAll("input.custom-input"),s=new Array(8).fill(0),l={none:0,e0:1,e1:2,e2:3,e3:4,e4:5,e5:6,e6:7};for(let i=0;i<a.length;i++){let c=a[i].value,p=n[c],C=l[p];s[C]++}for(let i=0;i<t.length;i++)t[i].value=s[i]}const m=[.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.066,.126,.186,.246,.306,.366,.426,.486,.546,.606,.666,.726,.786,.846,.906,.966,1],y=[.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.078,.148,.218,.288,.358,.428,.498,.568,.638,.708,.778,.848,.918,.988,1],v=[.051,.051,.051,.051,.051,.051,.051,.051,.561,1],w={maxCharacterConstelation:6,rateUpCharacterSR:3,rateUpWeaponSR:3,poolStandardCharSSR:7,poolCharSR:23,configSR:{maxType:7,regularPoints:.4,specialPoints:1},configSSR:{maxType:7,regularPoints:2,specialPoints:5},configWep:{pointsSR:.4,pointsSSR:2},paths:{char:["None","e0","e1","e2","e3","e4","e5","e6"],wep:["None","s1","s2","s3","s4","s5"]},pity:{pitySSRChar:m.length,pitySSRWep:y.length,pitySRChar:v.length,pitySRWep:v.length},default:0},L={rateUpOddsChar:.5+.5/8,rateUpOddsWep:.75+.25/8},I=[{value:"unknown",text:"Unknown"},{value:"none",text:"Not Owned"},{value:"e0",text:"E0"},{value:"e1",text:"E1"},{value:"e2",text:"E2"},{value:"e3",text:"E3"},{value:"e4",text:"E4"},{value:"e5",text:"E5"},{value:"e6",text:"E6"},{value:"new",text:"New Character"}],k={none:0,e0:1,e1:2,e2:3,e3:4,e4:5,e5:6,e6:7},V=[{value:"1211",text:"Bailu"},{value:"1101",text:"Bronya"},{value:"1107",text:"Clara"},{value:"1104",text:"Gepard"},{value:"1003",text:"Himeko"},{value:"1004",text:"Welt"},{value:"1209",text:"Yanqing"},{value:"1102",text:"Seele"},{value:"1205",text:"Blade"},{value:"1208",text:"Fu Xuan"}],U=new Set(["1003","1004","1101","1104","1107","1209","1211"]),x0=new Set(["23013","23012","23005","23004","23003","23002","23000"]),E0={2003:new Set(["1105","1109","1106"]),2004:new Set(["1206","1001","1202"]),2005:new Set(["1002","1009","1103"]),2006:new Set(["1106","1201","1207"]),2007:new Set(["1008","1206","1105"]),2008:new Set(["1111","1108","1103"]),2009:new Set(["1207","1009","1001"]),2010:new Set(["1110","1109","1106"]),2011:new Set(["1202","1201","1108"]),2012:new Set(["1210","1111","1206"]),2013:new Set(["1210","1111","1206"]),2014:new Set(["1002","1008","1009"]),2015:new Set(["1215","1110","1009"]),2016:new Set(["1215","1110","1009"]),2017:new Set(["1214","1001","1202"]),2018:new Set(["1214","1001","1202"]),2019:new Set(["1206","1105","1109"]),2020:new Set(["1206","1105","1109"]),2021:new Set(["1312","1202","1210"]),2022:new Set(["1312","1202","1210"]),2023:new Set(["1108","1201","1215"]),2024:new Set(["1108","1201","1215"]),2025:new Set(["1301","1106","1002"]),2026:new Set(["1301","1106","1002"]),2027:new Set(["1110","1111","1103"]),2028:new Set(["1110","1111","1103"]),2029:new Set(["1001","1215","1214"]),2030:new Set(["1001","1215","1214"]),2031:new Set(["1106","1111","1109"]),2032:new Set(["1106","1111","1109"]),2033:new Set(["1301","1312","1214"]),2034:new Set(["1301","1312","1214"]),2035:new Set(["1103","1105","1009"]),2036:new Set(["1103","1105","1009"]),2037:new Set(["1215","1207","1110"]),2038:new Set(["1215","1207","1110"]),2039:new Set(["1109","1210","1008"]),2040:new Set(["1109","1210","1008"]),2041:new Set(["1223","1009","1111"]),2042:new Set(["1223","1009","1111"]),2043:new Set(["1223","1009","1111"]),2044:new Set(["1223","1009","1111"]),2045:new Set(["1312","1105","1210"]),2046:new Set(["1312","1105","1210"]),2047:new Set(["1110","1214","1207"]),2048:new Set(["1110","1214","1207"]),2049:new Set(["1001","1106","1108"]),2050:new Set(["1001","1106","1108"]),2051:new Set(["1201","1008","1202"]),2052:new Set(["1201","1008","1202"]),2053:new Set(["1301","1207","1312"]),2054:new Set(["1301","1207","1312"]),2055:new Set(["1105","1009","1223"]),2056:new Set(["1105","1009","1223"]),2057:new Set(["1105","1009","1223"]),2058:new Set(["1105","1009","1223"]),2059:new Set(["1202","1215","1206"]),2060:new Set(["1202","1215","1206"]),2061:new Set(["1202","1215","1206"]),2062:new Set(["1202","1215","1206"]),2063:new Set(["1110","1109","1210"]),2064:new Set(["1110","1109","1210"]),2065:new Set(["1008","1214","1105"]),2066:new Set(["1008","1214","1105"]),2067:new Set(["1106","1301","1110"]),2068:new Set(["1106","1301","1110"]),2069:new Set(["1106","1301","1110"]),2070:new Set(["1106","1301","1110"]),2071:new Set(["1002","1103","1223"]),2072:new Set(["1002","1103","1223"]),2073:new Set(["1312","1103","1105"]),2074:new Set(["1312","1103","1105"]),2075:new Set(["1201","1214","1206"]),2076:new Set(["1201","1214","1206"]),2077:new Set(["1202","1001","1207"]),2078:new Set(["1202","1001","1207"]),2079:new Set(["1202","1001","1207"]),2080:new Set(["1202","1001","1207"]),2081:new Set(["1215","1110","1111"]),2082:new Set(["1215","1110","1111"]),2083:new Set(["1215","1110","1111"]),2084:new Set(["1008","1009","1109"]),2085:new Set(["1008","1009","1109"]),2086:new Set(["1002","1201","1108"]),2087:new Set(["1002","1201","1108"]),2088:new Set(["1210","1312","1214"]),2089:new Set(["1210","1312","1214"]),2090:new Set(["1215","1103","1206"]),2091:new Set(["1215","1103","1206"]),2092:new Set(["1223","1110","1106"]),2093:new Set(["1223","1110","1106"]),2094:new Set(["1223","1110","1106"]),2095:new Set(["1223","1110","1106"]),2096:new Set(["1223","1110","1106"]),2097:new Set(["1223","1110","1106"]),2098:new Set(["1223","1110","1106"]),2099:new Set(["1223","1110","1106"])},R0={3003:new Set(["21005","21001","21000"]),3004:new Set(["21011","21003","21002"]),3005:new Set(["21017","21004","21013"]),3006:new Set(["21001","21018","21020"]),3007:new Set(["21012","21007","21010"]),3008:new Set(["21015","21008","21006"]),3009:new Set(["21018","21011","21009"]),3010:new Set(["21014","21019","21016"]),3011:new Set(["21004","21013","21008"]),3012:new Set(["21005","21015","21003"]),3013:new Set(["21005","21015","21003"]),3014:new Set(["21007","21017","21016"]),3015:new Set(["21000","21019","21006"]),3016:new Set(["21000","21019","21006"]),3017:new Set(["21011","21002","21012"]),3018:new Set(["21011","21002","21012"]),3019:new Set(["21014","21003","21009"]),3020:new Set(["21014","21003","21009"]),3021:new Set(["21042","21015","21018"]),3022:new Set(["21042","21015","21018"]),3023:new Set(["21011","21019","21020"]),3024:new Set(["21011","21019","21020"]),3025:new Set(["21001","21000","21017"]),3026:new Set(["21001","21000","21017"]),3027:new Set(["21043","21007","21013"]),3028:new Set(["21043","21007","21013"]),3029:new Set(["21010","21044","21014"]),3030:new Set(["21010","21044","21014"]),3031:new Set(["21020","21012","21009"]),3032:new Set(["21020","21012","21009"]),3033:new Set(["21004","21002","21008"]),3034:new Set(["21004","21002","21008"]),3035:new Set(["21007","21016","21045"]),3036:new Set(["21007","21016","21045"]),3037:new Set(["21005","21014","21006"]),3038:new Set(["21005","21014","21006"]),3039:new Set(["21046","21008","21012"]),3040:new Set(["21046","21008","21012"]),3041:new Set(["21010","21015","21006"]),3042:new Set(["21010","21015","21006"]),3043:new Set(["21010","21015","21006"]),3044:new Set(["21010","21015","21006"]),3045:new Set(["21047","21007","21011"]),3046:new Set(["21047","21007","21011"]),3047:new Set(["21048","21045","21019"]),3048:new Set(["21048","21045","21019"]),3049:new Set(["21002","21044","21013"]),3050:new Set(["21002","21044","21013"]),3051:new Set(["21046","21006","21010"]),3052:new Set(["21046","21006","21010"]),3053:new Set(["21042","21015","21043"]),3054:new Set(["21042","21015","21043"]),3055:new Set(["21003","21009","21020"]),3056:new Set(["21003","21009","21020"]),3057:new Set(["21003","21009","21020"]),3058:new Set(["21003","21009","21020"]),3059:new Set(["21020","21017","21018"]),3060:new Set(["21020","21017","21018"]),3061:new Set(["21020","21017","21018"]),3062:new Set(["21020","21017","21018"]),3063:new Set(["21011","21000","21016"]),3064:new Set(["21011","21000","21016"]),3065:new Set(["21014","21012","21004"]),3066:new Set(["21014","21012","21004"]),3067:new Set(["21001","21000","21044"]),3068:new Set(["21001","21000","21044"]),3069:new Set(["21001","21000","21044"]),3070:new Set(["21001","21000","21044"]),3071:new Set(["21016","21045","21005"]),3072:new Set(["21016","21045","21005"]),3073:new Set(["21013","21047","21002"]),3074:new Set(["21013","21047","21002"]),3075:new Set(["21020","21008","21007"]),3076:new Set(["21020","21008","21007"]),3077:new Set(["21054","21011","21019"]),3078:new Set(["21054","21011","21019"]),3079:new Set(["21054","21011","21019"]),3080:new Set(["21054","21011","21019"]),3081:new Set(["21012","21017","21015"]),3082:new Set(["21012","21017","21015"]),3083:new Set(["21012","21017","21015"]),3084:new Set(["21008","21046","21042"]),3085:new Set(["21008","21046","21042"]),3086:new Set(["21006","21010","21001"]),3087:new Set(["21006","21010","21001"]),3088:new Set(["21048","21045","21018"]),3089:new Set(["21048","21045","21018"]),3090:new Set(["21009","21003","21014"]),3091:new Set(["21009","21003","21014"]),3092:new Set(["21054","21043","21044"]),3093:new Set(["21054","21043","21044"]),3094:new Set(["21054","21043","21044"]),3095:new Set(["21054","21043","21044"]),3096:new Set(["21054","21043","21044"]),3097:new Set(["21054","21043","21044"]),3098:new Set(["21054","21043","21044"]),3099:new Set(["21054","21043","21044"])};function A0(a,n){const e=a.trim().split(`
`);if(e[0]!="uid,id,rarity,time,banner,type,manual")throw new Error("Imported data is missing key starrailstation.com properties.");const t=n._load("hsr-constellations"),s=O(e,"character",t),l=O(e,"weapon"),i=[{banner:"character",...s},{banner:"weapon",...l}],c=P0(e,t);return{pity:i,constellation:c}}function O(a,n,e){let t=0,s=0,l=!1,i=!1,c=!1,p=!1;const C=a.slice(1);for(let b=C.length-1;b>=0;b--){const o=C[b].split(","),r=o[1],S=o[2],u=o[4],f=o[5];let d;if(n==="character"?d="11":d="12",f===d&&(S==="5"?(c||(l=B(r,S,n,u,e)),p||s++,c=!0):S==="4"?(c||t++,p||(i=B(r,S,n,u)),p=!0):S==="3"?(c||t++,p||s++):console.error("Unknown rarity"),c&&p))break}return{pity4:String(s),pity5:String(t),guarantee4:i,guarantee5:l}}function B(a,n,e,t,s){let l=!1;if(n==="5")if(e==="character"){let i=U;s!=null&&s!=null&&(i=new Set(s.selectedChars)),l=i.has(a)}else l=x0.has(a);else e==="character"?l=!E0[t].has(a):l=!R0[t].has(a);return l}function P0(a,n){const e=new Array(Object.keys(k).length).fill(0),t=new Array(Object.keys(k).length).fill(0),s=new Map,l=new Map;let i=U;n!=null&&n!=null&&(i=new Set(n.selectedChars)),a.slice(1).map(h=>{const o=h.split(","),r=o[1].length===4,S=o[2],u=o[1];if(r){const f=V.some(d=>d.value===u);S==="5"&&f?l.set(u,(l.get(u)||0)+1):S==="4"&&s.set(u,(s.get(u)||0)+1)}});for(const h of s.values()){const o=e.length-1;h>=o?e[o]++:e[h]++}for(const[h,o]of l)if(i.has(h)){const r=t.length-1;o>=r?(t[r]++,i[h]=r):(t[o]++,i[h]=o)}const c=w.poolCharSR,p=w.poolStandardCharSSR,C=c-s.size,b=p-l.size;return e[0]=Math.max(0,C),t[0]=Math.max(0,b),{0:t.map(String),1:e.map(String)}}const N={CHARACTER:"character",WEAPON:"weapon"},g={PITY_ROW:"[data-banner]",CONSTELLATION_ROW:"[data-rarity]",PITY_TABLE:"#pity-table",CONSTELLATION_TABLE:"#constellation-table"},_={pitySettings:{[N.CHARACTER]:{pity4:0,pity5:0},[N.WEAPON]:{pity4:0,pity5:0}},isCharacter:!0,isWeapon:!0,isSpecial:!1,constellationColumns:8},z={probability:70,pulls:119},L0=`
    <div class="chibi-group">
        <div class="bubble-wrapper bubble-wrapper--big">
            <svg class="bubble-svg-background" viewBox="0 0 1820 858" xmlns="http://www.w3.org/2000/svg">
                <path style="fill:#232338; stroke:#0b091b; stroke-width: 1px"
                    d="M 787.500 1.005 C 640.632 4.659, 524.925 15.685, 414 36.596 C 305.731 57.006, 229.612 80.375, 165.037 113.026 C 88.008 151.975, 38.939 199.840, 15.519 258.874 C 8.496 276.575, 3.327 301.798, 0.941 330 C -2.027 365.084, 6.008 405.046, 22.959 439.500 C 43.249 480.744, 73.516 513.346, 120 544.028 C 209.228 602.924, 363.734 646.238, 553 665.416 C 650.260 675.270, 808.209 681.908, 948.500 682.035 C 999.011 682.081, 1061.358 683.505, 1068.623 684.778 C 1072.726 685.497, 1072.776 685.559, 1079.177 698 C 1096.318 731.313, 1116.859 760.237, 1136.746 779.061 C 1155.047 796.384, 1181.968 815.466, 1202.839 825.908 C 1232.446 840.721, 1273.797 852.517, 1310.770 856.698 C 1324.340 858.232, 1326.511 858.262, 1330.270 856.962 C 1332.596 856.158, 1334.500 855.138, 1334.500 854.696 C 1334.500 854.254, 1331.125 852.760, 1327 851.377 C 1314.484 847.179, 1287.809 833.665, 1277.295 826.195 C 1265.925 818.116, 1226.275 778.561, 1216.635 765.680 C 1206.358 751.947, 1188.566 715.606, 1185.906 702.916 C 1185.282 699.937, 1183.944 693.900, 1182.931 689.500 C 1181.919 685.100, 1180.809 679.883, 1180.464 677.906 L 1179.836 674.312 1189.168 673.673 C 1234.976 670.533, 1307.910 662.018, 1358.500 653.902 C 1387.862 649.192, 1405.290 645.828, 1437.500 638.654 C 1443.550 637.306, 1457.500 634.310, 1468.500 631.995 C 1491.435 627.169, 1506.239 623.528, 1520.500 619.205 C 1526 617.538, 1538.150 614.072, 1547.500 611.504 C 1604.081 595.961, 1658.813 573.047, 1691.807 551.088 C 1716.705 534.517, 1726.861 526.038, 1752.999 500 C 1782.013 471.097, 1799.115 442.990, 1810.458 405.568 C 1814.346 392.741, 1819 366.582, 1819 357.554 C 1819 354.499, 1819.450 352, 1820 352 C 1821.274 352, 1821.299 340.366, 1820.046 330.791 C 1819.521 326.781, 1818.582 319.225, 1817.959 314 C 1809.521 243.236, 1771.421 185.672, 1703 140.314 C 1640.860 99.120, 1548.917 64.910, 1443 43.576 C 1339.978 22.824, 1215.062 9.498, 1072 3.996 C 994.931 1.032, 848.352 -0.509, 787.500 1.005 M 776 4.600 C 771.325 4.777, 754 5.405, 737.500 5.995 C 561.542 12.295, 402.823 35.450, 277.947 73.040 C 210.624 93.305, 153.205 120.092, 109 151.857 C 80.401 172.408, 53.246 200.489, 37.044 226.269 C 19.796 253.711, 10.505 280.375, 6.026 315.288 C 1.913 347.340, 4.080 374.322, 13.106 403.467 C 26.641 447.170, 50.753 482.527, 90 516.224 C 101.716 526.283, 126.303 543.639, 138.425 550.406 C 140.926 551.802, 146.466 554.925, 150.736 557.345 C 194.368 582.071, 259.942 606.163, 334.540 624.875 C 473.407 659.708, 622.538 674.025, 888 678.008 C 1034.249 680.203, 1070.594 680.938, 1073.423 681.757 C 1075.031 682.222, 1076.681 683.255, 1077.088 684.051 C 1077.496 684.848, 1079.729 689.325, 1082.051 694 C 1091.185 712.393, 1108.924 740.328, 1121.008 755.350 C 1129.418 765.805, 1144.301 780.492, 1156.104 789.986 C 1170.999 801.967, 1195.222 817.726, 1208.500 824.072 C 1231.867 835.241, 1272.170 847.555, 1298 851.418 C 1323.491 855.230, 1327.055 855.493, 1319.528 853.009 C 1311.535 850.371, 1284.081 836.370, 1276.055 830.838 C 1260.944 820.423, 1225.667 785.179, 1211.929 766.772 C 1201.655 753.007, 1184.830 717.485, 1182.499 704.638 C 1181.787 700.712, 1180.261 693.675, 1179.109 689 C 1176.730 679.347, 1176.376 672.148, 1178.250 671.514 C 1178.938 671.282, 1190.300 670.164, 1203.500 669.029 C 1239.066 665.973, 1275.315 662.018, 1309.500 657.465 C 1360.426 650.682, 1388.027 645.725, 1449 632.411 C 1463.025 629.349, 1479.778 625.754, 1486.229 624.424 C 1492.681 623.093, 1501.906 620.694, 1506.729 619.093 C 1511.553 617.492, 1527.169 612.983, 1541.432 609.074 C 1573.458 600.295, 1586.835 595.827, 1618.030 583.493 C 1644.114 573.179, 1671.994 559.215, 1688.966 547.965 C 1703.153 538.560, 1722.730 523.374, 1729.500 516.522 C 1732.800 513.182, 1739.501 506.636, 1744.391 501.975 C 1758.521 488.506, 1771.430 473.645, 1779.115 462 C 1788.491 447.791, 1793.962 437.449, 1800.288 421.977 C 1815.087 385.778, 1819.761 344.986, 1813.433 307.269 C 1804.545 254.291, 1779.063 209.320, 1736.709 171.866 C 1691.153 131.580, 1625.043 98.185, 1538.202 71.592 C 1418.757 35.015, 1261.222 14.066, 1048 6.407 C 1008.502 4.988, 802.012 3.616, 776 4.600 M 0.355 344.500 C 0.352 349.450, 0.521 351.601, 0.731 349.280 C 0.940 346.959, 0.943 342.909, 0.736 340.280 C 0.530 337.651, 0.358 339.550, 0.355 344.500" />
                </svg>
            <div class="bubble-text"> </div>
        <img src="/images/37_chibi.png" alt="Tutorial Assistant" class="tutorial-chibi">
        </div>
        <button class="btn btn--tutorial_next">>></button>
        <button class="btn btn--tutorial_end">x</button>
    </div>`,D=[{text:"<p>Welcome to the Gacha Calculator! Let me show you around.</p>",size:"small"},{id:"pity-input-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#pity-panel"]',text:"<p>First, input your current pity and guarantees here. You can import data from starrailstation.com directly(press ? near respective elements to learn more)</p>",position:"right"},{id:"pull-plan-step",element:".pull-plan-section",text:"<p>Next, build your pull plan here. Add all the characters and weapons in the order you plan to obtain them.</p>",position:"left",chibiSide:"left"},{id:"target-step",element:".header-controls",text:"<p>Now, set your target. This can be your desired confidence level(e.g., a 70% chance of getting all planned items) or your total pull budget.</p>",position:"top",chibiSide:"left",size:"big"},{id:"calculate-button-step",element:"#calculate-btn",text:"<p>Once your plan and target are set, click <strong>Calculate</strong> and I will calculate everything for you.</p>",position:"right",size:"small"},{element:".chart-wrapper",text:"<p>You'll get a chart showing the probability of success for each number of pulls until 100%.</p>",position:"top"},{id:"constellation-input-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#constellation-panel"]',text:"<p>Input how many Standard 5* and non-standard 4* characters you have at each constellation level. This information is necessary for accurate cashback predictions, you can skip it if you don't need it.</p>",position:"right",size:"big"},{id:"standard-help",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#custom-standards-panel"]',text:"<p>Input which extra characters you swapped with Standard chars and their constellation level. This information is necessary for accurate cashback predictions.</p>",position:"right",size:"big"},{id:"rate-ups-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#rateup-panel"]',text:"<p>If you know the rate-up 4-star characters, you can input their constellations on your account. This improves cashback accuracy and reduces unnecessary computation.</p>",position:"right",size:"huge"},{element:"#probability-table",text:"<p>And down here, you can see a detailed table with cashback estimates, for the given amount of pulls, it's only accurate if you inputed your data correctly.</p>",position:"top"}],H={"pity-input-step":{tourStepId:"pity-input-step"},"constellation-input-step":{tourStepId:"constellation-input-step"},"pull-plan-step":{tourStepId:"pull-plan-step"},"calculate-button-step":{tourStepId:"calculate-button-step"},"import-help":{element:".tab-panel-card",text:'<p>You can import your data directly from <a href="https://starrailstation.com/" target="_blank" rel="noopener noreferrer" class="soft-link">starrailstation.com</a>. Click the "Import Data" button and paste your exported JSON data or csv from tracker.</p>',position:"right",size:"big"},"export-help":{element:".tab-panel-card",text:"<p>You can export your data as a JSON file to make backup or to carry over data when you are switching to a different browser/new device.</p>",position:"right",size:"big"},"pity-help":{element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#pity-panel"]',text:"<p>You can input your current pity and guarantees here. You can import data from paimon.moe directly.</p>",position:"right",size:"big"},"constelation-help":{element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#constellation-panel"]',text:"<p>Input how many Standard 5* and non-standard 4* characters you have at each constellation level. This information is necessary for accurate cashback predictions.</p>",position:"right",size:"big"},"standard-help":{element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#custom-standards-panel"]',text:"<p>Input which extra characters you swapped with Standard chars and their constellation level. This information is necessary for accurate cashback predictions.</p>",position:"right",size:"big"},"rate-up-help":{element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#rateup-panel"]',text:"<p>If you know the featured 4*, you can then check what constellation it has on your account. This improves cashback accuracy and reduces unnecessary computation.</p>",position:"right",size:"huge"},"pull-plan-help":{element:".pull-plan-section",text:"<p>Build your pull plan here. Add all the characters and weapons in order you want to get them.</p>",position:"left",chibiSide:"left"},"target-help":{element:".header-controls",text:"<p>Set your target here: either your desired confidence level(e.g., 70% chance of getting all planned items) or your total pull budget.</p>",position:"top",chibiSide:"left",size:"big"},"cashback-help":{element:"#probability-table",text:"<p>Expected cashback for each 5* target reached with their respective probabilities, percentiles give you a reasonable range by cutting off extreme results(10% from each side).</p>",size:"big",chibiSide:"left",position:"top"}};class I0{constructor(n){this.parts=n,this.persistence=Y("hsr",g);const e=r0({cashbackCalculator:this.parts.cashbackFn,uiUpdater:this.parts.updateTableFn});this.tutorial=new q(L0);const t={getPageConfiguration:e0,getLabels:Z,getPullPlan:Q,getTarget:X,updateChart:K,convertToChartData:J,recalcInputs:j,calculatorFunction:this.parts.runCalcFn,calculatorConfig:{gachaConfig:this.parts.gachaConfig,CONSTELLATION_MAP:this.parts.CONSTELLATION_MAP},pageConfig:{SELECTORS:g,INITIAL_CONFIG:_},postCalculationHooks:[e],persistence:this.persistence,chibi:this.tutorial};this.validator=new G(this.parts.CONSTELLATION_MAP),this.calculationHandler=new $(t),this.calculateBtn=document.getElementById("calculate-btn"),this.exportBtn=document.getElementById("export-btn"),this.startTourBtn=document.getElementById("start-tour-btn"),this.toggleButtonsBtn=document.getElementById("toggle-buttons-btn")}initialize(){this.validator.initialize(),t0(this.persistence,this.parts.gachaConfig,this.validator,_,I,g),v0(V,I,this.persistence),n0(),a0(this.persistence),this.#e(),this.#n(),this.tutorial.showTutorialIfNeeded(D)}#e(){i0(),this.isCalculating=!1,this.calculateBtn&&this.calculateBtn.addEventListener("click",async()=>{if(!(this.isCalculating||!this.#t())){this.isCalculating=!0,this.calculateBtn.disabled=!0;try{await this.calculationHandler.runCalculation()}finally{this.isCalculating=!1,this.calculateBtn.disabled=!1}}}),this.exportBtn&&this.exportBtn.addEventListener("click",()=>s0(this.persistence)),this.startTourBtn&&this.startTourBtn.addEventListener("click",()=>{this.tutorial.startTour(D)}),o0(this.persistence,A0,this.validator,g,this.tutorial),document.querySelectorAll(".help-btn").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const s=e.getAttribute("data-help-key")||e.getAttribute("data-tour-step-id");if(s&&H[s]){const l=H[s];this.tutorial.showHelp(l,e)}else console.warn(`ChibiTutorial: No help configuration found for key '${s}'.`,e)})}),this.toggleButtonsBtn&&this.toggleButtonsBtn.addEventListener("click",()=>{document.querySelectorAll(".help-btn").forEach(t=>{t.classList.toggle("hidden")}),this.persistence.saveButtons()})}#t(){if(document.querySelectorAll(".is-invalid").forEach(s=>s.classList.remove("is-invalid")),this.validator.isDataValid())return!0;console.warn("Validation failed. Calculation blocked."),this.validator.validateAll();const n=document.querySelectorAll(".is-invalid"),e=new Set;n.forEach(s=>{const l=s.closest(".tab-pane");if(l){const i=document.querySelector(`.tab-link[data-tab-target="#${l.id}"]`);i&&e.add(i)}s.classList.add("flicker"),s.addEventListener("animationend",()=>s.classList.remove("flicker"),{once:!0})}),e.forEach(s=>{s.classList.add("is-invalid","flicker"),s.addEventListener("animationend",()=>s.classList.remove("flicker"),{once:!0})});const t=Array.from(e)[0];return t&&t.click(),setTimeout(()=>{n[0]?.scrollIntoView({behavior:"smooth",block:"center"})},100),!1}#n(){const n=this.persistence.loadCalculation(),e=n?n.input:null;n?(T(this.parts.gachaConfig.paths,e),x(z,n),E(n.persistInput)):(T(this.parts.gachaConfig.paths),x(z),E()),this.calculationHandler.runCalculation()}}const O0={pullLogic:"common",helpers:"common"},M=w.pity.pitySSRChar,W=w.pity.pitySSRWep,B0=w.pity.pitySRChar,F={CHARACTER:w.pity.pitySSRChar*2,WEAPON:w.pity.pitySSRWep*2,SR:w.pity.pitySRChar*2},N0={distributionArrays:{makeSSR:(a,n)=>g0(a,n,F),makeSR:a=>b0(a,F),sortPity:a=>f0(a,w.pity)},pullLogic:{rankUpSSRCheap:(a,n)=>m0(a,m,y,M,W,L,n)},workerManager:new c0,contexts:{contextSSR:{ODDS_CHARACTER_SSR:m,ODDS_WEAPON_SSR:y,SSR_CHAR_PITY:M,SSR_WEP_PITY:W,RATE_UP_ODDS:L},contextSR:{ODDS_SR:v,SR_PITY:B0},moduleType:O0},helpers:{consolidateDistributionForCashback:C0,consolidateProbabilitiesCheap:w0,consolidateProbabilities:d0,simplifyDistribution:h0,normalizeCheap:S0,checkIsEmpty:p0}};function _0(a,n){return new u0(w,N0).runGachaCalculation(a,n)}document.addEventListener("DOMContentLoaded",()=>{const a={gachaConfig:w,CONSTELLATION_MAP:k,runCalcFn:_0,cashbackFn:y0,updateTableFn:l0};new I0(a).initialize()});

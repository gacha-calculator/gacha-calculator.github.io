function h(s){const f=new Array(s.length);for(let n=0;n<s.length;n++){let e=0;const o=s[n].states;for(let t=0;t<o.length;t++){const l=o[t];for(const a of l.values())e+=a.prob}f[n]=e}return f}function m(s){const f=new Array(s.length);for(let n=0;n<s.length;n++){let e=0;const o=s[n].states;for(let t=0;t<o.length;t++)e+=o[t];f[n]=e}return f}function E(s){let e=0;for(let t=0,l=s.length;t<l;t++){const a=s[t].states;for(let r=0,i=a.length;r<i;r++)if(Array.isArray(a[r]))for(let p of a[r])for(const[u,c]of p)e+=c.prob,c.prob<=1e-10&&(e+=c.prob,p.delete(u));else{const p=a[r];for(const[u,c]of p)e+=c.prob,c.prob<=1e-10&&(e+=c.prob,p.delete(u))}}if(Math.abs(e-1)>1e-5){const t=1/e;for(let l=0,a=s.length;l<a;l++){const r=s[l].states;for(let i=0,p=r.length;i<p;i++){const u=r[i];for(const c of u.values())c.prob*=t}}}}function y(s){let n=0;for(let e=0,o=s.length;e<o;e++){const t=s[e].states;for(let l=0,a=t.length;l<a;l++)t[l]>0&&t[l]<=1e-10&&(n+=t[l],t[l]=0)}if(n>0){const e=1/(1-n);for(let o=0,t=s.length;o<t;o++){const l=s[o].states;for(let a=0,r=l.length;a<r;a++)l[a]!=0&&(l[a]*=e)}}}function g(s,f){let n=!0;if(f)for(let e=0;e<s.length-1;e++){let o=!0;for(const t of s[e].states)t>0&&(o=!1,n=!1);s[e].isEmpty=o}else for(let e=0;e<s.length-1;e++){let o=!0;for(const t of s[e].states)t.size>0&&(o=!1,n=!1);s[e].isEmpty=o}return n}function L(s,f,n){if(f.type==="probability"){const e=s.length-1;let o=0;for(const t of s[e].states)for(const[l,a]of t)o+=a.prob;return o>f.value}else if(f.type==="pulls")return n===f.value}function b(s){const f=[];for(let e=0;e<s.length;e++){const o=s[e].states;let t="None";e>0&&e<=s.length&&s[e-1]&&(t=s[e-1].type||"None");let l={offRates:new Map,type:t};for(const a of o)a.size>0&&n(l.offRates,a);f.push(l)}return f;function n(e,o){for(const[t,l]of o)e.has(t)?e.get(t).prob+=l.prob:e.set(t,{...l})}}function v(s){for(let f=0;f<s.length;f++){const n=s[f].states;for(let e=0;e<n.length;e++){const o=n[e];let t=0;for(const l of o.values())t+=l.prob;n[e]=t}}}export{g as checkIsEmpty,L as checkIsTarget,b as consolidateDistributionForCashback,h as consolidateProbabilities,m as consolidateProbabilitiesCheap,y as normalizeCheap,E as pruneAndNormalize,v as simplifyDistribution};

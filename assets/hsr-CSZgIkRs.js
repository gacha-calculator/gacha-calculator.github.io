import{c as E,D as m,C as f,r as A,a as P,u as v,g as k,b as L,d as I,e as O,i as N,f as _,j as D,h as x,k as h,l as S,s as d,m as W}from"./solvers-D-av1cDx.js";/* empty css               */import{c as H,W as w,g as B,a as F}from"./cashback-B5lDuaan.js";import{c as z,n as M,s as U,a as Y,b as V,d as q}from"./common-helpers-BPUYLRbn.js";import{r as G,s as j,m as J,a as $}from"./common-pull-logic-eoLatjHO.js";const C={CHARACTER:"character",WEAPON:"weapon"},o={PITY_ROW:"[data-banner]",CONSTELLATION_ROW:"[data-rarity]",PITY_TABLE:"#pity-table",CONSTELLATION_TABLE:"#constellation-table"},R={pitySettings:{[C.CHARACTER]:{pity4:0,pity5:0},[C.WEAPON]:{pity4:0,pity5:0}},isCharacter:!0,isWeapon:!0,isSpecial:!1,constellationColumns:8},T={probability:70,pulls:119},r=[.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.066,.126,.186,.246,.306,.366,.426,.486,.546,.606,.666,.726,.786,.846,.906,.966,1],l=[.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.077,.147,.217,.287,.357,.427,.497,.567,.637,.707,.777,.847,.917,.987,1],c=[.051,.051,.051,.051,.051,.051,.051,.051,.561,1],i={maxCharacterConstelation:6,rateUpCharacterSR:3,rateUpWeaponSR:3,poolStandardCharSSR:7,poolCharSR:23,configSR:{maxType:7,regularPoints:.4,specialPoints:1},configSSR:{maxType:7,regularPoints:2,specialPoints:5},configWep:{pointsSR:.4,pointsSSR:2},paths:{char:["None","e0","e1","e2","e3","e4","e5","e6"],wep:["None","s1","s2","s3","s4","s5"]},pity:{pitySSRChar:r.length,pitySSRWep:l.length,pitySRChar:c.length,pitySRWep:c.length},default:0},K=[{value:"unknown",text:"Unknown"},{value:"none",text:"Not Owned"},{value:"e0",text:"E0"},{value:"e1",text:"E1"},{value:"e2",text:"E2"},{value:"e3",text:"E3"},{value:"e4",text:"E4"},{value:"e5",text:"E5"},{value:"e6",text:"E6"}],Q={none:0,e0:1,e1:2,e2:3,e3:4,e4:5,e5:6,e6:7};class X{constructor(t){this.parts=t,this.persistence=E("hsr",o);const s=H({cashbackCalculator:this.parts.cashbackFn,uiUpdater:this.parts.updateTableFn}),n={getPageConfiguration:O,getLabels:I,getPullPlan:L,getTarget:k,updateChart:v,convertToChartData:P,recalcInputs:A,calculatorFunction:this.parts.runCalcFn,calculatorConfig:{gachaConfig:this.parts.gachaConfig,CONSTELLATION_MAP:this.parts.CONSTELLATION_MAP},pageConfig:{SELECTORS:o,INITIAL_CONFIG:R},postCalculationHooks:[s],persistence:this.persistence};this.validator=new m(this.parts.CONSTELLATION_MAP),this.calculationHandler=new f(n),this.calculateBtn=document.getElementById("calculate-btn"),this.exportBtn=document.getElementById("export-btn")}initialize(){this.validator.initialize(),N(this.persistence,this.parts.gachaConfig,this.validator,R,K,o),_(),this.#t(),this.#e()}#t(){if(!this.calculateBtn){console.error("Calculate button not found!");return}this.calculateBtn.addEventListener("click",()=>{this.#a()&&this.calculationHandler.runCalculation()}),this.exportBtn&&this.exportBtn.addEventListener("click",()=>D(this.persistence)),x(this.persistence,null,this.validator)}#a(){if(document.querySelectorAll(".is-invalid").forEach(e=>e.classList.remove("is-invalid")),this.validator.isDataValid())return!0;console.warn("Validation failed. Calculation blocked."),this.validator.validateAll();const t=document.querySelectorAll(".is-invalid"),s=new Set;t.forEach(e=>{const p=e.closest(".tab-pane");if(p){const u=document.querySelector(`.tab-link[data-tab-target="#${p.id}"]`);u&&s.add(u)}e.classList.add("flicker"),e.addEventListener("animationend",()=>e.classList.remove("flicker"),{once:!0})}),s.forEach(e=>{e.classList.add("is-invalid","flicker"),e.addEventListener("animationend",()=>e.classList.remove("flicker"),{once:!0})});const n=Array.from(s)[0];return n&&n.click(),setTimeout(()=>{t[0]?.scrollIntoView({behavior:"smooth",block:"center"})},100),!1}#e(){const t=this.persistence.loadCalculation(),s=t?t.input:null;t?(h(this.parts.gachaConfig.paths,s),S(T,t),d(t.persistInput)):(h(this.parts.gachaConfig.paths),S(T),d()),this.calculationHandler.runCalculation()}}const Z="common",b=i.pity.pitySSRChar,g=i.pity.pitySSRWep,t0=i.pity.pitySRChar,y={CHARACTER:i.pity.pitySSRChar*2+1,WEAPON:i.pity.pitySSRWep*2+1,SR:i.pity.pitySRChar*2+1},a0={distributionArrays:{makeSSR:(a,t)=>$(a,t,y),makeSR:a=>J(a,y),sortPity:a=>j(a,i.pity)},pullLogic:{rankUpSSRCheap:(a,t)=>G(a,r,l,b,g,t)},workerManager:new w,contexts:{contextSSR:{ODDS_CHARACTER_SSR:r,ODDS_WEAPON_SSR:l,SSR_CHAR_PITY:b,SSR_WEP_PITY:g},contextSR:{ODDS_SR:c,SR_PITY:t0},moduleType:Z},helpers:{consolidateDistributionForCashback:q,consolidateProbabilitiesCheap:V,consolidateProbabilities:Y,simplifyDistribution:U,normalizeCheap:M,checkIsEmpty:z}};function e0(a,t){return new B(i,a0).runGachaCalculation(a,t)}document.addEventListener("DOMContentLoaded",()=>{const a={gachaConfig:i,CONSTELLATION_MAP:Q,runCalcFn:e0,cashbackFn:F,updateTableFn:W};new X(a).initialize()});

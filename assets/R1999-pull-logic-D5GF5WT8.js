function C(t,n,s){const a=t.length-2;let e=t.length-1,o=t[e-1].bannerCount+1,u=Array.from({length:o},()=>({pullsSum:0,rankUpSum:0})),p=Array(o).fill(0);w(t,u);for(let h=a;h>=0;h--)t[h].isEmpty||(k(n,h,t,s,0,p),A(u,p));return u}function w(t,n){for(let s=0;s<t.length-1;s++){let a=t[s].bannerCount,e=0;for(let o=0;o<t[s].states.length;o++)for(const[u,p]of t[s].states[o])e+=p.prob;n[a].pullsSum+=e}}function A(t,n){for(let s=0;s<t.length;s++)t[s].rankUpSum=n[s]}function K(t,n,s){const a=t.length-2;for(let e=a;e>=0;e--){const o=t[e];o.isEmpty||v(n,e,t,s,o.type)}}function k(t,n,s,a,e,o){const u=s[n].states.length;let p=.5;const h=s[n].states,r=s[n].bannerCount,m=s[n+1].states;for(let i=u-1;i>=0;i--){const M=h[i],c=i>=a,g=t[i-a*c];for(const[f,U]of M){const x=U.prob*g,N=U.prob-x;let b=x;if(b>1e-10){c||(b*=p);const l=m[e],E=l.get(f);E?E.prob+=b:l.set(f,{prob:b}),o[r]+=b}if(!c){let l=x*(1-p);if(l>1e-10){let E=f+1;const L=h[a],P=L.get(E);P?P.prob+=l:L.set(E,{prob:l})}}let y=N;if(y>1e-10){const l=h[i+1],E=l.get(f);E?E.prob+=y:l.set(f,{prob:y})}U.prob=0}}return o}function B(t,n,s){let a;for(let e=0;e<t.length;e++){const o=s[e].pullsSum,u=s[e].rankUpSum,p=o-u,h=t[e].length-1;for(let r=h;r>=0;r--){const m=t[e][r].states;for(let i=1;i>=0;i--){a=i===1;let M=m[i];if(M.length===11){for(let c=9;c>=0;c--)for(const[g,f]of M[c]){const U=f.prob;if(U*o>1e-10){f.prob=U*(1-o);let N=!1;c===9&&(N=!0);let b=n;N&&(b=1);const y=U*b*p,l=U*(1-b)*p,E=U*u;if(y>1e-10){let L=y;if(a||(L*=.5),t[e][r+1]===void 0)t[e].push({states:Array.from({length:2},()=>new Map)}),t[e][r+1].states[0].set(g,{prob:L});else{const P=t[e][r+1].states[0],V=P.get(g);V?V.prob+=L:P.set(g,{prob:L})}if(!a){let P=g+1;const V=m[1],_=V.get(P);_?_.prob+=L:V.set(P,{prob:L})}}if(l>1e-10){const L=m[i][c+1],P=L.get(g);P?P.prob+=l:L.set(g,{prob:l})}if(E>1e-10){const L=m[0][10],P=L.get(g);P?P.prob+=E:L.set(g,{prob:E})}}}M=M[10]}for(const[c,g]of M){const f=g.prob;if(f*o>1e-10){const x=f*n*p,N=f*(1-n)*p+f*u;if(g.prob=f*(1-o)+N,x>1e-10){let b=x;if(a||(b*=.5),t[e][r+1]===void 0)t[e].push({states:Array.from({length:2},()=>new Map)}),t[e][r+1].states[0].set(c,{prob:b});else{const y=t[e][r+1].states[0],l=y.get(c);l?l.prob+=b:y.set(c,{prob:b})}if(!a){let y=c+1;const l=m[1],E=l.get(y);E?E.prob+=b:l.set(y,{prob:b})}}}}}}}}function v(t,n,s,a,e){const o=s[n].states.length;let u=.5;const p=s[n].states,h=s[n+1].states;for(let r=o-1;r>=0;r--){const m=p[r],i=r>=a,M=t[r-a*i],c=m*M,g=m-c;let f=c;if(f>1e-10&&(i||(f*=u),h[e]+=f),!i){let x=c*(1-u);x>1e-10&&(p[a]+=x)}let U=g;U>1e-10&&(p[r+1]+=U),p[r]=0}}export{v as handleSSRCheap,B as rankUpSR,C as rankUpSSR,K as rankUpSSRCheap};

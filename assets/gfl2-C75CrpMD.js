import{e as m,f as v,T as g,h as R,i as y,j as k,l as T,k as P,m as d,n as S,s as C,u as A,q as E}from"./cashback-dbOUira0.js";/* empty css               */import{W as L,g as I}from"./WorkerManager-BG9FWqhX.js";import{c as D,n as _,s as O,a as F,b as N,d as x,r as z,e as H,m as W,f as w}from"./commonPullLogic-YZi-tjpG.js";class M{constructor(t){this.parts=t,this.persistence=m("gfl2");const e=v({cashbackCalculator:this.parts.cashbackFn,uiUpdater:this.parts.updateTableFn}),n={calculatorFunction:this.parts.runCalcFn,calculatorConfig:{gachaConfig:this.parts.gachaConfig,CONSTELLATION_MAP:this.parts.CONSTELLATION_MAP},postCalculationHooks:[e]};this.validator=new g(this.parts.CONSTELLATION_MAP),this.calculationHandler=R(n,this.persistence),this.calculateBtn=document.getElementById("calculate-btn"),this.exportBtn=document.getElementById("export-btn")}initialize(){this.validator.initialize(),y(this.persistence,this.parts.gachaConfig,this.validator),k(),this.#t(),this.#i()}#t(){if(!this.calculateBtn){console.error("Calculate button not found!");return}this.calculateBtn.addEventListener("click",()=>{this.#a()&&this.calculationHandler()}),this.exportBtn&&this.exportBtn.addEventListener("click",()=>T(this.persistence)),P(this.persistence,null,this.validator)}#a(){if(document.querySelectorAll(".is-invalid").forEach(i=>i.classList.remove("is-invalid")),this.validator.isDataValid())return!0;console.warn("Validation failed. Calculation blocked."),this.validator.validateAll();const t=document.querySelectorAll(".is-invalid"),e=new Set;t.forEach(i=>{const h=i.closest(".tab-pane");if(h){const u=document.querySelector(`.tab-link[data-tab-target="#${h.id}"]`);u&&e.add(u)}i.classList.add("flicker"),i.addEventListener("animationend",()=>i.classList.remove("flicker"),{once:!0})}),e.forEach(i=>{i.classList.add("is-invalid","flicker"),i.addEventListener("animationend",()=>i.classList.remove("flicker"),{once:!0})});const n=Array.from(e)[0];return n&&n.click(),setTimeout(()=>{t[0]?.scrollIntoView({behavior:"smooth",block:"center"})},100),!1}#i(){const t=this.persistence.loadCalculation(),e=t?t.input:null;t?(d(this.parts.gachaConfig.paths,e),S(t),C(t.persistInput)):(d(this.parts.gachaConfig.paths),S(),C()),this.calculationHandler()}}const o=[.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.056,.106,.156,.206,.256,.306,.356,.406,.456,.506,.556,.606,.656,.706,.756,.806,.856,.906,.956,1],r=[.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.057,.107,.157,.207,.257,.307,.357,.407,.457,.507,.557,.607,.657,.707,.757,.807,.857,.907,.957,1],l=[.06,.06,.06,.06,.06,.06,.06,.06,.06,1],s={maxCharacterConstelation:6,rateUpCharacterSR:2,rateUpWeaponSR:3,poolStandardCharSSR:6,poolCharSR:9,configSR:{maxType:7,regularPoints:.4,specialPoints:1},configSSR:{maxType:7,regularPoints:2,specialPoints:5},configWep:{pointsSR:1,pointsSSR:2},paths:{char:["None","v0","v1","v2","v3","v4","v5","v6"],wep:["None","c1","c2","c3","c4","c5","c6"]},pity:{pitySSRChar:o.length,pitySSRWep:r.length,pitySRChar:l.length,pitySRWep:l.length},default:0},B={none:0,v0:1,v1:2,v2:3,v3:4,v4:5,v5:6,v6:7},U="common",c=s.pity.pitySSRChar,p=s.pity.pitySSRWep,f=s.pity.pitySRChar,b={CHARACTER:c*2+1,WEAPON:p*2+1,SR:f*2+1},G={distributionArrays:{makeSSR:(a,t)=>w(a,t,b),makeSR:a=>W(a,b),sortPity:a=>H(a,s.pity)},pullLogic:{rankUpSSRCheap:(a,t)=>z(a,o,r,c,p,t)},workerManager:new L,contexts:{contextSSR:{ODDS_CHARACTER_SSR:o,ODDS_WEAPON_SSR:r,SSR_CHAR_PITY:c,SSR_WEP_PITY:p},contextSR:{ODDS_SR:l,SR_PITY:f},moduleType:U},helpers:{consolidateDistributionForCashback:x,consolidateProbabilitiesCheap:N,consolidateProbabilities:F,simplifyDistribution:O,normalizeCheap:_,checkIsEmpty:D}};async function V(a,t){return new I(s,G).runGachaCalculation(a,t)}document.addEventListener("DOMContentLoaded",()=>{const a={gachaConfig:s,CONSTELLATION_MAP:B,runCalcFn:V,cashbackFn:E,updateTableFn:A};new M(a).initialize()});

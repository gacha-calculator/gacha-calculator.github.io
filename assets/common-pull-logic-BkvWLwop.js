function E(t,a,i){if(!Array.isArray(t.SSR.pullPlan))throw new Error("Invalid pull plan");const{pullPlan:n}=t.SSR,r=[];for(const[o,s]of n.entries())s.type==="char"?r.push({states:Array.from({length:i.CHARACTER},()=>new Map),type:"Character",isEmpty:!0}):r.push({states:Array.from({length:i.WEAPON},()=>new Map),type:"Weapon",isEmpty:!0});return r.push({states:Array.from({length:1},()=>new Map)}),c(a),{distributionSSR:r};function c(o){r[0].states[o[0]].set(0,{prob:1}),r[0].isEmpty=!1}}function W(t,a){const i=a.pitySSRChar,n=a.pitySSRWep;let r=!1,c=!1,o=0,s=0;const e=[];o+=t.SSR.pity.char,o+=t.SSR.guarantee.char*i,s+=t.SSR.pity.wep,s+=t.SSR.guarantee.wep*n;for(const p of t.SSR.pullPlan)p==0&&!r?(r=!0,e.push(o)):p==1&&!c?(c=!0,e.push(s)):e.push(0);return e.push(0),e}function C(t,a){const n=(a.SR-1)/2,r=[{states:Array.from({length:a.SR},()=>new Map)}],c=[{states:Array.from({length:a.SR},()=>new Map)}],o=t.SR.guarantee.char*n+t.SR.pity.char,s=t.SR.guarantee.wep*n+t.SR.pity.wep;e(r[0].states[o]),e(c[0].states[s]);function e(p){p.set(0,{prob:1})}return{distributionCharSR:r,distributionWepSR:c}}const f=1e-10;function U(t,a,i,n,r,c){const o=t.length-2;for(let s=o;s>=0;s--){const e=t[s],p=c[s+1];if(!e.isEmpty)if(e.type==="Character")A(a,s,t,n,e.type,p);else if(e.type==="Weapon")A(i,s,t,r,e.type,p);else throw new Error(`Unknown SSR array type: ${e.type}`)}}function A(t,a,i,n,r,c){const o=i[a].states.length,s=.5,e=.75;let p=.5;r==="Character"?p=s:r==="Weapon"&&(p=e);const S=i[a].states,P=i[a+1].states;for(let l=o-2;l>=0;l--){const u=S[l],y=l>=n,d=t[l-n*y],h=u*d,m=u-h;let R=h;if(R>f&&(y||(R*=p),P[c]+=R),!y){let b=h*(1-p);b>f&&(S[n]+=b)}let w=m;w>f&&(S[l+1]+=w),S[l]=0}}export{E as a,C as m,U as r,W as s};

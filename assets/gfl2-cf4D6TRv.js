import{e as k,f as y,T as A,h as L,i as E,j as D,l as I,k as O,m as b,n as R,s as f,u as N,q as F}from"./cashback-D3emIPJs.js";/* empty css               */import{s as W,m as _,a as w,r as B,b as v}from"./pullLogic-C2ZBZaH4.js";import{a as o,c as H,s as x}from"./commonHelpers-BPDag3E6.js";class z{constructor(t){this.parts=t,this.persistence=k("gfl2");const i=y({cashbackCalculator:this.parts.cashbackFn,uiUpdater:this.parts.updateTableFn}),s={calculatorFunction:this.parts.runCalcFn,calculatorConfig:{gachaConfig:this.parts.gachaConfig,CONSTELLATION_MAP:this.parts.CONSTELLATION_MAP},postCalculationHooks:[i]};this.validator=new A(this.parts.CONSTELLATION_MAP),this.calculationHandler=L(s,this.persistence),this.calculateBtn=document.getElementById("calculate-btn"),this.exportBtn=document.getElementById("export-btn")}initialize(){this.validator.initialize(),E(this.persistence,this.parts.gachaConfig,this.validator),D(),this.#t(),this.#i()}#t(){if(!this.calculateBtn){console.error("Calculate button not found!");return}this.calculateBtn.addEventListener("click",()=>{this.#a()&&this.calculationHandler()}),this.exportBtn&&this.exportBtn.addEventListener("click",()=>I(this.persistence)),O(this.persistence,null,this.validator)}#a(){if(document.querySelectorAll(".is-invalid").forEach(a=>a.classList.remove("is-invalid")),this.validator.isDataValid())return!0;console.warn("Validation failed. Calculation blocked."),this.validator.validateAll();const t=document.querySelectorAll(".is-invalid"),i=new Set;t.forEach(a=>{const n=a.closest(".tab-pane");if(n){const l=document.querySelector(`.tab-link[data-tab-target="#${n.id}"]`);l&&i.add(l)}a.classList.add("flicker"),a.addEventListener("animationend",()=>a.classList.remove("flicker"),{once:!0})}),i.forEach(a=>{a.classList.add("is-invalid","flicker"),a.addEventListener("animationend",()=>a.classList.remove("flicker"),{once:!0})});const s=Array.from(i)[0];return s&&s.click(),setTimeout(()=>{t[0]?.scrollIntoView({behavior:"smooth",block:"center"})},100),!1}#i(){const t=this.persistence.loadCalculation(),i=t?t.input:null;t?(b(this.parts.gachaConfig.paths,i),R(t),f(t.persistInput)):(b(this.parts.gachaConfig.paths),R(),f()),this.calculationHandler()}}const g=[.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.056,.106,.156,.206,.256,.306,.356,.406,.456,.506,.556,.606,.656,.706,.756,.806,.856,.906,.956,1],P=[.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.057,.107,.157,.207,.257,.307,.357,.407,.457,.507,.557,.607,.657,.707,.757,.807,.857,.907,.957,1],c=[.06,.06,.06,.06,.06,.06,.06,.06,.06,1],r={maxCharacterConstelation:6,rateUpCharacterSR:2,rateUpWeaponSR:3,poolStandardCharSSR:6,poolCharSR:9,configSR:{maxType:7,regularPoints:.4,specialPoints:1},configSSR:{maxType:7,regularPoints:2,specialPoints:5},configWep:{pointsSR:1,pointsSSR:2},paths:{char:["None","v0","v1","v2","v3","v4","v5","v6"],wep:["None","r1","r2","r3","r4","r5"]},pity:{pitySSRChar:g.length,pitySSRWep:P.length,pitySRChar:c.length,pitySRWep:c.length},default:0},U={none:0,v0:1,v1:2,v2:3,v3:4,v4:5,v5:6,v6:7};function M(e){const t={CHARACTER:r.pity.pitySSRChar*2+1,WEAPON:r.pity.pitySSRWep*2+1,SR:r.pity.pitySRChar*2+1,FINAL:1},i=W(e,t);let s={char:{},wep:{}};const{distributionSSR:a}=_(e,i,t),{distributionCharSR:n,distributionWepSR:l}=w(e,t);let p=[],h=[],u=[],d=0;for(;d<.999;){B(a,g,P,i,e.SSR.pullPlan,s,t),v(s.char,n,c,t),v(s.wep,l,c,t);let C=0;for(let T of a[a.length-1])C+=T.totalSum;d=C,p.push(o(a)),h.push(o(l)),u.push(o(n))}const m=o(n);let S=H(m);return S=x(S,r.rateUpCharacterSR),{SSR:p,WepSR:h,CharSR:u}}document.addEventListener("DOMContentLoaded",()=>{const e={gachaConfig:r,CONSTELLATION_MAP:U,runCalcFn:M,cashbackFn:F,updateTableFn:N};new z(e).initialize()});

function C(e,o,n){const a=e.length-2;let t=e.length-1,l=e[t-1].bannerCount+1,P=Array(l).fill(0),b=Array(l).fill(0);V(e,P);for(let r=a;r>=0;r--)e[r].isEmpty||(k(o,r,e,n,0,b),_(P,b));return P}function V(e,o){for(let n=0;n<e.length-1;n++){let a=e[n].bannerCount,t=0;for(let l=0;l<e[n].states.length;l++)for(const[P,b]of e[n].states[l])t+=b.prob;o[a]+=t}}function _(e,o){for(let n=0;n<e.length;n++)e[n]-=o[n]}function O(e,o,n){const a=e.length-2;for(let t=a;t>=0;t--){const l=e[t];l.isEmpty||w(o,t,e,n,l.type)}}function k(e,o,n,a,t,l){const P=n[o].states.length;let b=.5;const r=n[o].states,p=n[o].bannerCount,y=n[o+1].states;for(let E=P-2;E>=0;E--){const M=r[E],c=E>=a,i=e[E-a*c];for(const[s,f]of M){const g=f.prob*i,h=f.prob-g;let L=g;if(L>1e-10){c||(L*=b);const u=y[t],x=u.get(s);x?x.prob+=L:u.set(s,{prob:L}),l[p]+=L}if(!c){let u=g*(1-b);if(u>1e-10){let x=s+1;const A=r[a],N=A.get(x);N?N.prob+=u:A.set(x,{prob:u})}}let U=h;if(U>1e-10){const u=r[E+1],x=u.get(s);x?x.prob+=U:u.set(s,{prob:U})}f.prob=0}}return l}function m(e,o,n){let a;for(let t=0;t<e.length;t++){const l=n[t],P=o*l,b=e[t].length-1;for(let r=b;r>=0;r--){const p=e[t][r].states;for(let y=1;y>=0;y--){a=y===1;let E=P;a||(E*=.5);const M=p[y];if(M.length===10)for(let c=9;c>=0;c--)for(const[i,s]of M[c]){let f=!1;c===9&&(f=!0);let g=E;f&&(g=1);const h=s.prob*g;if(h>1e-10){if(e[t][r+1]===void 0)e[t].push({states:Array.from({length:2},()=>new Map)}),e[t][r+1].states[0].set(i,{prob:h});else{const L=e[t][r+1].states[0],U=L.get(i);U?U.prob+=h:L.set(i,{prob:h})}if(a)s.prob-=h;else{let L=i+1;const U=p[1],u=U.get(L);u?u.prob+=h:U.set(L,{prob:h}),s.prob-=2*h}if(s.prob>0&&!f){const L=p[y][c+1],U=L.get(i);U?U.prob+=s.prob:L.set(i,{prob:s.prob}),s.prob=0}}}else for(const[c,i]of M){const s=i.prob*E;if(s>1e-10){if(e[t][r+1]===void 0)e[t].push({states:Array.from({length:2},()=>new Map)}),e[t][r+1].states[0].set(c,{prob:s});else{const f=e[t][r+1].states[0],g=f.get(c);g?g.prob+=s:f.set(c,{prob:s})}if(a)i.prob-=s;else{let f=c+1;const g=p[1],h=g.get(f);h?h.prob+=s:g.set(f,{prob:s}),i.prob-=2*s}}}}}}}function w(e,o,n,a,t){const l=n[o].states.length;let P=.5;const b=n[o].states,r=n[o+1].states;for(let p=l-2;p>=0;p--){const y=b[p],E=p>=a,M=e[p-a*E],c=y*M,i=y-c;let s=c;if(s>1e-10&&(E||(s*=P),r[t]+=s),!E){let g=c*(1-P);g>1e-10&&(b[a]+=g)}let f=i;f>1e-10&&(b[p+1]+=f),b[p]=0}}export{w as handleSSRCheap,m as rankUpSR,C as rankUpSSR,O as rankUpSSRCheap};

(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class pe{constructor({getPageConfiguration:e,getLabels:t,getPullPlan:r,getTarget:i,updateChart:n,convertToChartData:a,recalcInputs:s,calculatorFunction:l,calculatorConfig:u,pageConfig:c,postCalculationHooks:h,persistence:d,chibi:p}){this.getPageConfiguration=e,this.getLabels=t,this.getPullPlan=r,this.getTarget=i,this.updateChart=n,this.convertToChartData=a,this.recalcInputs=s,this.calculatorFunction=l,this.calculatorConfig=u,this.pageConfig=c,this.postCalculationHooks=h||[],this.persistence=d,this.chibi=p}async runCalculation(){const e=this.getTarget(),t=this.getPageConfiguration(this.calculatorConfig.CONSTELLATION_MAP,this.calculatorConfig.gachaConfig,this.pageConfig.SELECTORS,this.pageConfig.INITIAL_CONFIG),r=this.getLabels(this.calculatorConfig.gachaConfig.paths);if(r.length>99){this.chibi.showError("Too many items! Even I can't calculate so quickly, maximum 99 items allowed.");return}const i=await this.calculatorFunction(t,e),n=this.convertToChartData(i.chartData);this.updateChart(n.data,n.labels,r),this.recalcInputs(n.data);const a={results:i,inputConfig:t,chartLabels:r,gachaConfig:this.calculatorConfig.gachaConfig,CONSTELLATION_MAP:this.calculatorConfig.CONSTELLATION_MAP};if(this.postCalculationHooks.forEach(s=>s(a)),this.persistence){const s=parseInt(document.querySelector('[data-control="pulls"]').value),l=parseInt(document.querySelector('[data-control="probability"]').value);this.persistence.saveCalculation({input:this.getPullPlan(),targetProb:l,targetPull:s,persistInput:document.querySelector(".mode-label.active").getAttribute("data-target")}),this.persistence.saveButtons()}}}function fe(o,e,t,r,i,n){$(e.pity,r,n),_(e,r,n),U(i);const a=o.loadTables();a&&(I(a.pity,n),P(a.constellation,n),z(a.rateUps),t.validateAll()),o.init()}function ye(o){const e=o.loadButtons();e&&e.isHidden&&W()}function $(o,e,t){const r=document.getElementById("pity-row-template"),i=document.querySelector(`${t.PITY_TABLE} tbody`);Object.entries(e.pitySettings).forEach(([n,a])=>{const s=r.content.cloneNode(!0).querySelector("tr"),l=s.querySelector(".special-mechanic");s.dataset.validationType="individual";const u=s.querySelector('[data-control="pity-4"]'),c=s.querySelector('[data-control="pity-5"]');if(u&&(u.min=0,u.max=n.includes("weapon")?o.pitySRWep-1:o.pitySRChar-1),c&&(c.min=0,c.max=n.includes("weapon")?o.pitySSRWep-1:o.pitySSRChar-1),s.dataset.banner=n,s.querySelector(".banner-name").textContent=n,s.querySelector('[data-control="pity-4"]').value=a.pity4,s.querySelector('[data-control="pity-5"]').value=a.pity5,l){let d="";n==="character"?d=`<div class="button-container">
            <input type="number" data-control="capRad" class="custom-input" min="0" max="3" 
                   value="${a.caprad??0}">
                            <button class="help-btn" data-help-key="caprad-help"
                                aria-label="Help for Importing Pity Data">
                                ?
                            </button>
                        </div>`:n==="weapon"&&(d=`<div class="button-container">
            <input type="number" data-control="epPath" class="custom-input" min="0" max="1" 
                   value="${a.epPath??0}">
                            <button class="help-btn" data-help-key="eppath-help"
                                aria-label="Help for Importing Pity Data">
                                ?
                            </button>
                        </div>`),l.innerHTML=d}i.appendChild(s);const h=document.querySelector("#pity-table");h&&h.querySelectorAll('tbody tr input[type="number"]').forEach(d=>d.addEventListener("input",function(){let p=this.value;p.length>1&&p.startsWith("0")&&(this.value=p.replace(/^0+/,""),this.value===""&&(this.value="0"));let y=parseInt(this.value)||0;y>d.max?(this.value=d.max,C(this)):y<d.min&&(this.value=d.min,C(this))}))})}function _(o,e,t){const r=document.getElementById("const-column-template"),i=document.querySelectorAll(`${t.CONSTELLATION_TABLE} tbody tr`),n=o.poolStandardCharSSR,a=o.poolCharSR;i.forEach(s=>{const l=document.createDocumentFragment(),u=s.dataset.rarity;s.dataset.validationType="row-sum",s.dataset.targetSum=u==="5"?n:a;for(let c=0;c<e.constellationColumns;c++){const h=r.content.cloneNode(!0),d=h.querySelector("input");if(c===0){const p=u==="5"?n:a;d.value=p}d.addEventListener("input",()=>A(s)),d.addEventListener("input",function(){d.value.length>1&&d.value.startsWith("0")&&(d.value=d.value.replace(/^0+/,"")),d.value===""&&(d.value="0")}),l.appendChild(h)}s.appendChild(l),D(s),A(s)})}function D(o){const e=document.createElement("div");e.className="row-progress-bar",o.appendChild(e)}function A(o){const e=o.querySelectorAll("input"),t=parseInt(o.dataset.targetSum);let r=0;e.forEach(a=>{r+=parseInt(a.value)||0});const i=o.querySelector(".row-progress-bar"),n=Math.min(r/t*100,100);i.style.width=n+"%",n<60||r>t?i.style.background="rgba(244, 67, 54, 0.3)":n<80?i.style.background="rgba(241, 244, 54, 0.3)":i.style.background="rgba(54, 244, 79, 0.3)"}function U(o){const e=document.querySelectorAll("#rate-up-table select");if(e.length===0)return;const t=o.map(r=>`<option value="${r.value}">${r.text}</option>`).join("");e.forEach(r=>{r.innerHTML=t,r.value="unknown"})}function me(o,e=null){const t=document.querySelector('[data-control="probability"]'),r=document.querySelector('[data-control="pulls"]');e?(t.value=e.targetProb||o.probability,r.value=e.targetPull||o.pulls):(t.value=o.probability,r.value=o.pulls),t.addEventListener("input",function(){let i=this.value;i.length>1&&i.startsWith("0")&&(this.value=i.replace(/^0+/,""),this.value===""&&(this.value="0"));let n=parseInt(this.value)||0;n?(this.value="100",C(this)):n===0&&(this.value="0")}),r.addEventListener("input",function(){let i=this.value;i.length>1&&i.startsWith("0")&&(this.value=i.replace(/^0+/,""),this.value===""&&(this.value="0"));let n=parseInt(this.value)||0;n>9999?this.value="9999":n<1&&(this.value="1")})}function C(o){o.style.borderColor="#a71919",o.style.outline="1px solid #a71919",o.classList.add("flicker"),setTimeout(()=>{o.classList.remove("flicker"),o.style.borderColor="",o.style.outline=""},500)}function ge(o,e,t){const r=[];for(let n=0;n<o.length;n++){let a=0;for(const[s,l]of o[n].offRates)a+=l.prob;a=(a*100).toFixed(2),a>0&&r.push({name:e[n],probability:a,p10:t[n].LOWER_BOUND,mean:t[n].MEAN,p90:t[n].UPPER_BOUND,color:"#3498db"})}const i=document.querySelector("#probability-table tbody");i.innerHTML="",r.forEach(n=>{const a=document.createElement("tr"),s=n.probability;a.innerHTML=`
      <td>${n.name}</td>
      <td>
        <div class="progress-container">
          <div class="progress-bar" style="width:${s}%;background:${n.color}">
            <div class="progress-label">${n.probability}%</div>
          </div>
        </div>
      </td>
      <td class="cashback-value">${n.p10.toFixed(1)}</td>
      <td class="cashback-value highlight">${n.mean.toFixed(1)}</td>
      <td class="cashback-value">${n.p90.toFixed(1)}</td>
    `,i.appendChild(a)})}function I(o,e){o.forEach(t=>{const r=document.querySelector(`${e.PITY_TABLE} tr[data-banner="${t.banner}"]`);r&&(r.querySelector('[data-control="pity-4"]').value=t.pity4,r.querySelector('[data-control="pity-5"]').value=t.pity5,r.querySelector(".guarantee-4").checked=t.guarantee4,r.querySelector(".guarantee-5").checked=t.guarantee5,t.caprad&&r.querySelector('[data-control="capRad"]')&&(r.querySelector('[data-control="capRad"]').value=t.caprad),t.epPath&&r.querySelector('[data-control="epPath"]')&&(r.querySelector('[data-control="epPath"]').value=t.epPath))})}function P(o,e){document.querySelectorAll(`${e.CONSTELLATION_TABLE} tbody tr`).forEach((r,i)=>{const n=o[i];n&&r.querySelectorAll("td:nth-child(n+2) input").forEach((s,l)=>{n[l]!==void 0&&(s.value=n[l])})})}function z(o){if(!o||!Array.isArray(o))return;document.querySelectorAll("#rate-up-table select.custom-select").forEach((t,r)=>{o[r]!==void 0&&(t.value=o[r])})}function W(){document.querySelectorAll(".help-btn").forEach(e=>{e.classList.toggle("hidden")})}const G=[.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.015,.04,.065,.09,.115,.14,.165,.19,.215,.24,1],be=.085,ve={maxCharacterConstelation:5,rateUpCharacterSR:2,poolStandardCharSSR:40,poolCharSR:23,configSR:{maxType:6,regularPoints:.3,specialPoints:.7},configSSR:{maxType:6,regularPoints:1.2,specialPoints:2.8},paths:{char:["None","p0","p1","p2","p3","p4","p5"]},pity:{pitySSR:G.length,pitySR:10},default:0},F=[{value:"unknown",text:"Unknown"},{value:"none",text:"Not Owned"},{value:"p0",text:"P0"},{value:"p1",text:"P1"},{value:"p2",text:"P2"},{value:"p3",text:"P3"},{value:"p4",text:"P4"},{value:"p5",text:"P5"},{value:"new",text:"New Character"}],Se={none:0,p0:1,p1:2,p2:3,p3:4,p4:5,p5:6},Te=["1.0","1.1","1.2","1.3","1.4","1.5","1.6","1.7","1.8","1.9","2.0","2.1","2.2","2.3","2.4","2.5","2.6","2.7","AC","2.8","3.0"],Ce={"One Gram of Curiosity":{char:"Sotheby",release:"1.0"},"Clang of Sword & Armor":{char:"A Knight",release:"1.0"},"Pop is Everything":{char:"Melania",release:"1.1"},"Thus Spoke The Border Collie":{char:"Pickles",release:"1.1"},"The Fairies Shining at Night":{char:"Tooth Fairy",release:"1.2"},"The Changeling Awaits":{char:"Jessica",release:"1.2"},"That Steady Evening Star":{char:"Kaalaa Baunaa",release:"1.3"},"Another Spring Thaw":{char:"Shamane",release:"1.3"},"Beyond the World of Matters":{char:"37",release:"1.4"},"Seeker in the Cave":{char:"6",release:"1.4"},"The Chirps of Flame":{char:"Spathodea",release:"1.5"},"The Spores of Peace":{char:"Ezra Theodore",release:"1.5"},"Over the New Leaf":{char:"Getian",release:"1.6"},"Vissi D'arte, Vissi D'amore":{char:"Isolde",release:"1.7"},"Reading in Sea Breeze":{char:"Marcus",release:"1.7"},"Ode to the Utopia":{char:"Vila",release:"1.8"},"The Intersecting Lines":{char:"Windsong",release:"1.8"},"Into the Mirrors":{char:"Kakania",release:"1.9"},"Calming Hues in Frenzied Nights":{char:"Mercuria",release:"2.0"},"Clash n' Slash":{char:"J",release:"2.0"},"Blue Lullaby":{char:"Tuesday",release:"2.1"},"Shooting in the Dark":{char:"Argus",release:"2.1"},"Fledgling's First Flight":{char:"Lopera",release:"2.2"},"When the Swan Dances":{char:"Willow",release:"2.3"},"The Book of Whys":{char:"Flutterpage",release:"2.3"},"Playing in Rainbow Clef":{char:"Barcarola",release:"2.4"},"A Shell on the Waves":{char:"Fatutu",release:"2.4"},"A Life in Montage":{char:"Noire",release:"2.5"},"A Writing Writer Written":{char:"Recoleta",release:"2.6"},"The Shattered Product":{char:"Aleph",release:"2.6"},"Serpentine Century":{char:"Hissabeth",release:"2.7"},"Wirewalking in Zero Gravity":{char:"Kiperina",release:"2.7"},"From the Ruin of the Past":{char:"Moldir",release:"2.8"},"A Beating Heart Beneath the Stone":{char:"Sentinel",release:"3.0"},"The Mourner's Eulogy":{char:"Charon",release:"3.0"}},V={CHARACTER:"character"},S={PITY_ROW:"[data-banner]",CONSTELLATION_ROW:"[data-rarity]",PITY_TABLE:"#pity-table",CONSTELLATION_TABLE:"#constellation-table"},E={pitySettings:{[V.CHARACTER]:{pity4:0,pity5:0}},isCharacter:!0,isWeapon:!1,isSpecial:!1,constellationColumns:7},Ee={probability:70,pulls:76};function we(o,e,t){Y(e.pity),j(e),J();const r=o.loadTables();r&&(O(r.pity),R(r.constellation),K(r.rateUps),t.validateAll()),o.init()}function Y(o){const e=document.getElementById("pity-row-template"),t=document.querySelector(`${S.PITY_TABLE} tbody`);Object.entries(E.pitySettings).forEach(([i,n])=>{const a=e.content.cloneNode(!0).querySelector("tr");a.dataset.validationType="individual";const s=a.querySelector('[data-control="pity-5"]');s&&(s.min=0,s.max=o.pitySSR-1),a.dataset.banner=i,a.querySelector(".banner-name").textContent=i,a.querySelector('[data-control="pity-5"]').value=n.pity5,t.appendChild(a)});const r=document.querySelector("#pity-table");r&&r.querySelectorAll('tbody tr input[type="number"]').forEach(i=>i.addEventListener("input",function(){let n=this.value;n.length>1&&n.startsWith("0")&&(this.value=n.replace(/^0+/,""),this.value===""&&(this.value="0"));let a=parseInt(this.value)||0;a>i.max?(this.value=i.max,q(this)):a<=i.min&&(this.value=i.min,q(this))}))}function q(o){o.style.borderColor="#a71919",o.style.outline="1px solid #a71919",o.classList.add("flicker"),setTimeout(()=>{o.classList.remove("flicker"),o.style.borderColor="",o.style.outline=""},500)}function j(o){const e=document.getElementById("const-column-template"),t=document.querySelectorAll(`${S.CONSTELLATION_TABLE} tbody tr`),r=o.poolStandardCharSSR,i=o.poolCharSR;t.forEach(n=>{const a=document.createDocumentFragment(),s=n.dataset.rarity;n.dataset.validationType="row-sum",n.dataset.targetSum=s==="5"?r:i;for(let l=0;l<E.constellationColumns;l++){const u=e.content.cloneNode(!0),c=u.querySelector("input");if(l===E.constellationColumns-1){const h=s==="5"?r:i;c.value=h}c.addEventListener("input",()=>x(n)),c.addEventListener("input",function(){c.value.length>1&&c.value.startsWith("0")&&(c.value=c.value.replace(/^0+/,"")),c.value===""&&(c.value="0")}),a.appendChild(u)}n.appendChild(a),X(n),x(n)})}function X(o){const e=document.createElement("div");e.className="row-progress-bar",o.appendChild(e)}function x(o){const e=o.querySelectorAll("input"),t=parseInt(o.dataset.targetSum);let r=0;e.forEach(a=>{r+=parseInt(a.value)||0});const i=o.querySelector(".row-progress-bar"),n=Math.min(r/t*100,100);i.style.width=n+"%",n<60||r>t?i.style.background="rgba(244, 67, 54, 0.3)":n<80?i.style.background="rgba(241, 244, 54, 0.3)":i.style.background="rgba(54, 244, 79, 0.3)"}function J(){const o=document.querySelectorAll("#rate-up-table select");if(o.length===0)return;const e=F.map(t=>`<option value="${t.value}">${t.text}</option>`).join("");o.forEach(t=>{t.innerHTML=e,t.value="unknown"})}function O(o){o.forEach(e=>{const t=document.querySelector(`${S.PITY_TABLE} tr[data-banner="${e.banner}"]`);t&&(t.querySelector('[data-control="pity-5"]').value=e.pity5,t.querySelector(".guarantee-5").checked=e.guarantee5)})}function R(o){document.querySelectorAll(`${S.CONSTELLATION_TABLE} tbody tr`).forEach((t,r)=>{const i=o[r];i&&t.querySelectorAll("td:nth-child(n+2) input").forEach((a,s)=>{i[s]!==void 0&&(a.value=i[s])})})}function K(o){if(!o||!Array.isArray(o))return;document.querySelectorAll("#rate-up-table select.custom-select").forEach((t,r)=>{o[r]!==void 0&&(t.value=o[r])})}function Ae(o,e,t,r,i){const n=document.getElementById("import-file-input");if(!n){console.error("Import file input not found!");return}const a=s=>Q(s,o,e,t,r,i);n.removeEventListener("change",n.__handleFile),n.addEventListener("change",a),n.__handleFile=a}async function Q(o,e,t,r,i,n){const a=o.target.files[0];if(a)try{let s,l=null;const u=await a.text();a.type==="application/json"?(s=JSON.parse(u),s.exportFormat==="GachaCalculatorData"?l=s:t&&(l=t(s))):a.type==="text/csv"?l=t(u,e):alert("Error: Invalid or unsupported file format."),l&&(Z(l,i),r.validateAll(),e.saveTables())}catch(s){n.showError("Something's wrong with the file you tried to use"),console.error("File import error:",s)}finally{o.target.value=""}}function Z(o,e){o.game==="reverse"?(o.pity&&O(o.pity),o.constellation&&R(o.constellation)):(o.pity&&I(o.pity,e),o.constellation&&P(o.constellation,e))}function qe(o){const e={exportFormat:"GachaCalculatorData",version:"1.0",exportedAt:new Date().toISOString(),pity:o.getPityData(),constellation:o.getConstellationData()},t=JSON.stringify(e,null,2),r=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(r),n=document.createElement("a");n.href=i;const a=new Date().toISOString().slice(0,10);n.download=`gachaCalc-data-${a}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i),console.log("Data exported successfully.")}function xe(o,e=null){const t=new N(o,e);return t.initialize(),t}function Le(o,e=null){return new ee(o,e).initialize()}class N{constructor(e,t=null){this.pathsConfig=e,this.savedData=t,this.groupColorMap=new Map,this.rowsContainer=document.querySelector(".rows-container"),this.addButton=document.getElementById("add-btn"),this.COLORS={UNIQUE_GROUP:"#f0f0f0",PRESET_HUES:[0,120,240,60,180,300]}}initialize(){this.rowsContainer.innerHTML="",this.savedData&&this.savedData.pullPlan?this.savedData.pullPlan.forEach(e=>{this.rowsContainer.appendChild(this.createRow(null,e))}):this.rowsContainer.appendChild(this.createRow()),this.addButton.addEventListener("click",()=>{this.rowsContainer.appendChild(this.createRow())})}createRow(e=null,t=null){const r=this.createRowElement();return this.setupRowEvents(r),this.initializeRowData(r,e,t),r}createRowElement(){return document.getElementById("row-template").content.cloneNode(!0).querySelector(".row")}setupRowEvents(e){const t=e.querySelector(".dropdown"),r=e.querySelector(".type-selector");this.setupDropdownHandler(e,t,r),this.setupTypeChangeHandler(e,r),this.setupButtonHandlers(e)}setupDropdownHandler(e,t,r){t.addEventListener("click",i=>{i.stopPropagation(),t.classList.toggle("dropdown--open")}),e.querySelectorAll(".dropdown__item").forEach(i=>{i.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),r.value=i.dataset.value,r.dispatchEvent(new Event("change")),t.classList.remove("dropdown--open")})}),document.addEventListener("click",i=>{t.contains(i.target)||t.classList.remove("dropdown--open")})}setupTypeChangeHandler(e,t){t.addEventListener("change",()=>{const r=t.options[t.selectedIndex],i=e.querySelector(".type-icon"),n=e.querySelector(".type-text");i.src=r.dataset.icon,n.textContent=r.textContent,this.updatePathSelector(e,t.value),this.handleTypeChangeGroupUpdate(e,t.value)})}handleTypeChangeGroupUpdate(e,t){const r=e.dataset.group;r&&!r.startsWith("unique")&&(e.dataset.group=`unique${t.charAt(0).toUpperCase()+t.slice(1)}`,e.style.setProperty("--group-color",this.COLORS.UNIQUE_GROUP))}setupButtonHandlers(e){e.querySelector(".btn--chainAdd").addEventListener("click",()=>{this.rowsContainer.appendChild(this.createRow(e))}),e.querySelector(".btn--delete").addEventListener("click",()=>{this.handleRowDeletion(e)})}handleRowDeletion(e){const t=e.dataset.group;t&&!t.startsWith("unique")&&Array.from(this.rowsContainer.querySelectorAll(".row")).filter(i=>i.dataset.group===t).length===1&&this.groupColorMap.delete(t),e.remove()}initializeRowData(e,t,r){r?this.initializeFromSavedData(e,r):t?this.initializeFromParent(e,t):this.initializeNewRow(e)}initializeFromSavedData(e,t){const r=e.querySelector(".type-selector");r.value=t.type||"char",this.updateVisualType(e,r.value),this.setGroupAndColor(e,t.group),this.updatePathSelector(e,r.value,t.from,t.to)}initializeFromParent(e,t){const r=t.dataset.group,i=t.querySelector(".type-selector").value,n=t.querySelector(".second-select").value,a=e.querySelector(".type-selector");a.value=i,this.updateVisualType(e,i),r.startsWith("unique")?this.convertToNewGroup(t,e):this.inheritExistingGroup(e,r),this.updatePathSelector(e,i,n)}convertToNewGroup(e,t){const r=this.generateNewGroupId(),i=this.getHueForGroup(r);[e,t].forEach(n=>{n.dataset.group=r,n.style.setProperty("--group-color",`hsl(${i}, 80%, 70%)`)}),this.groupColorMap.set(r,i)}inheritExistingGroup(e,t){e.dataset.group=t;const r=this.groupColorMap.get(t);r!==void 0&&e.style.setProperty("--group-color",`hsl(${r}, 80%, 70%)`)}initializeNewRow(e){const r=e.querySelector(".type-selector").value;e.dataset.group=`unique${r.charAt(0).toUpperCase()+r.slice(1)}`,e.style.setProperty("--group-color",this.COLORS.UNIQUE_GROUP),this.updatePathSelector(e,r)}updateVisualType(e,t){const r=e.querySelector(".type-selector"),i=r.options[r.selectedIndex],n=e.querySelector(".type-icon"),a=e.querySelector(".type-text");n.src=i.dataset.icon,a.textContent=i.textContent}updatePathSelector(e,t,r=null,i=null){const n=e.querySelector(".first-select"),a=e.querySelector(".second-select"),s=this.pathsConfig[t]||this.pathsConfig.char;this.populateSelect(n,s.slice(0,-1)),this.populateSelect(a,s.slice(1)),this.setInitialPathValues(n,a,s,r,i)}populateSelect(e,t){e.innerHTML="",t.forEach(r=>{const i=document.createElement("option");i.value=r,i.textContent=r,e.appendChild(i)})}setInitialPathValues(e,t,r,i,n){if(i&&r.includes(i)){e.value=i;const a=r.indexOf(i);t.value=n&&r.includes(n)&&r.indexOf(n)>a?n:r[Math.min(a+1,r.length-1)]}else e.value=r[0],t.value=r[1]}generateNewGroupId(){const e=Array.from(this.groupColorMap.keys()).map(t=>parseInt(t.replace(/\D/g,""))).filter(t=>!isNaN(t)).sort((t,r)=>t-r);for(let t=1;t<=e.length+1;t++)if(!e.includes(t))return`group${t}`;return`group${e.length+1}`}getHueForGroup(e){const t=parseInt(e.replace(/\D/g,""));return t<=this.COLORS.PRESET_HUES.length?this.COLORS.PRESET_HUES[t-1]:t*137.5%360}setGroupAndColor(e,t){if(e.dataset.group=t,t.startsWith("unique"))e.style.setProperty("--group-color",this.COLORS.UNIQUE_GROUP);else{let r=this.groupColorMap.get(t);r===void 0&&(parseInt(t.replace(/\D/g,"")),r=this.getHueForGroup(t),this.groupColorMap.set(t,r)),e.style.setProperty("--group-color",`hsl(${r}, 80%, 70%)`)}}getState(){return Array.from(this.rowsContainer.querySelectorAll(".row")).map(t=>({type:t.querySelector(".type-selector").value,from:t.querySelector(".first-select").value,to:t.querySelector(".second-select").value,group:t.dataset.group}))}}class ee extends N{constructor(e,t=null){super(e,t||null)}initialize(){return this.rowsContainer.innerHTML="",this.savedData&&this.savedData.pullPlan?this.savedData.pullPlan.forEach((e,t)=>{const r={...e,pity:this.savedData.pity4?.[t]||0,guarantee:this.savedData.guarantee4?.[t]||!1};this.rowsContainer.appendChild(this.createRow(null,r))}):this.rowsContainer.appendChild(this.createRow()),this.addButton.addEventListener("click",()=>{this.rowsContainer.appendChild(this.createRow())}),this}createRow(e=null,t=null){const r=super.createRow(e,t);return this.addPityGuaranteeToRow(r,t),r}addPityGuaranteeToRow(e,t){const r=e.querySelector('[data-control="pity-4"]'),i=e.querySelector(".guarantee-4");t&&(r&&t.pity!==void 0&&(r.value=t.pity),i&&t.guarantee!==void 0&&(i.checked=t.guarantee)),r.addEventListener("input",function(){let n=this.value;n.length>1&&n.startsWith("0")&&(this.value=n.replace(/^0+/,""),this.value===""&&(this.value="0"));let a=parseInt(this.value)||0;a>10?(this.value=10,L(this)):a<0&&(this.value=0,L(this))})}}function L(o){o.style.borderColor="#a71919",o.style.outline="1px solid #a71919",o.classList.add("flicker"),setTimeout(()=>{o.classList.remove("flicker"),o.style.borderColor="",o.style.outline=""},500)}function Ie(o=null){const e=document.querySelector('[data-control="probability"]'),t=document.querySelector('[data-control="pulls"]'),r=document.querySelectorAll(".mode-label");let i;o?i=o:i="probability",n(),r.forEach(a=>{a.addEventListener("click",function(){i=this.getAttribute("data-target"),n()})}),e.addEventListener("input",function(){i="probability",n()}),t.addEventListener("input",function(){i="pulls",n()});function n(){r.forEach(a=>{const s=a.getAttribute("data-target")===i;a.classList.toggle("active",s)})}}function Pe(){const o=document.getElementById("expand-button"),e=document.getElementById("expandedMenu");let t=null;o&&o.addEventListener("click",()=>{o.classList.toggle("dropdown--open"),e.classList.toggle("active")});const r=document.querySelectorAll(".nav-button");r.forEach(n=>{n.addEventListener("dragstart",function(a){t=this;const s=this.getBoundingClientRect(),l=a.clientX-s.left,u=a.clientY-s.top;a.dataTransfer.setDragImage(this,l,u),setTimeout(()=>{this.classList.add("dragging")},0)}),n.addEventListener("dragend",function(){this.classList.remove("dragging"),t=null,r.forEach(a=>{a.classList.remove("drop-zone")})}),n.addEventListener("dragover",function(a){a.preventDefault(),t&&t!==this&&this.classList.add("drop-zone")}),n.addEventListener("dragleave",function(){this.classList.remove("drop-zone")}),n.addEventListener("drop",function(a){if(a.preventDefault(),this.classList.remove("drop-zone"),t&&t!==this){const s=t.parentNode,l=this.parentNode,u=document.createElement("div"),c=document.createElement("div");s.insertBefore(u,t),l.insertBefore(c,this),s.insertBefore(this,u),l.insertBefore(t,c),s.removeChild(u),l.removeChild(c),te()}})}),re();const i=document.querySelector(".nav-container");i.style.opacity="1"}function te(){const o=document.querySelector(".nav-list"),e=document.querySelector(".nav-container--expanded .nav-list"),t={main:Array.from(o.children).slice(0,-1).map(r=>r.querySelector(".nav-button").getAttribute("href")),expanded:Array.from(e.children).map(r=>r.querySelector(".nav-button").getAttribute("href"))};localStorage.setItem("navOrder",JSON.stringify(t))}function re(){const o=JSON.parse(localStorage.getItem("navOrder"));if(!o)return;const e=document.querySelector(".nav-list"),t=document.querySelector(".nav-container--expanded .nav-list"),r=e.lastElementChild,i=new Map;document.querySelectorAll("li").forEach(a=>{const s=a.querySelector(".nav-button");s&&i.set(s.getAttribute("href"),a)}),Array.from(e.children).slice(0,-1).forEach(a=>a.remove()),t.innerHTML="",o.main.forEach(a=>{const s=i.get(a);s&&e.insertBefore(s,r)}),o.expanded.forEach(a=>{const s=i.get(a);s&&t.appendChild(s)})}const v={TABLES:1,CALCULATIONS:1,PULL_PLANS:1,BUTTONS:1};function Oe(o,e){if(!o)throw new Error("Persistence factory requires a namespace.");const t={TABLES:`gacha_tables_${o}_v1`,CALCULATIONS:`gacha_calc_${o}_v1`,PULL_PLANS:`gacha_plans_${o}_v1`,BUTTONS:"gacha_buttons_${namespace}_v1"};return{DEBOUNCE_TIME:1500,debug:!1,saveTimeout:null,init(){this.setupTableListeners(),window.addEventListener("beforeunload",()=>this.saveTables())},saveCalculation(r){this._save(t.CALCULATIONS,{_schema:v.CALCULATIONS,...r})},loadCalculation(){return this._validate(this._load(t.CALCULATIONS),"CALCULATIONS")},saveTables(){this._save(t.TABLES,{_schema:v.TABLES,pity:this.getPityData(),constellation:this.getConstellationData(),rateUps:this.getRateUpData()})},loadTables(){return this._validate(this._load(t.TABLES),"TABLES")},saveButtons(){this._save(t.BUTTONS,{_schema:v.BUTTONS,isHidden:this.areButtonsHidden()})},loadButtons(){return this._load(t.BUTTONS)},getPityData(){return Array.from(document.querySelectorAll(`${e.PITY_TABLE} tbody tr`)).map(r=>({banner:r.dataset.banner,...r.querySelector('[data-control="pity-4"]')&&{pity4:r.querySelector('[data-control="pity-4"]').value},...r.querySelector('[data-control="pity-5"]')&&{pity5:r.querySelector('[data-control="pity-5"]').value},...r.querySelector(".guarantee-4")&&{guarantee4:r.querySelector(".guarantee-4").checked},...r.querySelector(".guarantee-5")&&{guarantee5:r.querySelector(".guarantee-5").checked},...r.querySelector('[data-control="capRad"]')&&{caprad:r.querySelector('[data-control="capRad"]').value},...r.querySelector('[data-control="epPath"]')&&{epPath:r.querySelector('[data-control="epPath"]').value}}))},getConstellationData(){return Array.from(document.querySelectorAll(`${e.CONSTELLATION_TABLE} tbody tr`)).map(r=>Array.from(r.querySelectorAll("td:nth-child(n+2) input")).map(i=>i.value))},getRateUpData(){return Array.from(document.querySelectorAll("#rate-up-table select.custom-select")).map(r=>r.value)},areButtonsHidden(){return document.querySelector(".help-btn").classList.contains("hidden")},setupTableListeners(){const r=[`${e.PITY_TABLE} input`,`${e.CONSTELLATION_TABLE} input`,"#rate-up-table select"].join(",");document.querySelectorAll(r).forEach(i=>{i.addEventListener("input",()=>this.queueSave())})},queueSave(){clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>this.saveTables(),this.DEBOUNCE_TIME)},_save(r,i){try{localStorage.setItem(r,JSON.stringify(i))}catch(n){console.error("Storage error:",n),this._handleStorageError()}},_load(r){try{const i=localStorage.getItem(r);return i?JSON.parse(i):null}catch(i){return console.error("Load error:",i),null}},_validate(r,i){return r?typeof r._schema>"u"?r:r._schema!==v[i]?(console.warn(`Schema version mismatch for ${i}`),null):r:null},_handleStorageError(){Object.values(t).forEach(r=>{try{localStorage.removeItem(r)}catch(i){console.error("Cleanup failed:",i)}})}}}class Re{constructor(e){this.constellationMap=e,this.availableConstellationCounts=[],this.isInitialized=!1}initialize(){if(this.isInitialized)return;const e=document;e.addEventListener("focus",t=>{if(t.target.matches('input[type="number"]'))try{t.target.select()}catch(r){console.warn("Could not select text in input.",r)}},{capture:!0}),e.addEventListener("keydown",t=>{["Backspace","Delete","Tab","Escape","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(t.key)||(t.ctrlKey||t.metaKey)&&["a","c","v","x"].includes(t.key.toLowerCase())||/^\d$/.test(t.key)||t.preventDefault()}),e.addEventListener("input",t=>{const r=t.target,i=r.closest("table");if(i)switch(i.id){case"constellation-table":{const n=r.closest("tr");n&&this.validateRowSum(n),this.updateAvailableCountsCache(),this.validateRateUpEligibility();break}case"rate-up-table":{this.validateRateUpEligibility();break}}}),this.isInitialized=!0}validateAll(){document.querySelectorAll(".is-invalid").forEach(t=>t.classList.remove("is-invalid")),this.updateAvailableCountsCache();const e=document.querySelector("#constellation-table");e&&e.querySelectorAll("tbody tr").forEach(t=>this.validateRowSum(t)),this.validateRateUpEligibility()}updateAvailableCountsCache(){const e=new Array(Object.keys(this.constellationMap).length).fill(0);document.querySelectorAll('#constellation-table tbody tr[data-rarity="4"]').forEach(r=>{r.querySelectorAll('input[type="number"]').forEach((i,n)=>{e[n]+=parseInt(i.value,10)||0})}),this.availableConstellationCounts=e}getRateUpUsage(){const e=new Array(Object.keys(this.constellationMap).length).fill(0);return document.querySelectorAll("#rate-up-table select.custom-select").forEach(t=>{const r=this.constellationMap[t.value];r!==void 0&&e[r]++}),e}validateRowSum(e){if(!e.dataset.targetSum)return;const t=parseFloat(e.dataset.targetSum),r=e.querySelectorAll('input[type="number"]');let i=0;r.forEach(n=>i+=parseFloat(n.value)||0),r.forEach(n=>n.classList.toggle("is-invalid",i!==t))}validateRateUpEligibility(){const e=this.getRateUpUsage(),t=this.availableConstellationCounts.map((r,i)=>e[i]>r);document.querySelectorAll("#rate-up-table select.custom-select").forEach(r=>{const i=this.constellationMap[r.value],n=i!==void 0&&t[i];r.classList.toggle("is-invalid",n)})}isDataValid(){const e=document.querySelectorAll('#pity-table input[type="number"]');for(const r of e)if(!this.isIndividualInputValid(r))return!1;const t=document.querySelectorAll("#constellation-table tbody tr");for(const r of t)if(!this.isRowSumValid(r))return!1;return!this.isRateUpOverBudget()}isIndividualInputValid(e){if(e.value===""||/^\d+$/.test(e.value)){const t=parseInt(e.value,10),r=parseInt(e.min,10),i=parseInt(e.max,10);return(!e.hasAttribute("min")||t>=r)&&(!e.hasAttribute("max")||t<=i)}return!1}isRowSumValid(e){if(!e.dataset.targetSum)return!0;const t=parseFloat(e.dataset.targetSum),r=e.querySelectorAll('input[type="number"]');let i=0;return r.forEach(n=>i+=parseFloat(n.value)||0),i===t}isRateUpOverBudget(){const e=this.getRateUpUsage();return this.availableConstellationCounts.some((t,r)=>e[r]>t)}}function Ne(){document.querySelectorAll(".tab-nav").forEach(e=>{e.addEventListener("click",t=>{if(!t.target.matches(".tab-link[data-tab-target]"))return;const r=t.target,i=r.closest(".tab-panel-card"),n=r.dataset.tabTarget,a=i.querySelector(n);if(!a){console.error(`Tab target not found: ${n}`);return}i.querySelectorAll(".tab-link").forEach(s=>s.classList.remove("active")),i.querySelectorAll(".tab-pane").forEach(s=>s.classList.remove("active")),r.classList.add("active"),a.classList.add("active")})})}class Be{constructor(e){this.tourSteps=[],this.currentTourStepIndex=0,this.isTourActive=!1,this.isShowingHelp=!1,this.pausedTourStepIndex=-1,this.currentHighlightedElement=null,this.observers=null,this.currentDisplayConfig=null,this.boundHandleWindowResize=this.handleReposition.bind(this),this.boundHandleHighlightUpdate=this.handleHighlightUpdate.bind(this),this.container=document.createElement("div"),this.container.id="chibi-container",this.container.innerHTML=`
            <div class="chibi-tutorial-overlay-piece" data-overlay="top"></div>
            <div class="chibi-tutorial-overlay-piece" data-overlay="bottom"></div>
            <div class="chibi-tutorial-overlay-piece" data-overlay="left"></div>
            <div class="chibi-tutorial-overlay-piece" data-overlay="right"></div>
        `,this.container.innerHTML+=e,document.body.appendChild(this.container),this.overlays={top:this.container.querySelector('[data-overlay="top"]'),bottom:this.container.querySelector('[data-overlay="bottom"]'),left:this.container.querySelector('[data-overlay="left"]'),right:this.container.querySelector('[data-overlay="right"]')},this.chibiGroup=this.container.querySelector(".chibi-group"),this.bubbleText=this.container.querySelector(".bubble-text"),this.nextButton=this.container.querySelector(".btn--tutorial_next"),this.endButton=this.container.querySelector(".btn--tutorial_end"),this.handleNext=this.handleNext.bind(this),this.hide=this.hide.bind(this),this.handleReposition=this.handleReposition.bind(this),this.nextButton.addEventListener("click",this.handleNext),this.endButton.addEventListener("click",this.hide)}startTour(e){if(localStorage.setItem("tutorialSeen","true"),!e||e.length===0){console.error("ChibiTutorial: No steps provided for the tour.");return}this.tourSteps=e,this.pausedTourStepIndex===-1?this.currentTourStepIndex=0:(this.currentTourStepIndex=this.pausedTourStepIndex,this.pausedTourStepIndex=-1),this.isTourActive=!0,this.isShowingHelp=!1,this.nextButton.textContent=">>",this.endButton.style.display="inline-block",this.#o(),this.showTourStep(this.currentTourStepIndex)}showTourStep(e){if(e>=this.tourSteps.length){this.hide();return}const t=this.tourSteps[e];this.showDisplay(t)}showTutorialIfNeeded(e){localStorage.getItem("tutorialSeen")||this.startTour(e)}showDisplay(e){this.currentDisplayConfig=e,this.#r(),this.chibiGroup.classList.remove("chibi-on-left"),e.chibiSide==="left"&&this.chibiGroup.classList.add("chibi-on-left");const t=this.container.querySelector(".bubble-wrapper");t.classList.remove("bubble-wrapper--big","bubble-wrapper--small");const r=e.size;r&&t.classList.add(`bubble-wrapper--${r}`),this.bubbleText.innerHTML=e.text,this.container.style.display="block",this.container.style.height=`${document.documentElement.scrollHeight}px`;let i=null,n=!1;if(e.clickTab){const a=document.querySelector(e.clickTab);a?(a.dispatchEvent(new Event("click",{bubbles:!0})),n=!0):console.warn(`ChibiTutorial: Tab button not found for selector "${e.clickTab}".`)}if(e.action==="click"){const a=document.querySelector(e.element);a?(a.dispatchEvent(new Event("click",{bubbles:!0})),n=!0):console.error(`ChibiTutorial: Element not found for selector "${e.element}" to perform action "${e.action}".`)}if(e.element){i=document.querySelector(e.element);const a=document.querySelector(".tutorial-chibi");if(this.#e(i),!i){console.error(`ChibiTutorial: Element not found for selector "${e.element}". Skipping display.`),this.isTourActive&&this.handleNext();return}n&&setTimeout(()=>{this.currentHighlightedElement=i,this.currentHighlightedElement.classList.add("chibi-tutorial-focused-element"),this.observers&&this.observers.targetObserver&&this.observers.targetObserver.observe(this.currentHighlightedElement),this.#e(this.currentHighlightedElement)},50);const s=[i,this.chibiGroup,a];this.#n(s)}else this.#e(null),this.chibiGroup.scrollIntoView({behavior:"smooth",block:"nearest"});window.addEventListener("resize",this.boundHandleWindowResize)}#n(e){if(e.length===0)return;const t=this.getCombinedBoundingRect(e),r=document.createElement("div");r.style.cssText=`
        position: absolute;
        top: ${t.top}px;
        height: ${t.height}px;
        pointer-events: none;
        visibility: hidden;
    `,document.body.appendChild(r),r.scrollIntoView({behavior:"smooth",block:"nearest"}),setTimeout(()=>{document.body.removeChild(r)},1e3)}getCombinedBoundingRect(e){const t=e.map(l=>l.getBoundingClientRect()),r=Math.min(...t.map(l=>l.left)),i=Math.min(...t.map(l=>l.top)),n=Math.max(...t.map(l=>l.right)),a=Math.max(...t.map(l=>l.bottom)),s=10;return{top:i+window.pageYOffset-s,left:r+window.pageXOffset-s,width:n-r+s*2,height:a-i+s*2,right:n+window.pageXOffset+s,bottom:a+window.pageYOffset+s}}hide(){this.container.style.display="none",this.chibiGroup.classList.remove("chibi-on-left"),this.#r(),this.#a(),this.currentDisplayConfig=null,this.isShowingHelp||(this.isTourActive=!1,this.currentTourStepIndex=0,this.pausedTourStepIndex=-1),this.isShowingHelp=!1,this.nextButton.textContent="Next",this.endButton.style.display="inline-block",window.removeEventListener("resize",this.boundHandleWindowResize)}#r(){this.currentHighlightedElement&&(this.observers&&this.observers.targetObserver&&this.observers.targetObserver.unobserve(this.currentHighlightedElement),this.currentHighlightedElement.classList.remove("chibi-tutorial-focused-element"),this.currentHighlightedElement=null)}handleNext(){this.isTourActive?(this.currentTourStepIndex++,this.showTourStep(this.currentTourStepIndex)):this.isShowingHelp?(this.hide(),this.pausedTourStepIndex!==-1&&this.startTour(this.tourSteps)):this.hide()}showHelp(e,t=null){if(!e){console.warn("ChibiTutorial: No help configuration provided.");return}let r=null;if(e.tourStepId){const i=this.tourSteps.findIndex(n=>n&&n.id===e.tourStepId);if(i!==-1)r={...this.tourSteps[i]};else if(console.warn(`ChibiTutorial: Tour step with ID '${e.tourStepId}' not found.`),e.text)r={text:e.text,element:e.element,clickTab:e.clickTab,position:e.position||"bottom",chibiSide:e.chibiSide||"right",size:e.size||""};else return}else e.text&&(r={text:e.text,element:e.element,clickTab:e.clickTab,position:e.position||"bottom",chibiSide:e.chibiSide||"right",size:e.size||""});!r.element&&t&&(r.element=t),r&&(this.isTourActive&&(this.pausedTourStepIndex=this.currentTourStepIndex,this.isTourActive=!1),this.isShowingHelp=!0,this.nextButton.textContent="OK",this.endButton.style.display="none",this.showDisplay(r))}handleHighlightUpdate(){window.requestAnimationFrame(()=>{if(!this.currentHighlightedElement||!this.isTourActive&&!this.isShowingHelp)return;this.container.style.height=`${document.documentElement.scrollHeight}px`;const e=this.currentHighlightedElement.getBoundingClientRect(),t={top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX,width:e.width,height:e.height};this.#t(t)})}handleReposition(){window.requestAnimationFrame(()=>{!this.currentHighlightedElement||!this.isTourActive&&!this.isShowingHelp||(this.container.style.height=`${document.documentElement.scrollHeight}px`,this.#e(this.currentHighlightedElement))})}#e(e){if(e===null){const t=window.innerWidth,r=window.innerHeight,i=window.scrollX||window.pageXOffset,n=window.scrollY||window.pageYOffset,a=this.chibiGroup.getBoundingClientRect(),s=a.width,l=a.height,u=i+(t-s)/2,c=n+(r-l)/2;this.chibiGroup.style.left=`${u}px`,this.chibiGroup.style.top=`${c}px`,this.chibiGroup.style.transform="",this.#t(e)}else{this.container.style.height=`${document.documentElement.scrollHeight}px`;const t=e.getBoundingClientRect(),r={top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX,width:t.width,height:t.height};this.#t(r),this.#i(r)}}#i(e){const t=this.currentDisplayConfig||{},r=document.querySelector(".tutorial-chibi"),i=this.chibiGroup.getBoundingClientRect(),n=r.getBoundingClientRect(),a=[this.chibiGroup,r],s=this.getCombinedBoundingRect(a),l=10;let u;window.innerWidth<900||window.innerWidth<620?t.position==="top"?u="top":u="bottom":u=t.position||"bottom";let c,h;switch(u){case"top":c=e.top-s.height+l,h=e.left+e.width/2-s.width/2;break;case"right":c=e.top+e.height/2-s.height/2+l/2,h=e.right+l;break;case"left":c=e.top+e.height/2-s.height/2+l/2,h=e.left-s.width+l;break;default:c=e.bottom+l,h=e.left+e.width/2-s.width/2;break}n.left<i.left&&(h=h-(n.left-i.left)),n.top<i.top&&(c=c-n.top+i.top),(h+s.width>window.innerWidth||h<l)&&(h=l),this.chibiGroup.style.left=`${h}px`,this.chibiGroup.style.top=`${c}px`,this.chibiGroup.style.transform=""}#t(e){if(!e){this.overlays.top.style.cssText="width: 100%; height: 100%;",this.overlays.bottom.style.cssText="width: 0; height: 0;",this.overlays.left.style.cssText="width: 0; height: 0;",this.overlays.right.style.cssText="width: 0; height: 0;";return}this.overlays.left.style.cssText=`top: 0; left: 0; width: ${e.left}px; height: 100%;`,this.overlays.right.style.cssText=`top: 0; left: ${e.right}px; width: calc(100% - ${e.right}px); height: 100%;`,this.overlays.top.style.cssText=`top: 0; left: ${e.left}px; width: ${e.width}px; height: ${e.top}px;`,this.overlays.bottom.style.cssText=`top: ${e.bottom}px; left: ${e.left}px; width: ${e.width}px; height: calc(100% - ${e.bottom}px);`}#o(){this.observers={targetObserver:new ResizeObserver(this.boundHandleHighlightUpdate),bodyObserver:new ResizeObserver(this.boundHandleHighlightUpdate),mutationObserver:new MutationObserver(this.boundHandleHighlightUpdate)},this.observers.bodyObserver&&this.observers.bodyObserver.observe(document.body),this.observers.mutationObserver&&this.observers.mutationObserver.observe(document.body,{attributes:!0,childList:!0,subtree:!0})}#a(){this.observers&&(this.observers.targetObserver&&this.observers.targetObserver.disconnect(),this.observers.bodyObserver&&this.observers.bodyObserver.disconnect(),this.observers.mutationObserver&&this.observers.mutationObserver.disconnect(),this.observers=null)}showError(e,t=".tab-panel-card"){const r={text:`<p style="color: #ff6b6b;">${e}</p>`,element:t,position:"right",chibiSide:"right",size:"small"};this.showHelp(r)}}const f=(o,e=!1)=>o?e?o.checked:parseInt(o.value)||0:null;function He(o,e,t,r){const i=document.getElementById("pity-panel"),n=document.getElementById("constellation-panel"),a=e.paths;if(!i||!n)return console.error("Required tab panels not found. Cannot get page configuration."),null;const s=(b,T)=>{if(!T)return[];const w=T.querySelector("#constellation-table");if(!w)return console.warn("Could not find the constellation table inside the panel:",T),[];const k=w.querySelectorAll(`tr[data-rarity="${b}"] .custom-input`);return Array.from(k).map(M=>parseInt(M.value)||0)},l=i.querySelector(`${t.PITY_ROW}[data-banner="character"]`),u=i.querySelector(`${t.PITY_ROW}[data-banner="weapon"]`),c=ne(a),h={},d={},p={},y={},m={};return r.isCharacter&&(h.char=f(l.querySelector('[data-control="pity-5"]')),d.char=f(l.querySelector('[data-control="pity-4"]')),p.char=f(l.querySelector(".guarantee-5"),!0),y.char=f(l.querySelector(".guarantee-4"),!0),r.isCapRad&&(m.capRad=f(l.querySelector('[data-control="capRad"]')))),r.isWeapon&&(h.wep=f(u.querySelector('[data-control="pity-5"]')),d.wep=f(u.querySelector('[data-control="pity-4"]')),p.wep=f(u.querySelector(".guarantee-5"),!0),y.wep=f(u.querySelector(".guarantee-4"),!0),r.isEpitPath&&(m.epitPath=f(u.querySelector('[data-control="epPath"]')))),{SSR:{pity:h,guarantee:p,special:m,consCountStandard:s(5,n),pullPlan:c.typeArray,cashbackRoadmap:c.cashbackArray},SR:{pity:d,guarantee:y,rateUps:ie(),consCount:s(4,n)}}}function ke(){const o=document.querySelectorAll(".row"),e=[];return Array.from(o).slice(1).forEach(r=>{const i=r.dataset.group,n=r.querySelector(".type-selector")?.value||"char",a=r.querySelector(".first-select")?.value||"None",s=r.querySelector(".second-select")?.value||"None";e.push({group:i,type:n,from:a,to:s})}),{pullPlan:e}}function ne(o){const e=document.querySelectorAll(".row"),t=[],r=[],i=Array.from(e).slice(1);let n=0;return i.forEach(a=>{const s=a.querySelector(".type-selector")?.value||"char",l=a.querySelector(".first-select")?.value||"None",u=a.querySelector(".second-select")?.value||"None",c=s==="char"?o.char:o.wep,h=c.indexOf(l),d=c.indexOf(u);if(h===-1||d===-1||h>=d)return;const p=d-h;let y=h,m=0;for(let b=0;b<p;b++)s==="char"&&y===0?m="none":m="regular",t.push({type:s,bannerCount:n}),r.push(m),y++;n++}),{typeArray:t,cashbackArray:r}}function Me(o){const e=document.querySelectorAll(".row"),t=Array.from(e).slice(1);let r=["None"];const i=o.char,n=o.wep;return t.forEach(a=>{const s=a.querySelector(".type-selector")?.value||"char",l=a.querySelector(".first-select")?.value||"None",u=a.querySelector(".second-select")?.value||"None",c=s==="char"?i:n,h=c.indexOf(l),d=c.indexOf(u);if(h===-1||d===-1||h>=d)return;const p=c.slice(h+1,d+1);r.push(...p)}),r}function ie(){const o=document.querySelectorAll("#rate-up-table select.custom-select");let e=[];return o.length===0?(console.error("Could not find any rate-up select elements."),[]):(o.forEach(t=>{const r=t.value;r!=="unknown"&&(r!==void 0?e.push(r):console.warn(`Invalid or unhandled rate-up value found: "${r}"`))}),e)}function $e(){const o=document.querySelector(".mode-label.active").getAttribute("data-target");if(o==="probability")return{type:o,value:parseInt(document.querySelector('[data-control="probability"]').value)/100};if(o==="pulls")return{type:o,value:parseInt(document.querySelector('[data-control="pulls"]').value)}}let g=null;function oe(){const o=document.getElementById("myChart").getContext("2d");g=new Chart(o,{type:"line",data:{labels:[],datasets:[]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{ticks:{color:"#b8c2d0",callback:function(e){return(e*100).toFixed(0)+"%"}},grid:{color:"rgba(58, 58, 106, 0.5)"},beginAtZero:!0,min:0,max:1},x:{ticks:{color:"#b8c2d0"},grid:{color:"rgba(58, 58, 106, 0.5)"}}},plugins:{legend:{labels:{color:"#f5f5f5",sort:(e,t)=>e.datasetIndex-t.datasetIndex}},tooltip:{mode:"index",intersect:!1,callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),t+=(e.parsed.y*100).toFixed(2)+"%",t}}}},interaction:{mode:"nearest",axis:"x",intersect:!1}}})}function ae(o){const e=["#FF9800","#9C27B0","#E91E63","#00BCD4"];return e[o%e.length]}function se(o){const e=["rgba(255, 99, 132, 0.1)","rgba(255, 159, 64, 0.1)","rgba(255, 205, 86, 0.1)","rgba(75, 192, 192, 0.1)","rgba(153, 102, 255, 0.1)"];return e[(o-2)%e.length]}function _e(o,e,t){g||oe();const r=o.length,i=t.slice(1);g.data.labels=e,g.data.datasets=o.map((n,a)=>{const s=a===0?"#2196F3":a===1?"#4CAF50":ae(a);return{label:i[a],data:n,borderColor:s,backgroundColor:a===0?"rgba(33, 150, 243, 0.1)":a===1?"rgba(76, 175, 80, 0.1)":se(a),fill:!0,tension:.4,order:r-a,borderWidth:3,pointRadius:0,pointHoverRadius:5}}),g.update()}function De(o){let e=o[0].length,t=Array.from({length:e-1},()=>Array.from({length:o.length+1},()=>0)),r=[0];for(let i=0;i<o.length;i++){let n=0;for(const c of o[i])n+=c;let a=0;const s=i+1;r.push(s);const l=o[i],u=l.length-1;for(let c=u;c>0;c--)a+=l[c],t[c-1][s]=a/n}return{data:t,labels:r}}function Ue(o){document.querySelector(".mode-label.active").getAttribute("data-target")==="probability"?document.querySelector('.input-lock-container input[data-control="pulls"]').value=le(o,parseInt(document.querySelector('[data-control="probability"]').value)):document.querySelector('.input-lock-container input[data-control="probability"]').value=ce(o,parseInt(document.querySelector('[data-control="pulls"]').value))}function le(o,e){e===100&&(e=99.9);let t=o.length-1,r=!0,i=0,n=0;for(;r;)o[t][n]>e/100&&(i=n,r=!1),n++;return i}function ce(o,e){let t=o.length-1;return o[t].length<=e?100:Math.round(o[t][e]*100)}function ze(o,e){for(const t of o){const r=B(t.rateUps);if(!ue(r,e)){t.probability=0;continue}const i=H(r,e),n=he(o,e);t.probability=n===0?0:i/n}}function B(o){const e={};for(let t=0;t<o.length;t++){const r=o[t];r>0&&(e[t]=r)}return e}function ue(o,e){return Object.entries(o).every(([t,r])=>e[t]>=r)}function H(o,e){return Object.entries(o).reduce((t,[r,i])=>t*de(e[r],i),1)}function he(o,e){return o.reduce((t,r)=>{const i=B(r.rateUps),n=H(i,e);return t+n},0)}function de(o,e){if(e<0||e>o)return 0;if(e===0||e===o)return 1;e=Math.min(e,o-e);let t=1;for(let r=1;r<=e;r++)t*=(o-e+r)/r;return t}function We(o,e){if(!Number.isInteger(o)||o<0)throw new Error("Number of trials (n) must be a non-negative integer.");let t=0,r=0,i=[],n=1;for(;t<=o;)r=n*Math.pow(e,t)*Math.pow(1-e,o-t),i.push(r),t++,n=n*(o+1-t)/t;return i}class Ge{constructor(e,t,r){this.initialState=[...e],this.totalItems=t,this.config=r,this.maxType=r.maxType,this.nTypes=e.length,this.points=Array(this.nTypes).fill(0);for(let i=1;i<this.maxType;i++)this.points[i]=r.regularPoints;this.points[this.maxType]=r.specialPoints,this.reset()}reset(){this.expected=[...this.initialState],this.mean=0,this.secondMoment=0,this.variance=0,this.stateSecondMoments=Array(this.nTypes).fill(0).map(()=>Array(this.nTypes).fill(0));for(let e=0;e<this.nTypes;e++)for(let t=0;t<this.nTypes;t++)this.stateSecondMoments[e][t]=this.initialState[e]*this.initialState[t];this.pointStateCrossMoments=Array(this.nTypes).fill(0),this.results=[{mean:0,variance:0}],this.step=0}computeStep(){const e=this.totalItems;this.step++;let t=0,r=0;for(let l=0;l<this.nTypes;l++){const u=this.expected[l]/e;t+=this.points[l]*u,r+=this.points[l]**2*u}let i=0;for(let l=0;l<this.nTypes;l++)i+=this.points[l]*this.pointStateCrossMoments[l];i/=e;const n=this.secondMoment+2*i+r,a=this.mean+t,s=n-a**2;return this.results.push({mean:a,variance:s}),this.updateState(),this.secondMoment=n,this.mean=a,this.variance=s,{mean:a,variance:s,step:this.step}}updateState(){const e=this.totalItems,t=Array(this.nTypes).fill(0);for(let n=0;n<this.maxType;n++)t[n]=this.expected[n]*(e-1)/e;t[this.maxType]=this.expected[this.maxType];for(let n=0;n<this.maxType;n++)t[n+1]+=this.expected[n]/e;const r=Array(this.nTypes).fill(0).map(()=>Array(this.nTypes).fill(0));for(let n=0;n<this.nTypes;n++)for(let a=0;a<this.nTypes;a++)r[n][a]=this.stateSecondMoments[n][a];for(let n=0;n<this.maxType;n++){const a=Array(this.nTypes).fill(0);a[n]=-1,a[n+1]=1;for(let s=0;s<this.nTypes;s++)for(let l=0;l<this.nTypes;l++)r[s][l]+=1/e*(a[s]*this.stateSecondMoments[n][l]+a[l]*this.stateSecondMoments[s][n]+a[s]*a[l]*this.expected[n])}const i=Array(this.nTypes).fill(0);for(let n=0;n<this.nTypes;n++){let a=this.pointStateCrossMoments[n];n<this.maxType&&(a-=this.pointStateCrossMoments[n]/e),n>=1&&(a+=this.pointStateCrossMoments[n-1]/e);let s=0;for(let l=0;l<this.nTypes;l++)s+=this.points[l]*this.stateSecondMoments[n][l];a+=s/e,n<this.maxType&&(a-=this.points[n]*this.expected[n]/e),n>=1&&(a+=this.points[n-1]*this.expected[n-1]/e),i[n]=a}this.expected=t,this.stateSecondMoments=r,this.pointStateCrossMoments=i}runSteps(e){this.reset();for(let t=0;t<e;t++)this.computeStep();return this.results}}export{Ge as A,Ce as B,Be as C,Re as D,We as E,E as I,G as O,S,Te as U,pe as a,De as b,Oe as c,ke as d,Me as e,He as f,$e as g,Ne as h,fe as i,Ae as j,ye as k,qe as l,Pe as m,xe as n,me as o,ge as p,Se as q,Ue as r,Ie as s,ve as t,_e as u,we as v,Le as w,Ee as x,be as y,ze as z};

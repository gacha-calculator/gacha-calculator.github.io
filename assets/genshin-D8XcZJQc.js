import{c as Y,C as j,D as q,a as V,r as $,b as J,u as K,g as Q,d as X,e as Z,f as tt,i as et,h as at,j as x,k as nt,l as N,m as O,s as L,n as st}from"./solvers-BhFii6kz.js";/* empty css               */import{c as rt,W as ot,g as it,a as lt}from"./cashback-CdRji2W1.js";const k=[.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.066,.126,.186,.246,.306,.366,.426,.486,.546,.606,.666,.726,.786,.846,.906,.966,1],E=[.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.077,.147,.217,.287,.357,.427,.497,.567,.637,.707,.777,.847,.917,.987,1],P=[.051,.051,.051,.051,.051,.051,.051,.051,.561,1],y={maxCharacterConstelation:6,rateUpCharacterSR:3,rateUpWeaponSR:5,poolStandardCharSSR:8,poolCharSR:43,configSR:{maxType:7,regularPoints:.4,specialPoints:1},configSSR:{maxType:7,regularPoints:2,specialPoints:5},configWep:{pointsSR:.4,pointsSSR:2},paths:{char:["None","c0","c1","c2","c3","c4","c5","c6"],wep:["None","r1","r2","r3","r4","r5"]},pity:{pitySSRChar:k.length,pitySSRWep:E.length,pitySRChar:P.length,pitySRWep:P.length},default:0},ct=[{value:"unknown",text:"Unknown"},{value:"none",text:"Not Owned"},{value:"c0",text:"C0"},{value:"c1",text:"C1"},{value:"c2",text:"C2"},{value:"c3",text:"C3"},{value:"c4",text:"C4"},{value:"c5",text:"C5"},{value:"c6",text:"C6"}],_={none:0,c0:1,c1:2,c2:3,c3:4,c4:5,c5:6,c6:7},U=new Set(["dehya","diluc","jean","keqing","mona","qiqi","tighnari","yumemizuki_mizuki"]),G=new Set(["barbara","beidou","bennett","candace","charlotte","chevreuse","chongyun","collei","dahlia","diona","dori","faruzan","fischl","freminet","gaming","gorou","iansan","ifa","kachina","kaveh","kirara","kujou_sara","kuki_shinobu","lan_yan","layla","lynette","mika","ningguang","noelle","ororon","razor","rosaria","sayu","sethos","shikanoin_heizou","sucrose","thoma","xiangling","xingqiu","xinyan","yanfei","yaoyao","yun_jin"]),pt=new Set(["amos_bow","aquila_favonia","lost_prayer_to_the_sacred_winds","primordial_jade_winged-spear","skyward_atlas","skyward_blade","skyward_harp","skyward_pride","skyward_spine","wolfs_gravestone"]),ut=new Set(["dragons_bane","eye_of_perception","favonius_codex","favonius_greatsword","favonius_lance","favonius_sword","favonius_warbow","lions_roar","rainslasher","rust","sacrificial_bow","sacrificial_fragments","sacrificial_greatsword","sacrificial_sword","the_bell","the_flute","the_stringless","the_widsith","akuoumaru","alley_hunter","flower-wreathed_feathers","fruitful_hook","lithic_blade","lithic_spear","makhaira_aquamarine","mitternachts_waltz","mountain-bracing_bolt","mouuns_moon","portable_power_saw","prospectors_drill","range_gauge","sturdy_bone","the_alley_flash","the_dockhands_assistant","wandering_evenstar","wavebreakers_fin","waveriding_whirl","wine_and_song","xiphos_moonlight"]),ht=new Set(["black_tassel","bloodtainted_greatsword","cool_steel","debate_club","emerald_orb","ferrous_shadow","harbinger_of_dawn","magic_guide","raven_bow","sharpshooters_oath","skyrider_sword","slingshot","thrilling_tales_of_dragon_slayers","white_tassel"]);function ft(t){if(!t||!t.characters||!t["wish-counter-character-event"])return console.error("Imported data is missing key Paimon.moe properties."),null;console.log("Paimon.moe data format detected. Running adapter...");const o=t["wish-counter-character-event"]?.pulls||[],i=t["wish-counter-weapon-event"]?.pulls||[],s=W(o,"character"),e=W(i,"weapon"),a=[{banner:"character",...s,caprad:"0",epPath:"0"},{banner:"weapon",...e,caprad:"0",epPath:"0"}],r=dt(t.characters);return{pity:a,constellation:r}}function W(t,o){let i=0,s=0,e=!1,a=!1,r=!1,n=!1;const c=l=>G.has(l)?{type:"character",rarity:4}:ut.has(l)?{type:"weapon",rarity:4}:ht.has(l)?{type:"weapon",rarity:3}:U.has(l)?{type:"character",rarity:5,standard:!0}:pt.has(l)?{type:"weapon",rarity:5,standard:!0}:{type:"unknown",rarity:5,standard:!1};for(let l=t.length-1;l>=0;l--){const p=t[l],u=c(p.id);u.rarity===5?r||(e=p.rate===0,r=!0):r||i++,u.rarity===4?n||(o==="character"&&(a=u.type==="weapon"),n=!0):n||s++}return{pity4:String(s),pity5:String(i),guarantee4:a,guarantee5:e}}function dt(t){const o=new Array(Object.keys(_).length).fill(0),i=new Array(Object.keys(_).length).fill(0);let s=0,e=0;for(const l in t){let p=0;if(G.has(l)?p=4:U.has(l)&&(p=5),p===0)continue;const u=t[l],h=(u.default||0)+(u.wish||0)+(u.manual||0);if(h>0){p===4?s++:p===5&&e++;const f=Math.min(h-1,6),d=_[`c${f}`];d!==void 0&&(p===4?o[d]++:p===5&&i[d]++)}}const a=y.poolCharSR,r=y.poolStandardCharSSR,n=a-s,c=r-e;return o[0]=Math.max(0,n),i[0]=Math.max(0,c),{0:i.map(String),1:o.map(String)}}const yt=`
    <div class="chibi-group">
        <div class="bubble-wrapper bubble-wrapper--big">
            <svg class="bubble-svg-background" viewBox="0 0 2352 856" xmlns="http://www.w3.org/2000/svg">
                <path style="fill:#232338; stroke:none;"
                    d="M2118 618C2072.09 632.557 2020.82 642.525 1974 627.975C1949.06 620.225 1928.07 604.761 1904 596C1928.15 574.906 1950.38 552.246 1966.14 524C1978.13 502.501 1986.34 479.266 1990.41 455C1993.94 433.973 1995.23 412.213 1992.71 391C1990.01 368.189 1984.63 346.161 1975.57 325C1936.75 234.287 1839 185.01 1751 153.692C1680.79 128.705 1606.59 113.569 1533 102.728C1418.45 85.8546 1303.52 78.8151 1188 75.9854C983.191 70.9684 772.755 73.2407 571 113.6C479.224 131.959 386.934 156.236 306 204.8C255.006 235.399 208.898 279.148 188.053 336C180.074 357.763 177.006 379.135 174.83 402C173.006 421.169 174.62 441.101 178.4 460C208.383 609.934 376.221 669.932 507 702.627C677.331 745.209 853.685 750.744 1028 755.015C1226.65 759.881 1430.98 752.259 1626 710.789C1662.97 702.929 1698.61 691.625 1735 681.735C1745.17 678.971 1757.98 684.363 1768 686.576C1789.92 691.417 1811.81 696.134 1834 699.576C1897.86 709.479 1968.19 712.102 2028 683.68C2042.89 676.602 2055.69 666.243 2069 656.71C2080.1 648.757 2091.06 640.547 2102 632.374C2107.6 628.192 2114.64 624.297 2118 618z" />
            </svg>
            <div class="bubble-text"> </div>
        </div>
        <img src="/images/37_chibi.png" alt="Tutorial Assistant" class="tutorial-chibi">
        <div class="prompt-buttons">
            <button class="btn btn--tutorial_next">Next</button>
            <button class="btn btn--tutorial_end">Maybe later</button>
        </div>
    </div>`,St=[{text:"<p>Welcome to the Gacha Calculator! Let me show you around.</p>",size:"small"},{id:"pity-input-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#pity-panel"]',text:"<p>First, you need to input your current pity and guarantees here. You can also import data from paimon.moe directly</p>",position:"right"},{id:"pull-plan-step",element:".pull-plan-section",text:"<p>Next, build your pull plan here. Add all the characters and weapons you want to get in order.</p>",position:"left",chibiSide:"left"},{id:"target-step",element:".header-controls",text:"<p>Now you need to set your target, either the confidence level you want, for example 70% chance of getting all planned items, or your pull budget.</p>",position:"top",chibiSide:"left",size:"big"},{id:"calculate-button-step",element:"#calculate-btn",text:"<p>Once your plan and target are set, press Calculate!</p>",position:"right",size:"small"},{element:".chart-wrapper",text:"<p>You'll get a chart showing the probability of success for each number of pulls until 100%.</p>",position:"top"},{id:"constellation-input-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#constellation-panel"]',text:"<p>Owned characters constellations are needed for accurate cashback, if you only need character pull chance you can leave it for now.</p>",position:"right"},{id:"rate-ups-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#rateup-panel"]',text:"<p>If you know 4* rate ups on the banner it will also help cashback accuracy and reduce unneeded computation</p>",position:"right"},{element:"#probability-table",text:"<p>And down here, you can see a detailed table with cashback estimates. Good luck!</p>",position:"top"}],I={"pity-input-step":{tourStepId:"pity-input-step"},"constellation-input-step":{tourStepId:"constellation-input-step"},"pull-plan-step":{tourStepId:"pull-plan-step"},"calculate-button-step":{tourStepId:"calculate-button-step"},"import-help":{text:'<p>You can import your pity data directly from <a href="https://paimon.moe/" target="_blank">paimon.moe</a>. Click the "Import Data" button and paste the exported JSON data.</p>'},"export-help":{text:"<p>You can export your pity data as a JSON file to make a reserve copy or to carry over data when you are switching to a different browser/new device.</p>",size:"big"},"target-character-help":{text:"<p>Select the characters you are aiming to pull. You can specify the desired constellation level for each.</p>"},"target-weapon-help":{text:"<p>Select the weapons you are aiming to pull. You can specify the desired refinement level for each.</p>"}},z={CHARACTER:"character",WEAPON:"weapon"},v={PITY_ROW:"[data-banner]",CONSTELLATION_ROW:"[data-rarity]",PITY_TABLE:"#pity-table",CONSTELLATION_TABLE:"#constellation-table"},D={pitySettings:{[z.CHARACTER]:{pity4:0,pity5:0,caprad:1},[z.WEAPON]:{pity4:0,pity5:0,epPath:0}},isCharacter:!0,isWeapon:!0,isCapRad:!0,isEpitPath:!0,constellationColumns:8},M={probability:70,pulls:119};class gt{constructor(o){this.parts=o,this.persistence=Y("genshin",v);const i=rt({cashbackCalculator:this.parts.cashbackFn,uiUpdater:this.parts.updateTableFn});this.tutorial=new j(yt);const s={getPageConfiguration:tt,getLabels:Z,getPullPlan:X,getTarget:Q,updateChart:K,convertToChartData:J,recalcInputs:$,calculatorFunction:this.parts.runCalcFn,calculatorConfig:{gachaConfig:this.parts.gachaConfig,CONSTELLATION_MAP:this.parts.CONSTELLATION_MAP},pageConfig:{SELECTORS:v,INITIAL_CONFIG:D},postCalculationHooks:[i],persistence:this.persistence,chibi:this.tutorial};this.validator=new q(this.parts.CONSTELLATION_MAP),this.calculationHandler=new V(s),this.calculateBtn=document.getElementById("calculate-btn"),this.exportBtn=document.getElementById("export-btn"),this.startTourBtn=document.getElementById("start-tour-btn")}initialize(){this.validator.initialize(),et(this.persistence,this.parts.gachaConfig,this.validator,D,ct,v),at(),x(),this.#t(),this.#a()}#t(){this.calculateBtn&&this.calculateBtn.addEventListener("click",async()=>{this.#e()&&await this.calculationHandler.runCalculation()}),this.exportBtn&&this.exportBtn.addEventListener("click",()=>nt(this.persistence)),this.startTourBtn&&this.startTourBtn.addEventListener("click",()=>{this.tutorial.startTour(St)}),x(this.persistence,ft,this.validator),document.querySelectorAll(".help-btn").forEach(i=>{i.addEventListener("click",s=>{s.preventDefault();const e=i.getAttribute("data-help-key")||i.getAttribute("data-tour-step-id");if(e&&I[e]){const a=I[e];this.tutorial.showHelp(a,i)}else console.warn(`ChibiTutorial: No help configuration found for key '${e}'.`,i)})})}#e(){if(document.querySelectorAll(".is-invalid").forEach(e=>e.classList.remove("is-invalid")),this.validator.isDataValid())return!0;console.warn("Validation failed. Calculation blocked."),this.validator.validateAll();const o=document.querySelectorAll(".is-invalid"),i=new Set;o.forEach(e=>{const a=e.closest(".tab-pane");if(a){const r=document.querySelector(`.tab-link[data-tab-target="#${a.id}"]`);r&&i.add(r)}e.classList.add("flicker"),e.addEventListener("animationend",()=>e.classList.remove("flicker"),{once:!0})}),i.forEach(e=>{e.classList.add("is-invalid","flicker"),e.addEventListener("animationend",()=>e.classList.remove("flicker"),{once:!0})});const s=Array.from(i)[0];return s&&s.click(),setTimeout(()=>{o[0]?.scrollIntoView({behavior:"smooth",block:"center"})},100),!1}#a(){const o=this.persistence.loadCalculation(),i=o?o.input:null;o?(N(this.parts.gachaConfig.paths,i),O(M,o),L(o.persistInput)):(N(this.parts.gachaConfig.paths),O(M),L()),this.calculationHandler.runCalculation()}}function bt(t,o){let i=!0;const s=4;if(o)for(let e=0;e<t.length-1;e++){let a=!0;for(let r=0;r<s;r++){for(const n of t[e][r].states)n>0&&(a=!1,i=!1);t[e][r].isEmpty=a}t[e].isEmpty=a}else for(let e=0;e<t.length-1;e++){let a=!0;for(let r=0;r<s;r++){for(const n of t[e][r].states)n.size>0&&(a=!1,i=!1);t[e][r].isEmpty=a}t[e].isEmpty=a}return i}function mt(t){const o=[];if(Array.isArray(t[0]))for(let e=0;e<t.length;e++){let a="None";e>0&&e<=t.length&&t[e-1]&&(a=t[e-1][0].type||"None");let r={offRates:new Map,type:a};for(let n=0;n<4;n++){const c=t[e][n].states;for(const l of c)l.size>0&&i(r.offRates,l)}o.push(r)}else for(let s=0;s<t.length;s++){const e=t[s].states;let a="None";s>0&&s<=t.length&&t[s-1]&&(a=t[s-1].type||"None");let r={offRates:new Map,type:a};for(const n of e)n.size>0&&i(r.offRates,n);o.push(r)}return o;function i(s,e){for(const[a,r]of e)s.has(a)?s.get(a).prob+=r.prob:s.set(a,{...r})}}function Ct(t){const o=new Array(t.length),i=4;for(let s=0;s<t.length;s++){let e=0;for(let a=0;a<i;a++){const r=t[s][a].states;for(let n=0;n<r.length;n++)e+=r[n]}o[s]=e}return o}function wt(t){const o=[];for(let i=0;i<t.length;i++){const s=t[i];let e=0;for(let a=0;a<s.length;a++){const r=s[a].states;for(let n=0;n<r.length;n++)for(const[c,l]of r[n])e+=l.prob}o.push(e)}return o}function _t(t){let s=0;for(let e=0,a=t.length;e<a;e++)for(let r=0;r<4;r++){const n=t[e][r].states;for(let c=0,l=n.length;c<l;c++)n[c]>0&&n[c]<=1e-10&&(s+=n[c],n[c]=0)}if(s>0){const e=1/(1-s);for(let a=0,r=t.length;a<r;a++)for(let n=0;n<4;n++){const c=t[a][n].states;for(let l=0,p=c.length;l<p;l++)c[l]!=0&&(c[l]*=e)}}}function Rt(t){for(let i=0;i<t.length;i++)for(let s=0;s<4;s++){const e=t[i][s].states;for(let a=0;a<e.length;a++){const r=e[a];let n=0;for(const c of r.values())n+=c.prob;e[a]=n}}}function At(t,o,i){if(!Array.isArray(t.SSR.pullPlan))throw new Error("Invalid pull plan");const{pullPlan:s}=t.SSR,e=[];for(const[r,n]of s.entries())n.type==="char"?(e.push(Array.from({length:3},()=>({states:Array.from({length:i.CHARACTER_SSR_5050},()=>new Map),type:"Character",isEmpty:!0}))),e[r].push({states:Array.from({length:i.CHARACTER_SSR_GUARANTEED},()=>new Map),type:"Character",isEmpty:!0})):e.push(Array.from({length:4},()=>({states:Array.from({length:i.WEAPON_SSR},()=>new Map),type:"Weapon",isEmpty:!0})));return e.push(Array.from({length:4},()=>({states:Array.from({length:1},()=>new Map)}))),a(o),{distributionSSR:e};function a(r){let n=0;r[0].type==="firstChar"&&(n=r[0].special),e[0][n].states[r[0].pity].set(0,{prob:1}),e[0][n].isEmpty=!1}}function vt(t,o){let i=!1,s=!1,e=0,a=0;const r=[];e+=t.SSR.pity.char,e+=t.SSR.guarantee.char*o.pitySSRChar,a+=t.SSR.pity.wep,a+=t.SSR.special.epitPath===0?t.SSR.guarantee.wep*o.pitySSRWep:2*o.pitySSRWep;for(const n of t.SSR.pullPlan)n.type==="char"&&!i?(i=!0,r.push({type:"firstChar",pity:e,special:t.SSR.special.capRad})):n.type==="wep"&&!s?(s=!0,r.push({pity:a})):r.push({pity:0});return r.push({pity:0}),r}function kt(t,o){const s=(o.SR-1)/2,e=[{states:Array.from({length:o.SR},()=>new Map)}],a=[{states:Array.from({length:o.SR},()=>new Map)}],r=t.SR.guarantee.char*s+t.SR.pity.char,n=t.SR.guarantee.wep*s+t.SR.pity.wep;c(e[0].states[r]),c(a[0].states[n]);function c(l){l.set(0,{prob:1})}return{distributionCharSR:e,distributionWepSR:a}}const C=1e-10;function Et(t,o,i,s,e,a){const r=t.length-2;for(let n=r;n>=0;n--){const c=a[n+1],l=c.pity;let p=null;if(c.type==="firstChar"&&(p=c.special),!t[n].isEmpty)for(let u=0;u<4;u++){const h=t[n][u];if(!h.isEmpty)if(h.type==="Character")Pt(o,n,t,s,l,u);else if(h.type==="Weapon")Tt(i,n,t,e,l,u,p);else throw new Error(`Unknown SSR array type: ${h.type}`)}}}function Pt(t,o,i,s,e,a){const r=Math.floor(a/2),n=i[o][a].states;if(a!=3){const c=i[o][a].states.length;let l=.5;a===2&&(l=.55);const p=i[o+1][r].states,u=i[o+1][a+1].states;for(let h=c-2;h>=0;h--){const f=n[h],d=h>=s,b=t[h-s*d],S=f*b,R=f-S;let m=S;if(m>C){let g=u;d||(m*=l,g=p),g[e]+=m}if(!d){let g=S*(1-l);g>C&&(n[s]+=g)}let w=R;w>C&&(n[h+1]+=w),n[h]=0}}else{const c=i[o+1][r].states,l=i[o][a].states.length;for(let p=l-2;p>=0;p--){const u=n[p],h=t[p],f=u*h,d=u-f;let b=f;b>C&&(c[e]+=b);let S=d;S>C&&(n[p+1]+=S),n[p]=0}}}function Tt(t,o,i,s,e,a,r){let n=a;r!=null&&(n=r);const c=i[o][a].states.length,l=.375,p=.625,u=i[o][a].states,h=i[o+1][n].states;for(let f=c-2;f>=0;f--){const d=u[f],b=f>=2*s;let S=!1;b||(S=f>=s);const R=t[f-s*S-s*b*2],m=d*R,w=d-m;let g=m;if(g>C&&(b||(S?g*=p:g*=l),h[e]+=g),!b){let A=m*(1-l);S&&(A=m*(1-p)),A>C&&(u[s*2]+=A)}let T=w;T>C&&(u[f+1]+=T),u[f]=0}}const xt="genshin",F=y.pity.pitySSRChar,B=y.pity.pitySSRWep,Nt=y.pity.pitySRChar,H={CHARACTER_SSR_5050:y.pity.pitySSRChar*2+1,CHARACTER_SSR_GUARANTEED:y.pity.pitySSRChar+1,WEAPON_SSR:y.pity.pitySSRWep*3+1,SR:y.pity.pitySRChar*2+1},Ot={distributionArrays:{makeSSR:(t,o)=>At(t,o,H),makeSR:t=>kt(t,H),sortPity:t=>vt(t,y.pity)},pullLogic:{rankUpSSRCheap:(t,o)=>Et(t,k,E,F,B,o)},workerManager:new ot,contexts:{contextSSR:{ODDS_CHARACTER_SSR:k,ODDS_WEAPON_SSR:E,SSR_CHAR_PITY:F,SSR_WEP_PITY:B},contextSR:{ODDS_SR:P,SR_PITY:Nt},moduleType:xt},helpers:{consolidateDistributionForCashback:mt,consolidateProbabilitiesCheap:Ct,consolidateProbabilities:wt,simplifyDistribution:Rt,normalizeCheap:_t,checkIsEmpty:bt}};function Lt(t,o){return new it(y,Ot).runGachaCalculation(t,o)}document.addEventListener("DOMContentLoaded",()=>{const t={gachaConfig:y,CONSTELLATION_MAP:_,runCalcFn:Lt,cashbackFn:lt,updateTableFn:st};new gt(t).initialize()});

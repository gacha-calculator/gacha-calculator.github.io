(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();class Y{constructor({getPageConfiguration:t,getLabels:e,getPullPlan:a,getTarget:n,updateChart:r,convertToChartData:l,recalcInputs:s,calculatorFunction:i,calculatorConfig:p,pageConfig:u,postCalculationHooks:d,persistence:c}){this.getPageConfiguration=t,this.getLabels=e,this.getPullPlan=a,this.getTarget=n,this.updateChart=r,this.convertToChartData=l,this.recalcInputs=s,this.calculatorFunction=i,this.calculatorConfig=p,this.pageConfig=u,this.postCalculationHooks=d||[],this.persistence=c}async runCalculation(){const t=this.getTarget(),e=this.getPageConfiguration(this.calculatorConfig.CONSTELLATION_MAP,this.calculatorConfig.gachaConfig,this.pageConfig.SELECTORS,this.pageConfig.INITIAL_CONFIG),a=this.getLabels(this.calculatorConfig.gachaConfig.paths);if(a.length>99)return;const n=await this.calculatorFunction(e,t),r=this.convertToChartData(n.chartData);this.updateChart(r.data,r.labels,a),this.recalcInputs(r.data);const l={results:n,inputConfig:e,chartLabels:a,gachaConfig:this.calculatorConfig.gachaConfig};if(this.postCalculationHooks.forEach(s=>s(l)),this.persistence){const s=parseInt(document.querySelector('[data-control="pulls"]').value),i=parseInt(document.querySelector('[data-control="probability"]').value);this.persistence.saveCalculation({input:this.getPullPlan(),targetProb:i,targetPull:s,persistInput:document.querySelector(".mode-label.active").getAttribute("data-target")})}}}function J(o,t,e,a,n,r){w(t.pity,a,r),O(t,a,r),M(n);const l=o.loadTables();l&&(A(l.pity,r),E(l.constellation,r),U(l.rateUps),e.validateAll()),o.init()}function w(o,t,e){const a=document.getElementById("pity-row-template"),n=document.querySelector(`${e.PITY_TABLE} tbody`);Object.entries(t.pitySettings).forEach(([r,l])=>{const s=a.content.cloneNode(!0).querySelector("tr"),i=s.querySelector(".special-mechanic");s.dataset.validationType="individual";const p=s.querySelector('[data-control="pity-4"]'),u=s.querySelector('[data-control="pity-5"]');if(p&&(p.min=0,p.max=r.includes("Weapon")?o.pitySRWep-1:o.pitySRChar-1),u&&(u.min=0,u.max=r.includes("Weapon")?o.pitySSRWep-1:o.pitySSRChar-1),s.dataset.banner=r,s.querySelector(".banner-name").textContent=r,s.querySelector('[data-control="pity-4"]').value=l.pity4,s.querySelector('[data-control="pity-5"]').value=l.pity5,i){let c="";r==="character"?c=`
            <input type="number" data-control="capRad" class="custom-input" min="0" max="3" 
                   value="${l.caprad??0}"> 
        `:r==="weapon"&&(c=`
            <input type="number" data-control="epPath" class="custom-input" min="0" max="2" 
                   value="${l.epPath??0}">
        `),i.innerHTML=c}n.appendChild(s);const d=document.querySelector("#pity-table");d&&d.querySelectorAll('tbody tr input[type="number"]').forEach(c=>c.addEventListener("input",function(){let h=this.value;h.length>1&&h.startsWith("0")&&(this.value=h.replace(/^0+/,""),this.value===""&&(this.value="0"));let y=parseInt(this.value)||0;y>c.max?(this.value=c.max,C(this)):y<c.min&&(this.value=c.min,C(this))}))})}function O(o,t,e){const a=document.getElementById("const-column-template"),n=document.querySelectorAll(`${e.CONSTELLATION_TABLE} tbody tr`),r=o.poolStandardCharSSR,l=o.poolCharSR;n.forEach(s=>{const i=document.createDocumentFragment(),u=s.querySelector("td:first-child")?.textContent.trim();s.dataset.validationType="row-sum",u==="5★"?(s.dataset.targetSum=o.poolStandardCharSSR,s.dataset.rarity="5"):(s.dataset.targetSum=o.poolCharSR,s.dataset.rarity="4");for(let d=0;d<t.constellationColumns;d++){const c=a.content.cloneNode(!0);if(d===0){const h=c.querySelector("input");if(h){const y=u==="5★"?r:l;h.value=y}}i.appendChild(c)}s.appendChild(i)})}function M(o){const t=document.querySelectorAll("#rate-up-table select");if(t.length===0)return;const e=o.map(a=>`<option value="${a.value}">${a.text}</option>`).join("");t.forEach(a=>{a.innerHTML=e,a.value="unknown"})}function K(o,t=null){const e=document.querySelector('[data-control="probability"]'),a=document.querySelector('[data-control="pulls"]');t?(e.value=t.targetProb||o.probability,a.value=t.targetPull||o.pulls):(e.value=o.probability,a.value=o.pulls),e.addEventListener("input",function(){let n=this.value;n.length>1&&n.startsWith("0")&&(this.value=n.replace(/^0+/,""),this.value===""&&(this.value="0")),(parseInt(this.value)||0)>100&&(this.value="100",C(this))}),a.addEventListener("input",function(){let n=this.value;n.length>1&&n.startsWith("0")&&(this.value=n.replace(/^0+/,""),this.value===""&&(this.value="0"));let r=parseInt(this.value)||0;r>9999?this.value="9999":r<1&&(this.value="1")})}function C(o){o.style.borderColor="#a71919",o.style.outline="1px solid #a71919",o.classList.add("flicker"),setTimeout(()=>{o.classList.remove("flicker"),o.style.borderColor="",o.style.outline=""},500)}function Q(o,t,e){const a=[];for(let r=0;r<o.length;r++){let l=0;for(const[s,i]of o[r].offRates)l+=i.prob;l=(l*100).toFixed(2),l>0&&a.push({name:t[r],probability:l,p10:e[r].LOWER_BOUND,mean:e[r].MEAN,p90:e[r].UPPER_BOUND,color:"#3498db"})}const n=document.querySelector("#probability-table tbody");n.innerHTML="",a.forEach(r=>{const l=document.createElement("tr"),s=r.probability;l.innerHTML=`
      <td>${r.name}</td>
      <td>
        <div class="progress-container">
          <div class="progress-bar" style="width:${s}%;background:${r.color}">
            <div class="progress-label">${r.probability}%</div>
          </div>
        </div>
      </td>
      <td class="cashback-value">${r.p10.toFixed(1)}</td>
      <td class="cashback-value highlight">${r.mean.toFixed(1)}</td>
      <td class="cashback-value">${r.p90.toFixed(1)}</td>
    `,n.appendChild(l)})}function A(o,t){o.forEach(e=>{const a=document.querySelector(`${t.PITY_TABLE} tr[data-banner="${e.banner}"]`);a&&(a.querySelector('[data-control="pity-4"]').value=e.pity4,a.querySelector('[data-control="pity-5"]').value=e.pity5,a.querySelector(".guarantee-4").checked=e.guarantee4,a.querySelector(".guarantee-5").checked=e.guarantee5,e.caprad&&a.querySelector('[data-control="capRad"]')&&(a.querySelector('[data-control="capRad"]').value=e.caprad),e.epPath&&a.querySelector('[data-control="epPath"]')&&(a.querySelector('[data-control="epPath"]').value=e.epPath))})}function E(o,t){document.querySelectorAll(`${t.CONSTELLATION_TABLE} tbody tr`).forEach((a,n)=>{const r=o[n];r&&a.querySelectorAll("td:nth-child(n+2) input").forEach((s,i)=>{r[i]!==void 0&&(s.value=r[i])})})}function U(o){if(!o||!Array.isArray(o))return;document.querySelectorAll("#rate-up-table select.custom-select").forEach((e,a)=>{o[a]!==void 0&&(e.value=o[a])})}function X(o,t,e){const a=document.getElementById("import-file-input");if(!a){console.error("Import file input not found!");return}const n=r=>_(r,o,t,e);a.removeEventListener("change",a.__handleFile),a.addEventListener("change",n),a.__handleFile=n}async function _(o,t,e,a){const n=o.target.files[0];if(n)try{const r=await n.text(),l=JSON.parse(r);let s=null;l.exportFormat==="GachaCalculatorData"?s=l:e&&(s=e(l)),s?(N(s),a.validateAll(),t.saveTables()):alert("Error: Invalid or unsupported file format.")}catch(r){console.error("File import error:",r)}finally{o.target.value=""}}function N(o){o.pity&&A(o.pity),o.constellation&&E(o.constellation)}function Z(o){const t={exportFormat:"GachaCalculatorData",version:"1.0",exportedAt:new Date().toISOString(),pity:o.getPityData(),constellation:o.getConstellationData()},e=JSON.stringify(t,null,2),a=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(a),r=document.createElement("a");r.href=n;const l=new Date().toISOString().slice(0,10);r.download=`gachaCalc-data-${l}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),console.log("Data exported successfully.")}function tt(o,t=null){const e=new P(o,t);return e.initialize(),e}function et(o,t=null){return new D(o,t).initialize()}class P{constructor(t,e=null){this.pathsConfig=t,this.savedData=e,this.groupColorMap=new Map,this.rowsContainer=document.querySelector(".rows-container"),this.addButton=document.getElementById("add-btn"),this.COLORS={UNIQUE_GROUP:"#f0f0f0",PRESET_HUES:[0,120,240,60,180,300]}}initialize(){this.rowsContainer.innerHTML="",this.savedData.pullPlan?this.savedData.pullPlan.forEach(t=>{this.rowsContainer.appendChild(this.createRow(null,t))}):this.rowsContainer.appendChild(this.createRow()),this.addButton.addEventListener("click",()=>{this.rowsContainer.appendChild(this.createRow())})}createRow(t=null,e=null){const a=this.createRowElement();return this.setupRowEvents(a),this.initializeRowData(a,t,e),a}createRowElement(){return document.getElementById("row-template").content.cloneNode(!0).querySelector(".row")}setupRowEvents(t){const e=t.querySelector(".dropdown"),a=t.querySelector(".type-selector");this.setupDropdownHandler(t,e,a),this.setupTypeChangeHandler(t,a),this.setupButtonHandlers(t)}setupDropdownHandler(t,e,a){e.addEventListener("click",n=>{n.stopPropagation(),e.classList.toggle("dropdown--open")}),t.querySelectorAll(".dropdown__item").forEach(n=>{n.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),a.value=n.dataset.value,a.dispatchEvent(new Event("change")),e.classList.remove("dropdown--open")})}),document.addEventListener("click",n=>{e.contains(n.target)||e.classList.remove("dropdown--open")})}setupTypeChangeHandler(t,e){e.addEventListener("change",()=>{const a=e.options[e.selectedIndex],n=t.querySelector(".type-icon"),r=t.querySelector(".type-text");n.src=a.dataset.icon,r.textContent=a.textContent,this.updatePathSelector(t,e.value),this.handleTypeChangeGroupUpdate(t,e.value)})}handleTypeChangeGroupUpdate(t,e){const a=t.dataset.group;a&&!a.startsWith("unique")&&(t.dataset.group=`unique${e.charAt(0).toUpperCase()+e.slice(1)}`,t.style.setProperty("--group-color",this.COLORS.UNIQUE_GROUP))}setupButtonHandlers(t){t.querySelector(".btn--chainAdd").addEventListener("click",()=>{this.rowsContainer.appendChild(this.createRow(t))}),t.querySelector(".btn--delete").addEventListener("click",()=>{this.handleRowDeletion(t)})}handleRowDeletion(t){const e=t.dataset.group;e&&!e.startsWith("unique")&&Array.from(this.rowsContainer.querySelectorAll(".row")).filter(n=>n.dataset.group===e).length===1&&this.groupColorMap.delete(e),t.remove()}initializeRowData(t,e,a){a?this.initializeFromSavedData(t,a):e?this.initializeFromParent(t,e):this.initializeNewRow(t)}initializeFromSavedData(t,e){const a=t.querySelector(".type-selector");a.value=e.type||"char",this.updateVisualType(t,a.value),this.setGroupAndColor(t,e.group),this.updatePathSelector(t,a.value,e.from,e.to)}initializeFromParent(t,e){const a=e.dataset.group,n=e.querySelector(".type-selector").value,r=e.querySelector(".second-select").value,l=t.querySelector(".type-selector");l.value=n,this.updateVisualType(t,n),a.startsWith("unique")?this.convertToNewGroup(e,t):this.inheritExistingGroup(t,a),this.updatePathSelector(t,n,r)}convertToNewGroup(t,e){const a=this.generateNewGroupId(),n=this.getHueForGroup(a);[t,e].forEach(r=>{r.dataset.group=a,r.style.setProperty("--group-color",`hsl(${n}, 80%, 70%)`)}),this.groupColorMap.set(a,n)}inheritExistingGroup(t,e){t.dataset.group=e;const a=this.groupColorMap.get(e);a!==void 0&&t.style.setProperty("--group-color",`hsl(${a}, 80%, 70%)`)}initializeNewRow(t){const a=t.querySelector(".type-selector").value;t.dataset.group=`unique${a.charAt(0).toUpperCase()+a.slice(1)}`,t.style.setProperty("--group-color",this.COLORS.UNIQUE_GROUP),this.updatePathSelector(t,a)}updateVisualType(t,e){const a=t.querySelector(".type-selector"),n=a.options[a.selectedIndex],r=t.querySelector(".type-icon"),l=t.querySelector(".type-text");r.src=n.dataset.icon,l.textContent=n.textContent}updatePathSelector(t,e,a=null,n=null){const r=t.querySelector(".first-select"),l=t.querySelector(".second-select"),s=this.pathsConfig[e]||this.pathsConfig.char;this.populateSelect(r,s.slice(0,-1)),this.populateSelect(l,s.slice(1)),this.setInitialPathValues(r,l,s,a,n)}populateSelect(t,e){t.innerHTML="",e.forEach(a=>{const n=document.createElement("option");n.value=a,n.textContent=a,t.appendChild(n)})}setInitialPathValues(t,e,a,n,r){if(n&&a.includes(n)){t.value=n;const l=a.indexOf(n);e.value=r&&a.includes(r)&&a.indexOf(r)>l?r:a[Math.min(l+1,a.length-1)]}else t.value=a[0],e.value=a[1]}generateNewGroupId(){const t=Array.from(this.groupColorMap.keys()).map(e=>parseInt(e.replace(/\D/g,""))).filter(e=>!isNaN(e)).sort((e,a)=>e-a);for(let e=1;e<=t.length+1;e++)if(!t.includes(e))return`group${e}`;return`group${t.length+1}`}getHueForGroup(t){const e=parseInt(t.replace(/\D/g,""));return e<=this.COLORS.PRESET_HUES.length?this.COLORS.PRESET_HUES[e-1]:e*137.5%360}setGroupAndColor(t,e){if(t.dataset.group=e,e.startsWith("unique"))t.style.setProperty("--group-color",this.COLORS.UNIQUE_GROUP);else{let a=this.groupColorMap.get(e);a===void 0&&(parseInt(e.replace(/\D/g,"")),a=this.getHueForGroup(e),this.groupColorMap.set(e,a)),t.style.setProperty("--group-color",`hsl(${a}, 80%, 70%)`)}}getState(){return Array.from(this.rowsContainer.querySelectorAll(".row")).map(e=>({type:e.querySelector(".type-selector").value,from:e.querySelector(".first-select").value,to:e.querySelector(".second-select").value,group:e.dataset.group}))}}class D extends P{constructor(t,e=null){super(t,e||null)}initialize(){return this.rowsContainer.innerHTML="",this.savedData.pullPlan?this.savedData.pullPlan.forEach((t,e)=>{const a={...t,pity:this.savedData.pity4?.[e]||0,guarantee:this.savedData.guarantee4?.[e]||!1};this.rowsContainer.appendChild(this.createRow(null,a))}):this.rowsContainer.appendChild(this.createRow()),this.addButton.addEventListener("click",()=>{this.rowsContainer.appendChild(this.createRow())}),this}createRow(t=null,e=null){const a=super.createRow(t,e);return this.addPityGuaranteeToRow(a,e),a}addPityGuaranteeToRow(t,e){const a=t.querySelector('[data-control="pity-4"]'),n=t.querySelector(".guarantee-4");e&&(a&&e.pity!==void 0&&(a.value=e.pity),n&&e.guarantee!==void 0&&(n.checked=e.guarantee)),a.addEventListener("input",function(){let r=this.value;r.length>1&&r.startsWith("0")&&(this.value=r.replace(/^0+/,""),this.value===""&&(this.value="0"));let l=parseInt(this.value)||0;l>10?(this.value=10,T(this)):l<0&&(this.value=0,T(this))})}}function T(o){o.style.borderColor="#a71919",o.style.outline="1px solid #a71919",o.classList.add("flicker"),setTimeout(()=>{o.classList.remove("flicker"),o.style.borderColor="",o.style.outline=""},500)}function at(o=null){const t=document.querySelector('[data-control="probability"]'),e=document.querySelector('[data-control="pulls"]'),a=document.querySelectorAll(".mode-label");let n;o?n=o:n="probability",r(),a.forEach(l=>{l.addEventListener("click",function(){n=this.getAttribute("data-target"),r()})}),t.addEventListener("input",function(){n="probability",r()}),e.addEventListener("input",function(){n="pulls",r()});function r(){a.forEach(l=>{const s=l.getAttribute("data-target")===n;l.classList.toggle("active",s)})}}const v={TABLES:1,CALCULATIONS:1,PULL_PLANS:1};function rt(o,t){if(!o)throw new Error("Persistence factory requires a namespace.");const e={TABLES:`gacha_tables_${o}_v1`,CALCULATIONS:`gacha_calc_${o}_v1`,PULL_PLANS:`gacha_plans_${o}_v1`};return{DEBOUNCE_TIME:1500,debug:!1,saveTimeout:null,init(){this.setupTableListeners(),window.addEventListener("beforeunload",()=>this.saveTables())},saveCalculation(a){this._save(e.CALCULATIONS,{_schema:v.CALCULATIONS,...a})},loadCalculation(){return this._validate(this._load(e.CALCULATIONS),"CALCULATIONS")},saveTables(){this._save(e.TABLES,{_schema:v.TABLES,pity:this.getPityData(),constellation:this.getConstellationData(),rateUps:this.getRateUpData()})},loadTables(){return this._validate(this._load(e.TABLES),"TABLES")},getPityData(){return Array.from(document.querySelectorAll(`${t.PITY_TABLE} tbody tr`)).map(a=>({banner:a.dataset.banner,...a.querySelector('[data-control="pity-4"]')&&{pity4:a.querySelector('[data-control="pity-4"]').value},...a.querySelector('[data-control="pity-5"]')&&{pity5:a.querySelector('[data-control="pity-5"]').value},...a.querySelector(".guarantee-4")&&{guarantee4:a.querySelector(".guarantee-4").checked},...a.querySelector(".guarantee-5")&&{guarantee5:a.querySelector(".guarantee-5").checked},...a.querySelector('[data-control="capRad"]')&&{caprad:a.querySelector('[data-control="capRad"]').value},...a.querySelector('[data-control="epPath"]')&&{epPath:a.querySelector('[data-control="epPath"]').value}}))},getConstellationData(){return Array.from(document.querySelectorAll(`${t.CONSTELLATION_TABLE} tbody tr`)).map(a=>Array.from(a.querySelectorAll("td:nth-child(n+2) input")).map(n=>n.value))},getRateUpData(){return Array.from(document.querySelectorAll("#rate-up-table select.custom-select")).map(a=>a.value)},setupTableListeners(){const a=[`${t.PITY_TABLE} input`,`${t.CONSTELLATION_TABLE} input`,"#rate-up-table select"].join(",");document.querySelectorAll(a).forEach(n=>{n.addEventListener("input",()=>this.queueSave())})},queueSave(){clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>this.saveTables(),this.DEBOUNCE_TIME)},_save(a,n){try{localStorage.setItem(a,JSON.stringify(n))}catch(r){console.error("Storage error:",r),this._handleStorageError()}},_load(a){try{const n=localStorage.getItem(a);return n?JSON.parse(n):null}catch(n){return console.error("Load error:",n),null}},_validate(a,n){return a?typeof a._schema>"u"?a:a._schema!==v[n]?(console.warn(`Schema version mismatch for ${n}`),null):a:null},_handleStorageError(){Object.values(e).forEach(a=>{try{localStorage.removeItem(a)}catch(n){console.error("Cleanup failed:",n)}})}}}class nt{constructor(t){this.constellationMap=t,this.availableConstellationCounts=[],this.isInitialized=!1}initialize(){if(this.isInitialized)return;const t=document;t.addEventListener("focus",e=>{if(e.target.matches('input[type="number"]'))try{e.target.select()}catch(a){console.warn("Could not select text in input.",a)}},{capture:!0}),t.addEventListener("keydown",e=>{["Backspace","Delete","Tab","Escape","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(e.key)||(e.ctrlKey||e.metaKey)&&["a","c","v","x"].includes(e.key.toLowerCase())||/^\d$/.test(e.key)||e.preventDefault()}),t.addEventListener("input",e=>{const a=e.target,n=a.closest("table");if(n)switch(n.id){case"constellation-table":{const r=a.closest("tr");r&&this.validateRowSum(r),this.updateAvailableCountsCache(),this.validateRateUpEligibility();break}case"rate-up-table":{this.validateRateUpEligibility();break}}}),this.isInitialized=!0}validateAll(){document.querySelectorAll(".is-invalid").forEach(e=>e.classList.remove("is-invalid")),this.updateAvailableCountsCache();const t=document.querySelector("#constellation-table");t&&t.querySelectorAll("tbody tr").forEach(e=>this.validateRowSum(e)),this.validateRateUpEligibility()}updateAvailableCountsCache(){const t=new Array(Object.keys(this.constellationMap).length).fill(0);document.querySelectorAll('#constellation-table tbody tr[data-rarity="4"]').forEach(a=>{a.querySelectorAll('input[type="number"]').forEach((n,r)=>{t[r]+=parseInt(n.value,10)||0})}),this.availableConstellationCounts=t}getRateUpUsage(){const t=new Array(Object.keys(this.constellationMap).length).fill(0);return document.querySelectorAll("#rate-up-table select.custom-select").forEach(e=>{const a=this.constellationMap[e.value];a!==void 0&&t[a]++}),t}validateRowSum(t){if(!t.dataset.targetSum)return;const e=parseFloat(t.dataset.targetSum),a=t.querySelectorAll('input[type="number"]');let n=0;a.forEach(r=>n+=parseFloat(r.value)||0),a.forEach(r=>r.classList.toggle("is-invalid",n!==e))}validateRateUpEligibility(){const t=this.getRateUpUsage(),e=this.availableConstellationCounts.map((a,n)=>t[n]>a);document.querySelectorAll("#rate-up-table select.custom-select").forEach(a=>{const n=this.constellationMap[a.value],r=n!==void 0&&e[n];a.classList.toggle("is-invalid",r)})}isDataValid(){const t=document.querySelectorAll('#pity-table input[type="number"]');for(const a of t)if(!this.isIndividualInputValid(a))return!1;const e=document.querySelectorAll("#constellation-table tbody tr");for(const a of e)if(!this.isRowSumValid(a))return!1;return!this.isRateUpOverBudget()}isIndividualInputValid(t){if(t.value===""||/^\d+$/.test(t.value)){const e=parseInt(t.value,10),a=parseInt(t.min,10),n=parseInt(t.max,10);return(!t.hasAttribute("min")||e>=a)&&(!t.hasAttribute("max")||e<=n)}return!1}isRowSumValid(t){if(!t.dataset.targetSum)return!0;const e=parseFloat(t.dataset.targetSum),a=t.querySelectorAll('input[type="number"]');let n=0;return a.forEach(r=>n+=parseFloat(r.value)||0),n===e}isRateUpOverBudget(){const t=this.getRateUpUsage();return this.availableConstellationCounts.some((e,a)=>t[a]>e)}}function ot(){document.querySelectorAll(".tab-nav").forEach(t=>{t.addEventListener("click",e=>{if(!e.target.matches(".tab-link[data-tab-target]"))return;const a=e.target,n=a.closest(".tab-panel-card"),r=a.dataset.tabTarget,l=n.querySelector(r);if(!l){console.error(`Tab target not found: ${r}`);return}n.querySelectorAll(".tab-link").forEach(s=>s.classList.remove("active")),n.querySelectorAll(".tab-pane").forEach(s=>s.classList.remove("active")),a.classList.add("active"),l.classList.add("active")})})}const f=(o,t=!1)=>o?t?o.checked:parseInt(o.value)||0:null;function lt(o,t,e,a){const n=document.getElementById("pity-panel"),r=document.getElementById("constellation-panel"),l=t.paths;if(!n||!r)return console.error("Required tab panels not found. Cannot get page configuration."),null;const s=(S,b)=>{if(!b)return[];const q=b.querySelector("#constellation-table");if(!q)return console.warn("Could not find the constellation table inside the panel:",b),[];const x=q.querySelectorAll(`tr[data-rarity="${S}"] .custom-input`);return Array.from(x).map(R=>parseInt(R.value)||0)},i=n.querySelector(`${e.PITY_ROW}[data-banner="character"]`),p=n.querySelector(`${e.PITY_ROW}[data-banner="weapon"]`),u=k(l),d={},c={},h={},y={},m={};return a.isCharacter&&(d.char=f(i.querySelector('[data-control="pity-5"]')),c.char=f(i.querySelector('[data-control="pity-4"]')),h.char=f(i.querySelector(".guarantee-5"),!0),y.char=f(i.querySelector(".guarantee-4"),!0),a.isCapRad&&(m.capRad=f(i.querySelector('[data-control="capRad"]')))),a.isWeapon&&(d.wep=f(p.querySelector('[data-control="pity-5"]')),c.wep=f(p.querySelector('[data-control="pity-4"]')),h.wep=f(p.querySelector(".guarantee-5"),!0),y.wep=f(p.querySelector(".guarantee-4"),!0),a.isEpitPath&&(m.epitPath=f(p.querySelector('[data-control="epPath"]')))),{SSR:{pity:d,guarantee:h,special:m,consCountStandard:s(5,r),pullPlan:u.typeArray,cashbackRoadmap:u.cashbackArray},SR:{pity:c,guarantee:y,rateUps:B(o),consCount:s(4,r)}}}function st(){const o=document.querySelectorAll(".row"),t=[];return Array.from(o).slice(1).forEach(a=>{const n=a.dataset.group,r=a.querySelector(".type-selector")?.value||"char",l=a.querySelector(".first-select")?.value||"None",s=a.querySelector(".second-select")?.value||"None";t.push({group:n,type:r,from:l,to:s})}),{pullPlan:t}}function k(o){const t=document.querySelectorAll(".row"),e=[],a=[],n=Array.from(t).slice(1);let r=0;return n.forEach(l=>{const s=l.querySelector(".type-selector")?.value||"char",i=l.querySelector(".first-select")?.value||"None",p=l.querySelector(".second-select")?.value||"None",u=s==="char"?o.char:o.wep,d=u.indexOf(i),c=u.indexOf(p);if(d===-1||c===-1||d>=c)return;const h=c-d;let y=d,m=0;for(let S=0;S<h;S++)s==="char"&&y===0?m="none":m="regular",e.push({type:s,bannerCount:r}),a.push(m),y++;r++}),{typeArray:e,cashbackArray:a}}function it(o){const t=document.querySelectorAll(".row"),e=Array.from(t).slice(1);let a=["None"];const n=o.char,r=o.wep;return e.forEach(l=>{const s=l.querySelector(".type-selector")?.value||"char",i=l.querySelector(".first-select")?.value||"None",p=l.querySelector(".second-select")?.value||"None",u=s==="char"?n:r,d=u.indexOf(i),c=u.indexOf(p);if(d===-1||c===-1||d>=c)return;const h=u.slice(d+1,c+1);a.push(...h)}),a}function B(o){const t=document.querySelectorAll("#rate-up-table select.custom-select");let e=new Array(Object.keys(o).length).fill(0);return t.length===0?(console.error("Could not find any rate-up select elements."),[]):(t.forEach(a=>{const n=a.value;if(n==="unknown")return;const r=o[n];r!==void 0?e[r]++:console.warn(`Invalid or unhandled rate-up value found: "${n}"`)}),e)}function ct(){const o=document.querySelector(".mode-label.active").getAttribute("data-target");if(o==="probability")return{type:o,value:parseInt(document.querySelector('[data-control="probability"]').value)/100};if(o==="pulls")return{type:o,value:parseInt(document.querySelector('[data-control="pulls"]').value)}}let g=null;function $(){const o=document.getElementById("myChart").getContext("2d");g=new Chart(o,{type:"line",data:{labels:[],datasets:[]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{ticks:{color:"#b8c2d0",callback:function(t){return(t*100).toFixed(0)+"%"}},grid:{color:"rgba(58, 58, 106, 0.5)"},beginAtZero:!0,min:0,max:1},x:{ticks:{color:"#b8c2d0"},grid:{color:"rgba(58, 58, 106, 0.5)"}}},plugins:{legend:{labels:{color:"#f5f5f5",sort:(t,e)=>t.datasetIndex-e.datasetIndex}},tooltip:{mode:"index",intersect:!1,callbacks:{label:function(t){let e=t.dataset.label||"";return e&&(e+=": "),e+=(t.parsed.y*100).toFixed(2)+"%",e}}}},interaction:{mode:"nearest",axis:"x",intersect:!1}}})}function H(o){const t=["#FF9800","#9C27B0","#E91E63","#00BCD4"];return t[o%t.length]}function z(o){const t=["rgba(255, 99, 132, 0.1)","rgba(255, 159, 64, 0.1)","rgba(255, 205, 86, 0.1)","rgba(75, 192, 192, 0.1)","rgba(153, 102, 255, 0.1)"];return t[(o-2)%t.length]}function ut(o,t,e){g||$();const a=o.length,n=e.slice(1);g.data.labels=t,g.data.datasets=o.map((r,l)=>{const s=l===0?"#2196F3":l===1?"#4CAF50":H(l);return{label:n[l],data:r,borderColor:s,backgroundColor:l===0?"rgba(33, 150, 243, 0.1)":l===1?"rgba(76, 175, 80, 0.1)":z(l),fill:!0,tension:.4,order:a-l,borderWidth:3,pointRadius:0,pointHoverRadius:5}}),g.update()}function pt(o){let t=o[0].length,e=Array.from({length:t-1},()=>Array.from({length:o.length+1},()=>0)),a=[0];for(let n=0;n<o.length;n++){let r=0;for(const u of o[n])r+=u;let l=0;const s=n+1;a.push(s);const i=o[n],p=i.length-1;for(let u=p;u>0;u--)l+=i[u],e[u-1][s]=l/r}return{data:e,labels:a}}function dt(o){document.querySelector(".mode-label.active").getAttribute("data-target")==="probability"?document.querySelector('.input-lock-container input[data-control="pulls"]').value=F(o,parseInt(document.querySelector('[data-control="probability"]').value)):document.querySelector('.input-lock-container input[data-control="probability"]').value=G(o,parseInt(document.querySelector('[data-control="pulls"]').value))}function F(o,t){t===100&&(t=99.9);let e=o.length-1,a=!0,n=0,r=0;for(;a;)o[e][r]>t/100&&(n=r,a=!1),r++;return n}function G(o,t){let e=o.length-1;return o[e].length<=t?100:Math.round(o[e][t]*100)}function ht(o,t){for(const e of o){const a=L(e.rateUps);if(!W(a,t)){e.probability=0;continue}const n=I(a,t),r=j(o,t);e.probability=r===0?0:n/r}}function L(o){const t={};for(let e=0;e<o.length;e++){const a=o[e];a>0&&(t[e]=a)}return t}function W(o,t){return Object.entries(o).every(([e,a])=>t[e]>=a)}function I(o,t){return Object.entries(o).reduce((e,[a,n])=>e*V(t[a],n),1)}function j(o,t){return o.reduce((e,a)=>{const n=L(a.rateUps),r=I(n,t);return e+r},0)}function V(o,t){if(t<0||t>o)return 0;if(t===0||t===o)return 1;t=Math.min(t,o-t);let e=1;for(let a=1;a<=t;a++)e*=(o-t+a)/a;return e}function yt(o,t){if(!Number.isInteger(o)||o<0)throw new Error("Number of trials (n) must be a non-negative integer.");let e=0,a=0,n=[],r=1;for(;e<=o;)a=r*Math.pow(t,e)*Math.pow(1-t,o-e),n.push(a),e++,r=r*(o+1-e)/e;return n}class ft{constructor(t,e,a){this.initialState=[...t],this.totalItems=e,this.config=a,this.maxType=a.maxType,this.nTypes=t.length,this.points=Array(this.nTypes).fill(0);for(let n=1;n<this.maxType;n++)this.points[n]=a.regularPoints;this.points[this.maxType]=a.specialPoints,this.reset()}reset(){this.expected=[...this.initialState],this.mean=0,this.secondMoment=0,this.variance=0,this.stateSecondMoments=Array(this.nTypes).fill(0).map(()=>Array(this.nTypes).fill(0));for(let t=0;t<this.nTypes;t++)for(let e=0;e<this.nTypes;e++)this.stateSecondMoments[t][e]=this.initialState[t]*this.initialState[e];this.pointStateCrossMoments=Array(this.nTypes).fill(0),this.results=[{mean:0,variance:0}],this.step=0}computeStep(){const t=this.totalItems;this.step++;let e=0,a=0;for(let i=0;i<this.nTypes;i++){const p=this.expected[i]/t;e+=this.points[i]*p,a+=this.points[i]**2*p}let n=0;for(let i=0;i<this.nTypes;i++)n+=this.points[i]*this.pointStateCrossMoments[i];n/=t;const r=this.secondMoment+2*n+a,l=this.mean+e,s=r-l**2;return this.results.push({mean:l,variance:s}),this.updateState(),this.secondMoment=r,this.mean=l,this.variance=s,{mean:l,variance:s,step:this.step}}updateState(){const t=this.totalItems,e=Array(this.nTypes).fill(0);for(let r=0;r<this.maxType;r++)e[r]=this.expected[r]*(t-1)/t;e[this.maxType]=this.expected[this.maxType];for(let r=0;r<this.maxType;r++)e[r+1]+=this.expected[r]/t;const a=Array(this.nTypes).fill(0).map(()=>Array(this.nTypes).fill(0));for(let r=0;r<this.nTypes;r++)for(let l=0;l<this.nTypes;l++)a[r][l]=this.stateSecondMoments[r][l];for(let r=0;r<this.maxType;r++){const l=Array(this.nTypes).fill(0);l[r]=-1,l[r+1]=1;for(let s=0;s<this.nTypes;s++)for(let i=0;i<this.nTypes;i++)a[s][i]+=1/t*(l[s]*this.stateSecondMoments[r][i]+l[i]*this.stateSecondMoments[s][r]+l[s]*l[i]*this.expected[r])}const n=Array(this.nTypes).fill(0);for(let r=0;r<this.nTypes;r++){let l=this.pointStateCrossMoments[r];r<this.maxType&&(l-=this.pointStateCrossMoments[r]/t),r>=1&&(l+=this.pointStateCrossMoments[r-1]/t);let s=0;for(let i=0;i<this.nTypes;i++)s+=this.points[i]*this.stateSecondMoments[r][i];l+=s/t,r<this.maxType&&(l-=this.points[r]*this.expected[r]/t),r>=1&&(l+=this.points[r-1]*this.expected[r-1]/t),n[r]=l}this.expected=e,this.stateSecondMoments=a,this.pointStateCrossMoments=n}runSteps(t){this.reset();for(let e=0;e<t;e++)this.computeStep();return this.results}}export{Y as C,nt as D,ft as I,pt as a,st as b,rt as c,it as d,lt as e,ot as f,ct as g,X as h,J as i,Z as j,tt as k,K as l,Q as m,et as n,ht as o,yt as p,dt as r,at as s,ut as u};

import{P as N}from"./commonHelpers-Cy1n5av0.js";function F(p,a,m){if(!Array.isArray(p.SSR.pullPlan))throw new Error("Invalid pull plan");if(!Array.isArray(a))throw new Error("Invalid pity data");const y={CHARACTER:0},{pullPlan:U}=p.SSR;let k=0;const r=[];for(const[c,s]of U.entries()){const e=s===y.CHARACTER;r.push([]),e?(A(c,k),k++):h(c,k)}return o(),n(a),{distributionSSR:r};function A(c,s){for(let e=0;e<=s;e++){const t=f(m.CHARACTER,[0,0,0]);r[c].push(t)}}function h(c,s){for(let e=0;e<=s;e++){const t=f(m.WEAPON,[0,0]);r[c].push(t)}}function o(){const c=Array.from({length:k+1},()=>f(m.FINAL));r.push(c)}function n(c){const s=r[0][0];s.states[c[0]]=1,s.totalSum=1}function f(c,s){return new N(Array(c).fill(0),s,0)}}function O(p,a){const m=(a.CHARACTER-1)/2,y=(a.WEAPON-1)/2;let U=!1,k=!1,r=0,A=0;const h=[];r+=p.SSR.pity.char,r+=p.SSR.guarantee.char*m,A+=p.SSR.pity.wep,A+=p.SSR.guarantee.wep*y;for(const o of p.SSR.pullPlan)o==0&&!U?(U=!0,h.push(r)):o==1&&!k?(k=!0,h.push(A)):h.push(0);return h.push(0),h}function w(p,a){const m=a.SR,y=(m-1)/2;let U=[[new N(Array(m).fill(0),[0,0],1)]],k=[[new N(Array(m).fill(0),[0,0],1)]];const r=p.SR.guarantee.char*y+p.SR.pity.char,A=p.SR.guarantee.wep*y+p.SR.pity.wep;return U[0][0].states[r]=1,k[0][0].states[A]=1,{distributionCharSR:U,distributionWepSR:k}}const E=1e-8;function z(p,a,m,y,U,k,r){if(!Array.isArray(y)||!Array.isArray(U))throw new Error("All input parameters except currentPull must be arrays.");const{charPullsSum:A,wepPullsSum:h}=f(p,U);k.char.pullsSum=A,k.wep.pullsSum=h;for(let e=0;e<p.length-1;e++){const t=U[e]===0,l=p[e].length-1;for(let P=0;P<=l;P++){const g=p[e][P],W=t?a:m;g.totalSum>E&&(p[e][P].states=H(W,g.states,g.rankUps,r))}}const{charRankUps:o,wepRankUps:n}=s(p,U);k.char.rankUps=o,k.wep.rankUps=n;for(let e=0;e<p.length-1;e++){const t=p[e].length-1,l=U[e]===0;for(let P=0;P<=t;P++){const g=y[e+1];c(p,e,P,l,g)}}function f(e,t){const l=[0,0];for(let g=0;g<e.length-1;g++){const W=t[g]===0?0:1;for(let R of e[g])if(R.totalSum>E)for(let x of R.states)x>1&&(x=1),l[W]+=x}const P=1/(l[0]+l[1]);return l[0]*=P,l[1]*=P,{charPullsSum:l[0],wepPullsSum:l[1]}}function c(e,t,l,P,g){P?(e[t][l].rankUps[0]>E&&(e[t][l].rankUps[0],e[t+1][l].states[g]+=e[t][l].rankUps[0],e[t+1][l].totalSum+=e[t][l].rankUps[0],e[t][l].totalSum-=e[t][l].rankUps[0]),e[t][l].rankUps[1]>E&&(e[t+1][l+1].states[g]+=e[t][l].rankUps[1],e[t+1][l+1].totalSum+=e[t][l].rankUps[1],e[t][l].totalSum-=e[t][l].rankUps[1])):(e[t][l].rankUps[0]>E&&(e[t+1][l].states[g]+=e[t][l].rankUps[0],e[t+1][l].totalSum+=e[t][l].rankUps[0],e[t][l].totalSum-=e[t][l].rankUps[0]),e[t][l].rankUps[1]>E&&(e[t+1][l].states[g]+=e[t][l].rankUps[1],e[t+1][l].totalSum+=e[t][l].rankUps[1],e[t][l].totalSum-=e[t][l].rankUps[1])),e[t][l].rankUps[0]=0,e[t][l].rankUps[1]=0}function s(e,t){const l=[0,0];for(let P=0;P<e.length-1;P++){const g=t[P]===0?0:1;for(let W of e[P]){for(let R of W.rankUps)l[g]+=R;W.rankUps[2]=0}}return{charRankUps:l[0],wepRankUps:l[1]}}}function D(p,a,m,y){let U=!1;for(let r=0;r<a.length;r++){const A=r===a.length-1,h=a[r].length-1;for(let o=0;o<=h;o++){const n=a[r][o];if(n.totalSum>E&&(a[r][o].states=H(m,n.states,n.rankUps,y,p),A))for(let f of n.rankUps)f>E&&(U=!0)}}if(U){let r=[];for(let A=0;A<=a.length;A++)r.push(new N(Array(21).fill(0),[0,0],0));a.push(r)}for(let r=0;r<a.length-1;r++){const A=a[r].length-1;for(let h=0;h<=A;h++)a[r+1][h].states[0]+=a[r][h].rankUps[0],a[r+1][h].totalSum+=a[r][h].rankUps[0],a[r][h].totalSum-=a[r][h].rankUps[0],a[r][h].rankUps[0]=0,a[r+1][h+1].states[0]+=a[r][h].rankUps[1],a[r+1][h+1].totalSum+=a[r][h].rankUps[1],a[r][h].totalSum-=a[r][h].rankUps[1],a[r][h].rankUps[1]=0}const k=a[a.length-1].length-1;for(let r=0;r<=k;r++)a[a.length-1][r].rankUps[0]=0,a[a.length-1][r].rankUps[1]=0}function H(p,a,m,y,U){const k=a.length,r=k===y.WEAPON,A=k===y.CHARACTER,h=k===y.SR,o=Array(k).fill(0);if(A){const n=(y.CHARACTER-1)/2;for(let f=1;f<k;f++)if(f===n||f===n*2)for(let c=0;c<f;c++){const s=c<n?.5:1;if(o[f]+=p[c%n]*a[c]*s,f===n&&(m[2]+=p[c%n]*a[c]*s),f==n*2&&(c===n-1||c===n*2-1)){const e=c===n*2-1?1:0;m[e]=o[f],o[f]=0}}else o[f]+=(1-p[f%n-1])*a[f-1]}else if(r){const n=(y.WEAPON-1)/2;for(let f=1;f<k;f++)if(f===n||f===n*2)for(let c=0;c<f;c++){const s=c<n?.75:1;o[f]+=p[c%n]*a[c]*s,f===n&&(m[1]+=p[c%n]*a[c]*s),f==n*2&&(c===n-1||c===n*2-1)&&(m[0]=o[f],o[f]=0)}else o[f]+=(1-p[f%n-1])*a[f-1]}else if(h){const n=U!==void 0?U.pullsSum:1,f=U!==void 0?U.rankUps:0,c=(y.SR-1)/2;for(let s=1;s<k;s++)if(s===c||s===c*2)for(let e=0;e<s;e++){const t=e<c?.5:1;if(o[s]+=p[e%c]*a[e]*(n-f)*t,e===c-1||e===c*2-1?o[e]+=a[e]*(1-(n-f))*t:(o[e+1]+=p[e%c]*a[e]*f*t,o[e]+=a[e]*(1-n)*t),s==c*2&&(e===c-1||e===c*2-1)){const l=e===c*2-1?1:0;m[l]=o[s],o[s]=0}}else o[s]+=(1-p[s%c-1])*a[s-1]*n}else throw new Error("Incorrect size for distribution SSR");return o}export{w as a,D as b,F as m,z as r,O as s};

import{c as m,D as y,C as A,r as E,a as P,u as L,g as k,b as I,d as O,e as N,i as _,f as D,j as x,h as W,k as S,l as C,s as v,m as w}from"./solvers-D-av1cDx.js";/* empty css               */import{c as F,W as H,g as V,a as B}from"./cashback-B5lDuaan.js";import{c as z,n as M,s as U,a as G,b as Y,d as q}from"./common-helpers-BPUYLRbn.js";import{r as j,s as J,m as $,a as K}from"./common-pull-logic-eoLatjHO.js";const g={CHARACTER:"character",WEAPON:"weapon"},o={PITY_ROW:"[data-banner]",CONSTELLATION_ROW:"[data-rarity]",PITY_TABLE:"#pity-table",CONSTELLATION_TABLE:"#constellation-table"},T={pitySettings:{[g.CHARACTER]:{pity4:0,pity5:0},[g.WEAPON]:{pity4:0,pity5:0}},isCharacter:!0,isWeapon:!0,isSpecial:!1,constellationColumns:8},b={probability:70,pulls:116},r=[.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.056,.106,.156,.206,.256,.306,.356,.406,.456,.506,.556,.606,.656,.706,.756,.806,.856,.906,.956,1],l=[.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.057,.107,.157,.207,.257,.307,.357,.407,.457,.507,.557,.607,.657,.707,.757,.807,.857,.907,.957,1],c=[.06,.06,.06,.06,.06,.06,.06,.06,.06,1],n={maxCharacterConstelation:6,rateUpCharacterSR:2,rateUpWeaponSR:3,poolStandardCharSSR:6,poolCharSR:9,configSR:{maxType:7,regularPoints:.4,specialPoints:1},configSSR:{maxType:7,regularPoints:2,specialPoints:5},configWep:{pointsSR:1,pointsSSR:2},paths:{char:["None","v0","v1","v2","v3","v4","v5","v6"],wep:["None","c1","c2","c3","c4","c5","c6"]},pity:{pitySSRChar:r.length,pitySSRWep:l.length,pitySRChar:c.length,pitySRWep:c.length},default:0},Q=[{value:"unknown",text:"Unknown"},{value:"none",text:"Not Owned"},{value:"v0",text:"V0"},{value:"v1",text:"V1"},{value:"v2",text:"V2"},{value:"v3",text:"V3"},{value:"v4",text:"V4"},{value:"v5",text:"V5"},{value:"v6",text:"V6"}],X={none:0,v0:1,v1:2,v2:3,v3:4,v4:5,v5:6,v6:7};class Z{constructor(t){this.parts=t,this.persistence=m("gfl2",o);const e=F({cashbackCalculator:this.parts.cashbackFn,uiUpdater:this.parts.updateTableFn}),s={getPageConfiguration:N,getLabels:O,getPullPlan:I,getTarget:k,updateChart:L,convertToChartData:P,recalcInputs:E,calculatorFunction:this.parts.runCalcFn,calculatorConfig:{gachaConfig:this.parts.gachaConfig,CONSTELLATION_MAP:this.parts.CONSTELLATION_MAP},pageConfig:{SELECTORS:o,INITIAL_CONFIG:T},postCalculationHooks:[e],persistence:this.persistence};this.validator=new y(this.parts.CONSTELLATION_MAP),this.calculationHandler=new A(s),this.calculateBtn=document.getElementById("calculate-btn"),this.exportBtn=document.getElementById("export-btn")}initialize(){this.validator.initialize(),_(this.persistence,this.parts.gachaConfig,this.validator,T,Q,o),D(),this.#t(),this.#i()}#t(){if(!this.calculateBtn){console.error("Calculate button not found!");return}this.calculateBtn.addEventListener("click",()=>{this.#a()&&this.calculationHandler.runCalculation()}),this.exportBtn&&this.exportBtn.addEventListener("click",()=>x(this.persistence)),W(this.persistence,null,this.validator)}#a(){if(document.querySelectorAll(".is-invalid").forEach(i=>i.classList.remove("is-invalid")),this.validator.isDataValid())return!0;console.warn("Validation failed. Calculation blocked."),this.validator.validateAll();const t=document.querySelectorAll(".is-invalid"),e=new Set;t.forEach(i=>{const h=i.closest(".tab-pane");if(h){const d=document.querySelector(`.tab-link[data-tab-target="#${h.id}"]`);d&&e.add(d)}i.classList.add("flicker"),i.addEventListener("animationend",()=>i.classList.remove("flicker"),{once:!0})}),e.forEach(i=>{i.classList.add("is-invalid","flicker"),i.addEventListener("animationend",()=>i.classList.remove("flicker"),{once:!0})});const s=Array.from(e)[0];return s&&s.click(),setTimeout(()=>{t[0]?.scrollIntoView({behavior:"smooth",block:"center"})},100),!1}#i(){const t=this.persistence.loadCalculation(),e=t?t.input:null;t?(S(this.parts.gachaConfig.paths,e),C(b,t),v(t.persistInput)):(S(this.parts.gachaConfig.paths),C(b),v()),this.calculationHandler.runCalculation()}}const t0="common",p=n.pity.pitySSRChar,u=n.pity.pitySSRWep,f=n.pity.pitySRChar,R={CHARACTER:p*2+1,WEAPON:u*2+1,SR:f*2+1},a0={distributionArrays:{makeSSR:(a,t)=>K(a,t,R),makeSR:a=>$(a,R),sortPity:a=>J(a,n.pity)},pullLogic:{rankUpSSRCheap:(a,t)=>j(a,r,l,p,u,t)},workerManager:new H,contexts:{contextSSR:{ODDS_CHARACTER_SSR:r,ODDS_WEAPON_SSR:l,SSR_CHAR_PITY:p,SSR_WEP_PITY:u},contextSR:{ODDS_SR:c,SR_PITY:f},moduleType:t0},helpers:{consolidateDistributionForCashback:q,consolidateProbabilitiesCheap:Y,consolidateProbabilities:G,simplifyDistribution:U,normalizeCheap:M,checkIsEmpty:z}};async function i0(a,t){return new V(n,a0).runGachaCalculation(a,t)}document.addEventListener("DOMContentLoaded",()=>{const a={gachaConfig:n,CONSTELLATION_MAP:X,runCalcFn:i0,cashbackFn:B,updateTableFn:w};new Z(a).initialize()});

class a{constructor(t){this.tutorialSteps=[],this.currentStepIndex=0,this.isTourActive=!1,this.isShowingHelp=!1,this.pausedTourStepIndex=-1,this.currentTargetElement=null,this.observers=null,this.boundHandleWindowResize=this.handleReposition.bind(this),this.boundHandleHighlightUpdate=this.handleHighlightUpdate.bind(this),this.container=document.createElement("div"),this.container.id="chibi-container",this.container.innerHTML=`
            <div class="chibi-tutorial-overlay-piece" data-overlay="top"></div>
            <div class="chibi-tutorial-overlay-piece" data-overlay="bottom"></div>
            <div class="chibi-tutorial-overlay-piece" data-overlay="left"></div>
            <div class="chibi-tutorial-overlay-piece" data-overlay="right"></div>
        `,this.container.innerHTML+=t,document.body.appendChild(this.container),this.overlays={top:this.container.querySelector('[data-overlay="top"]'),bottom:this.container.querySelector('[data-overlay="bottom"]'),left:this.container.querySelector('[data-overlay="left"]'),right:this.container.querySelector('[data-overlay="right"]')},this.chibiGroup=this.container.querySelector(".chibi-group"),this.bubbleText=this.container.querySelector(".bubble-text"),this.nextButton=this.container.querySelector(".btn--tutorial_next"),this.endButton=this.container.querySelector(".btn--tutorial_end"),this.handleNext=this.handleNext.bind(this),this.hide=this.hide.bind(this),this.handleReposition=this.handleReposition.bind(this),this.nextButton.addEventListener("click",this.handleNext),this.endButton.addEventListener("click",this.hide)}startTour(t){if(!t||t.length===0){console.error("ChibiTutorial: No steps provided for the tour.");return}this.tutorialSteps=t,this.pausedTourStepIndex===-1?this.currentStepIndex=0:(this.currentStepIndex=this.pausedTourStepIndex,this.pausedTourStepIndex=-1),this.isTourActive=!0,this.isShowingHelp=!1,this.nextButton.textContent="Next",this.endButton.style.display="inline-block",this.#r(),this.showStep(this.currentStepIndex)}showStep(t){if(t>=this.tutorialSteps.length){this.hide();return}const e=this.tutorialSteps[t];this.show(e)}show(t){this.#i(),this.chibiGroup.classList.remove("chibi-on-left"),t.chibiSide==="left"&&this.chibiGroup.classList.add("chibi-on-left"),this.bubbleText.innerHTML=t.text,this.container.style.display="block",this.container.style.height=`${document.documentElement.scrollHeight}px`;let e=null,i=!1;if(t.clickTab){const s=document.querySelector(t.clickTab);s?(s.dispatchEvent(new Event("click",{bubbles:!0})),i=!0):console.warn(`ChibiTutorial: Tab button not found for selector "${t.clickTab}".`)}if(t.action==="click"){const s=document.querySelector(t.element);s?(s.dispatchEvent(new Event("click",{bubbles:!0})),i=!0):console.error(`ChibiTutorial: Element not found for selector "${t.element}" to perform action "${t.action}".`)}if(t.element){if(e=document.querySelector(t.element),!e){console.error(`ChibiTutorial: Element not found for selector "${t.element}". Skipping step.`),this.isTourActive&&this.handleNext();return}if(i)e.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{this.currentTargetElement=e,this.currentTargetElement.classList.add("chibi-tutorial-focused-element"),this.observers&&this.observers.targetObserver&&this.observers.targetObserver.observe(this.currentTargetElement),this.#t(this.currentTargetElement)},50);else{const s=e.getBoundingClientRect();s.top<0||s.bottom>window.innerHeight||s.left<0||s.right>window.innerWidth?(e.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{this.currentTargetElement=e,this.currentTargetElement.classList.add("chibi-tutorial-focused-element"),this.observers&&this.observers.targetObserver&&this.observers.targetObserver.observe(this.currentTargetElement),this.#t(this.currentTargetElement)},50)):(this.currentTargetElement=e,this.currentTargetElement.classList.add("chibi-tutorial-focused-element"),this.observers&&this.observers.targetObserver&&this.observers.targetObserver.observe(this.currentTargetElement),this.#t(this.currentTargetElement))}}else this.#e(null),this.chibiGroup.style.top="50%",this.chibiGroup.style.left="50%",this.chibiGroup.style.transform="translate(-50%, -50%)"}hide(){this.container.style.display="none",this.chibiGroup.classList.remove("chibi-on-left"),this.#i(),this.#o(),this.isShowingHelp||(this.isTourActive=!1,this.currentStepIndex=0,this.pausedTourStepIndex=-1),this.isShowingHelp=!1,this.nextButton.textContent="Next",this.endButton.style.display="inline-block"}#i(){this.currentTargetElement&&(this.observers&&this.observers.targetObserver&&this.observers.targetObserver.unobserve(this.currentTargetElement),this.currentTargetElement.classList.remove("chibi-tutorial-focused-element"),this.currentTargetElement=null)}handleNext(){this.isTourActive?(this.currentStepIndex++,this.showStep(this.currentStepIndex)):this.isShowingHelp?(this.hide(),this.pausedTourStepIndex!==-1&&this.startTour(this.tutorialSteps)):this.hide()}showHelp(t,e=null){if(!t){console.warn("ChibiTutorial: No help configuration provided.");return}let i=null;if(t.tourStepId){const s=this.tutorialSteps.findIndex(r=>r&&r.id===t.tourStepId);if(s!==-1)i={...this.tutorialSteps[s]};else if(console.warn(`ChibiTutorial: Tour step with ID '${t.tourStepId}' not found.`),t.text)i={text:t.text,position:t.position||"bottom",chibiSide:t.chibiSide||"right",size:t.size||"big"};else return}else t.text&&(i={text:t.text,position:t.position||"bottom",chibiSide:t.chibiSide||"right",size:t.size||"big"});i&&(this.isTourActive&&(this.pausedTourStepIndex=this.currentStepIndex,this.isTourActive=!1),this.isShowingHelp=!0,this.nextButton.textContent="OK",this.endButton.style.display="none",this.show(i))}handleHighlightUpdate(){window.requestAnimationFrame(()=>{if(!this.currentTargetElement||!this.isTourActive&&!this.isShowingHelp)return;this.container.style.height=`${document.documentElement.scrollHeight}px`;const t=this.currentTargetElement.getBoundingClientRect(),e={top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX,width:t.width,height:t.height};this.#e(e)})}handleReposition(){window.requestAnimationFrame(()=>{!this.currentTargetElement||!this.isTourActive&&!this.isShowingHelp||(this.container.style.height=`${document.documentElement.scrollHeight}px`,this.#t(this.currentTargetElement))})}#t(t){this.container.style.height=`${document.documentElement.scrollHeight}px`;const e=t.getBoundingClientRect(),i={top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX,width:e.width,height:e.height};this.#e(i),this.#s(i)}#s(t){let e;this.isTourActive?e=this.tutorialSteps[this.currentStepIndex]:this.isShowingHelp&&this.pausedTourStepIndex!==-1?e=this.tutorialSteps[this.pausedTourStepIndex]||{position:"bottom"}:this.isShowingHelp?e={position:"bottom"}:(console.warn("ChibiTutorial: #positionChibi called unexpectedly."),e={position:"bottom"});const i=this.chibiGroup.getBoundingClientRect(),s=e.position||"bottom",r=20;let o,n;switch(s){case"top":o=t.top-i.height-r,n=t.left+t.width/2-i.width/2;break;case"right":o=t.top+t.height/2-i.height/2,n=t.right+r;break;case"left":o=t.top+t.height/2-i.height/2,n=t.left-i.width-r;break;default:o=t.bottom+r,n=t.left+t.width/2-i.width/2;break}this.chibiGroup.style.top=`${o}px`,this.chibiGroup.style.left=`${n}px`,this.chibiGroup.style.transform=""}#e(t){if(!t){this.overlays.top.style.cssText="width: 100%; height: 100%;",this.overlays.bottom.style.cssText="width: 0; height: 0;",this.overlays.left.style.cssText="width: 0; height: 0;",this.overlays.right.style.cssText="width: 0; height: 0;";return}this.overlays.left.style.cssText=`top: 0; left: 0; width: ${t.left}px; height: 100%;`,this.overlays.right.style.cssText=`top: 0; left: ${t.right}px; width: calc(100% - ${t.right}px); height: 100%;`,this.overlays.top.style.cssText=`top: 0; left: ${t.left}px; width: ${t.width}px; height: ${t.top}px;`,this.overlays.bottom.style.cssText=`top: ${t.bottom}px; left: ${t.left}px; width: ${t.width}px; height: calc(100% - ${t.bottom}px);`}#r(){this.observers={targetObserver:new ResizeObserver(this.boundHandleHighlightUpdate),bodyObserver:new ResizeObserver(this.boundHandleHighlightUpdate),mutationObserver:new MutationObserver(this.boundHandleHighlightUpdate)},this.observers.bodyObserver&&this.observers.bodyObserver.observe(document.body),this.observers.mutationObserver&&this.observers.mutationObserver.observe(document.body,{attributes:!0,childList:!0,subtree:!0})}#o(){this.observers&&(this.observers.targetObserver&&this.observers.targetObserver.disconnect(),this.observers.bodyObserver&&this.observers.bodyObserver.disconnect(),this.observers.mutationObserver&&this.observers.mutationObserver.disconnect(),this.observers=null)}}export{a as C};

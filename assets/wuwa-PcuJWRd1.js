import{c as K,C as G,D as $,a as Q,r as X,b as Z,u as tt,g as et,d as at,e as nt,f as st,i as ot,h as rt,k as it,m as lt,l as ct,j as pt,n as E,o as x,s as D,A as m,p as ut}from"./solvers-RSv3tunr.js";/* empty css               */import{c as ht,W as ft,g as Ct,p as St,a as dt,b as bt,d as yt,e as mt,f as gt,h as H,i as P,j as wt,k as j,l as q}from"./cashback-helpers-qTMa8UWj.js";import{s as vt,m as Rt,a as kt}from"./make-distribution-arrays-Cl3ImG5G.js";const w=[.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.048,.088,.128,.168,.208,.288,.368,.448,.528,.608,.708,.828,.968,1],v=[.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.008,.048,.088,.128,.168,.208,.288,.368,.448,.528,.608,.708,.828,.968,1],R=[.06,.06,.06,.06,.06,.06,.06,.06,.06,1],C={maxCharacterConstelation:6,rateUpCharacterSR:3,rateUpWeaponSR:3,poolStandardCharSSR:5,poolCharSR:11,configSR:{maxType:7,regularPoints:.375,specialPoints:1},configSSR:{maxType:7,regularStandardPoints:5.625,regularPoints:1.875,specialStandardPoints:8.75,specialPoints:5},configWep:{pointsSR:.375,pointsSSR:1.875},paths:{char:["None","s0","s1","s2","s3","s4","s5","s6"],wep:["None","r1","r2","r3","r4","r5"]},pity:{pitySSRChar:w.length,pitySSRWep:v.length,pitySRChar:R.length,pitySRWep:R.length},default:0},Tt=[{value:"unknown",text:"Unknown"},{value:"none",text:"Not Owned"},{value:"s0",text:"S0"},{value:"s1",text:"S1"},{value:"s2",text:"S2"},{value:"s3",text:"S3"},{value:"s4",text:"S4"},{value:"s5",text:"S5"},{value:"s6",text:"S6"},{value:"new",text:"New Character"}],k={none:0,s0:1,s1:2,s2:3,s3:4,s4:5,s5:6,s6:7},Ut=[{type:"phase1",startDate:"2024-05-23T01:00:00+00:00",rateUpChars:new Set(["Chixia","Mortefi","Danjin"]),rateUpWeps:new Set(["Hollow Mirage","Variation","Dauntless Evernight"])},{type:"phase2",startDate:"2024-06-06",rateUpChars:new Set(["Aalto","Yuanwu","Taoqi"]),rateUpWeps:new Set(["Jinzhou Keeper","Cadenza","Lunar Cutter"])},{type:"phase1",startDate:"2024-06-28T01:00:00+00:00",rateUpChars:new Set(["Yangyang","Sanhua","Danjin"]),rateUpWeps:new Set(["Discord","Commando of Conviction","Amity Accord"])},{type:"phase2",startDate:"2024-07-22",rateUpChars:new Set(["Mortefi","Baizhi","Taoqi"]),rateUpWeps:new Set(["Comet Flare","Overture","Undying Flame"])},{type:"phase1",startDate:"2024-08-15T01:00:00+00:00",rateUpChars:new Set(["Chixia","Sanhua","Baizhi"]),rateUpWeps:new Set(["Jinzhou Keeper","Hollow Mirage","Dauntless Evernight"])},{type:"phase2",startDate:"2024-09-07",rateUpChars:new Set(["Aalto","Yuanwu","Danjin"]),rateUpWeps:new Set(["Novaburst","Helios Cleaver","Marcato"])},{type:"phase1",startDate:"2024-09-29T01:00:00+00:00",rateUpChars:new Set(["Yangyang","Chixia","Taoqi"]),rateUpWeps:new Set(["Endless Collapse","Comet Flare","Discord"])},{type:"phase2",startDate:"2024-10-24",rateUpChars:new Set(["Mortefi","Sanhua","Youhu"]),rateUpWeps:new Set(["Variation","Helios Cleaver","Celestial Spiral"])},{type:"phase1",startDate:"2024-11-14T01:00:00+00:00",rateUpChars:new Set(["Aalto","Yangyan","Danjin"]),rateUpWeps:new Set(["Fusion Accretion","Novaburst","Commando of Conviction"])},{type:"phase2",startDate:"2024-12-12",rateUpChars:new Set(["Yuanwu","Baizhi","Lumi"]),rateUpWeps:new Set(["Waning Redshift","Jinzhou Keeper","Hollow Mirage"])},{type:"phase1",startDate:"2025-01-02T01:00:00+00:00",rateUpChars:new Set(["Chixia","Mortefi","Sanhua"]),rateUpWeps:new Set(["Relativistic Jet","Fusion Accretion","Amity Accord"])},{type:"phase2",startDate:"2025-01-23",rateUpChars:new Set(["Yuanwu","Danjin","Youhu"]),rateUpWeps:new Set(["Celestial Spiral","Variation","Dauntless Evernight"])},{type:"phase1",startDate:"2025-02-13T01:00:00+00:00",rateUpChars:new Set(["Aalto","Chixia","Lumi"]),rateUpWeps:new Set(["Novaburst","Discord","Jinzhou Keeper"])},{type:"phase2",startDate:"2025-03-06",rateUpChars:new Set(["Mortefi","Taoqi","Youhu"]),rateUpWeps:new Set(["Waning Redshift","Marcato","Comet Flare"])},{type:"phase1",startDate:"2025-03-27T01:00:00+00:00",rateUpChars:new Set(["Yuanwu","Chixia","Danjin"]),rateUpWeps:new Set(["Fusion Accretion","Cadenza","Lunar Cutter"])},{type:"phase2",startDate:"2025-04-17",rateUpChars:new Set(["Aalto","Sanhua","Baizhi"]),rateUpWeps:new Set(["Endless Collapse","Undying Flame","Comet Flare"])},{type:"phase1",startDate:"2025-04-29T01:00:00+00:00",rateUpChars:new Set(["Yuanwu","Taoqi","Lumi"]),rateUpWeps:new Set(["Overture","Hollow Mirage","Dauntless Evernight"])},{type:"phase2",startDate:"2025-05-22",rateUpChars:new Set(["Yangyang","Mortefi","Danjin"]),rateUpWeps:new Set(["Relativistic Jet","Undying Flame","Variation"])},{type:"phase1",startDate:"2025-06-12T01:00:00+00:00",rateUpChars:new Set(["Aalto","Baizhi","Youhu"]),rateUpWeps:new Set(["Endless Collapse","Marcato","Amity Accord"])},{type:"phase2",startDate:"2025-07-03",rateUpChars:new Set(["Chixia","Sanhua","Taoqi"]),rateUpWeps:new Set(["Helios Cleaver","Commando of Conviction","Jinzhou Keeper"])},{type:"phase1",startDate:"2025-07-24T01:00:00+00:00",rateUpChars:new Set(["Yuanwu","Taoqi","Lumi"]),rateUpWeps:new Set(["Celestial Spiral","Lunar Cutter","Jinzhou Keeper"])},{type:"phase2",startDate:"2025-08-14",rateUpChars:new Set(["Yangyang","Mortefi","Danjin"]),rateUpWeps:new Set(["Novaburst","Overture","Variation"])},{type:"phase1",startDate:"2025-08-28T01:00:00+00:00",rateUpChars:new Set(["Yuanwu","Chixia","Youhu"]),rateUpWeps:new Set(["Waning Redshift","Undying Flame","Comet Flare"])},{type:"phase2",startDate:"2025-09-17",rateUpChars:new Set(["Aalto","Baizhi","Taoqi"]),rateUpWeps:new Set(["Relativistic Jet","Fusion Accretion","Celestial Spiral"])},{type:"phase1",startDate:"2025-10-09T01:00:00+00:00",rateUpChars:new Set(["Mortefi","Sanhua","Lumi"]),rateUpWeps:new Set(["Fusion Accretion","Novaburst","Helios Cleaver"])},{type:"phase2",startDate:"2025-10-30",rateUpChars:new Set(["Yangyang","Danjin","Taoqi"]),rateUpWeps:new Set(["Endless Collapse","Hollow Mirage","Dauntless Evernight"])}],V=new Set(["Jianxin","Calcharo","Encore","Lingyang","Verina"]);function At(t){const n={9:"asia",8:"asia",7:"asia",6:"europe",5:"america"};if(!t.playerId||!t.pulls)throw new Error("Imported data is missing key wuwatracker.com properties.");const a=t.playerId,e=n[a[0]],s=Ut;Et(s,e);const o=L(t.pulls,"character",s),i=L(t.pulls,"weapon",s),l=[{banner:"character",...o},{banner:"weapon",...i}],c=Dt(t.pulls);return{pity:l,constellation:c}}function L(t,n,a){let e=0,s=0,o=!1,i=!1,l=!1,c=!1;for(let p=0;p<t.length;p++){const r=t[p],u=r.name,h=r.qualityLevel,f=r.time,S=r.cardPoolType;let d;if(n==="character"?d=1:d=2,S===d&&(h===5?(l||(o=W(u,h,n,f,a)),c||s++,l=!0,c=!0):h===4?(l||e++,c||(i=W(u,h,n,f,a)),c=!0):h===3?(l||e++,c||s++):console.error("Unknown rarity"),l&&c))break}return{pity4:String(s),pity5:String(e),guarantee4:i,guarantee5:o}}function W(t,n,a,e,s){let o=!1;return n===5?a==="character"&&(o=V.has(t)):o=!xt(s,e,a).has(t),o}function Et(t,n){let a;if(n==="asia")a="T02:00:00+00:00";else if(n==="europe")a="T09:00:00+00:00";else if(n==="america")a="T15:00:00+00:00";else throw new Error(`Unknown timezone: ${n}`);for(let e of t)e.type==="phase2"&&(e.startDate+=a)}function xt(t,n,a){for(let e=t.length-1;e>=0;e--)if(n>t[e].startDate)return a==="character"?t[e].rateUpChars:t[e].rateUpWeps}function Dt(t){const n=new Array(Object.keys(k).length).fill(0),a=new Array(Object.keys(k).length).fill(0),e=new Map,s=new Map;for(let p of t){const r=p.resourceId.toString().length===4,u=p.qualityLevel,h=p.name;r&&(u===5&&V.has(h)?s.set(h,(s.get(h)||0)+1):u===4&&e.set(h,(e.get(h)||0)+1))}for(const p of e.values()){const r=n.length-1;p>=r?n[r]++:n[p]++}for(const p of s.values()){const r=a.length-1;p>=r?a[r]++:a[p]++}const o=C.poolCharSR,i=C.poolStandardCharSSR,l=o-e.size,c=i-s.size;return n[0]=Math.max(0,l),a[0]=Math.max(0,c),{0:a.map(String),1:n.map(String)}}const Pt=`
    <div class="chibi-group">
        <div class="bubble-wrapper bubble-wrapper--big">
            <svg class="bubble-svg-background" viewBox="0 0 1820 858" xmlns="http://www.w3.org/2000/svg">
                <path style="fill:#232338; stroke:#0b091b; stroke-width: 1px"
                    d="M 787.500 1.005 C 640.632 4.659, 524.925 15.685, 414 36.596 C 305.731 57.006, 229.612 80.375, 165.037 113.026 C 88.008 151.975, 38.939 199.840, 15.519 258.874 C 8.496 276.575, 3.327 301.798, 0.941 330 C -2.027 365.084, 6.008 405.046, 22.959 439.500 C 43.249 480.744, 73.516 513.346, 120 544.028 C 209.228 602.924, 363.734 646.238, 553 665.416 C 650.260 675.270, 808.209 681.908, 948.500 682.035 C 999.011 682.081, 1061.358 683.505, 1068.623 684.778 C 1072.726 685.497, 1072.776 685.559, 1079.177 698 C 1096.318 731.313, 1116.859 760.237, 1136.746 779.061 C 1155.047 796.384, 1181.968 815.466, 1202.839 825.908 C 1232.446 840.721, 1273.797 852.517, 1310.770 856.698 C 1324.340 858.232, 1326.511 858.262, 1330.270 856.962 C 1332.596 856.158, 1334.500 855.138, 1334.500 854.696 C 1334.500 854.254, 1331.125 852.760, 1327 851.377 C 1314.484 847.179, 1287.809 833.665, 1277.295 826.195 C 1265.925 818.116, 1226.275 778.561, 1216.635 765.680 C 1206.358 751.947, 1188.566 715.606, 1185.906 702.916 C 1185.282 699.937, 1183.944 693.900, 1182.931 689.500 C 1181.919 685.100, 1180.809 679.883, 1180.464 677.906 L 1179.836 674.312 1189.168 673.673 C 1234.976 670.533, 1307.910 662.018, 1358.500 653.902 C 1387.862 649.192, 1405.290 645.828, 1437.500 638.654 C 1443.550 637.306, 1457.500 634.310, 1468.500 631.995 C 1491.435 627.169, 1506.239 623.528, 1520.500 619.205 C 1526 617.538, 1538.150 614.072, 1547.500 611.504 C 1604.081 595.961, 1658.813 573.047, 1691.807 551.088 C 1716.705 534.517, 1726.861 526.038, 1752.999 500 C 1782.013 471.097, 1799.115 442.990, 1810.458 405.568 C 1814.346 392.741, 1819 366.582, 1819 357.554 C 1819 354.499, 1819.450 352, 1820 352 C 1821.274 352, 1821.299 340.366, 1820.046 330.791 C 1819.521 326.781, 1818.582 319.225, 1817.959 314 C 1809.521 243.236, 1771.421 185.672, 1703 140.314 C 1640.860 99.120, 1548.917 64.910, 1443 43.576 C 1339.978 22.824, 1215.062 9.498, 1072 3.996 C 994.931 1.032, 848.352 -0.509, 787.500 1.005 M 776 4.600 C 771.325 4.777, 754 5.405, 737.500 5.995 C 561.542 12.295, 402.823 35.450, 277.947 73.040 C 210.624 93.305, 153.205 120.092, 109 151.857 C 80.401 172.408, 53.246 200.489, 37.044 226.269 C 19.796 253.711, 10.505 280.375, 6.026 315.288 C 1.913 347.340, 4.080 374.322, 13.106 403.467 C 26.641 447.170, 50.753 482.527, 90 516.224 C 101.716 526.283, 126.303 543.639, 138.425 550.406 C 140.926 551.802, 146.466 554.925, 150.736 557.345 C 194.368 582.071, 259.942 606.163, 334.540 624.875 C 473.407 659.708, 622.538 674.025, 888 678.008 C 1034.249 680.203, 1070.594 680.938, 1073.423 681.757 C 1075.031 682.222, 1076.681 683.255, 1077.088 684.051 C 1077.496 684.848, 1079.729 689.325, 1082.051 694 C 1091.185 712.393, 1108.924 740.328, 1121.008 755.350 C 1129.418 765.805, 1144.301 780.492, 1156.104 789.986 C 1170.999 801.967, 1195.222 817.726, 1208.500 824.072 C 1231.867 835.241, 1272.170 847.555, 1298 851.418 C 1323.491 855.230, 1327.055 855.493, 1319.528 853.009 C 1311.535 850.371, 1284.081 836.370, 1276.055 830.838 C 1260.944 820.423, 1225.667 785.179, 1211.929 766.772 C 1201.655 753.007, 1184.830 717.485, 1182.499 704.638 C 1181.787 700.712, 1180.261 693.675, 1179.109 689 C 1176.730 679.347, 1176.376 672.148, 1178.250 671.514 C 1178.938 671.282, 1190.300 670.164, 1203.500 669.029 C 1239.066 665.973, 1275.315 662.018, 1309.500 657.465 C 1360.426 650.682, 1388.027 645.725, 1449 632.411 C 1463.025 629.349, 1479.778 625.754, 1486.229 624.424 C 1492.681 623.093, 1501.906 620.694, 1506.729 619.093 C 1511.553 617.492, 1527.169 612.983, 1541.432 609.074 C 1573.458 600.295, 1586.835 595.827, 1618.030 583.493 C 1644.114 573.179, 1671.994 559.215, 1688.966 547.965 C 1703.153 538.560, 1722.730 523.374, 1729.500 516.522 C 1732.800 513.182, 1739.501 506.636, 1744.391 501.975 C 1758.521 488.506, 1771.430 473.645, 1779.115 462 C 1788.491 447.791, 1793.962 437.449, 1800.288 421.977 C 1815.087 385.778, 1819.761 344.986, 1813.433 307.269 C 1804.545 254.291, 1779.063 209.320, 1736.709 171.866 C 1691.153 131.580, 1625.043 98.185, 1538.202 71.592 C 1418.757 35.015, 1261.222 14.066, 1048 6.407 C 1008.502 4.988, 802.012 3.616, 776 4.600 M 0.355 344.500 C 0.352 349.450, 0.521 351.601, 0.731 349.280 C 0.940 346.959, 0.943 342.909, 0.736 340.280 C 0.530 337.651, 0.358 339.550, 0.355 344.500" />
                </svg>
            <div class="bubble-text"> </div>
        <img src="/images/37_chibi.png" alt="Tutorial Assistant" class="tutorial-chibi">
        </div>
        <button class="btn btn--tutorial_next">>></button>
        <button class="btn btn--tutorial_end">x</button>
    </div>`,I=[{text:"<p>Welcome to the Gacha Calculator! Let me show you around.</p>",size:"small"},{id:"pity-input-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#pity-panel"]',text:"<p>First, input your current pity and guarantees here. You can import data from wuwatracker.com directly(press ? near respective elements to learn more)</p>",position:"right"},{id:"pull-plan-step",element:".pull-plan-section",text:"<p>Next, build your pull plan here. Add all the characters and weapons in the order you plan to obtain them.</p>",position:"bottom"},{id:"target-step",element:".header-controls",text:"<p>Now, set your target. This can be your desired confidence level(e.g., a 70% chance of getting all planned items) or your total pull budget.</p>",position:"top",chibiSide:"left",size:"big"},{id:"calculate-button-step",element:"#calculate-btn",text:"<p>Once your plan and target are set, click <strong>Calculate</strong> and I will calculate everything for you.</p>",position:"right",size:"small"},{element:".chart-wrapper",text:"<p>You'll get a chart showing the probability of success for each number of pulls until 100%.</p>",position:"top"},{id:"constellation-input-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#constellation-panel"]',text:"<p>Input how many Standard 5* and non-standard 4* characters you have at each constellation level. This information is necessary for accurate cashback predictions, you can skip it if you don't need it.</p>",position:"right",size:"big"},{id:"rate-ups-step",element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#rateup-panel"]',text:"<p>If you know the rate-up 4-star characters, you can input their constellations on your account. This improves cashback accuracy and reduces unnecessary computation.</p>",position:"right",size:"huge"},{element:"#probability-table",text:"<p>And down here, you can see a detailed table with cashback estimates, for the given amount of pulls, it's only accurate if you inputed your data correctly.</p>",position:"top"}],O={"pity-input-step":{tourStepId:"pity-input-step"},"constellation-input-step":{tourStepId:"constellation-input-step"},"pull-plan-step":{tourStepId:"pull-plan-step"},"calculate-button-step":{tourStepId:"calculate-button-step"},"import-help":{element:".tab-panel-card",text:'<p>You can import your data directly from <a href="https://wuwatracker.com/" target="_blank" rel="noopener noreferrer" class="soft-link">wuwatracker.com/</a>. Click the "Import Data" button and paste the exported JSON data.</p>',position:"right"},"export-help":{element:".tab-panel-card",text:"<p>You can export your data as a JSON file to make backup or to carry over data when you are switching to a different browser/new device.</p>",position:"right",size:"big"},"pity-help":{element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#pity-panel"]',text:"<p>You can input your current pity and guarantees here, as well as Capturing Radiance and Epitomized Path points. You can import data from paimon.moe directly.</p>",position:"right",size:"big"},"constelation-help":{element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#constellation-panel"]',text:"<p>Input how many Standard 5* and non-standard 4* characters you have at each constellation level. This information is necessary for accurate cashback predictions.</p>",position:"right",size:"big"},"rate-up-help":{element:".tab-panel-card",clickTab:'.tab-link[data-tab-target="#rateup-panel"]',text:"<p>If you know the featured 4*, you can then check what constellation it has on your account. This improves cashback accuracy and reduces unnecessary computation.</p>",position:"right",size:"huge"},"pull-plan-help":{element:".pull-plan-section",text:"<p>Build your pull plan here. Add all the characters and weapons in order you want to get them.</p>",position:"bottom"},"target-help":{element:".header-controls",text:"<p>Set your target here: either your desired confidence level(e.g., 70% chance of getting all planned items) or your total pull budget.</p>",position:"top",chibiSide:"left",size:"big"},"cashback-help":{element:"#probability-table",text:"<p>Expected cashback for each 5* target reached with their respective probabilities, percentiles give you a reasonable range by cutting off extreme results(10% from each side).</p>",size:"big",chibiSide:"left",position:"top"}},z={CHARACTER:"character",WEAPON:"weapon"},y={PITY_ROW:"[data-banner]",CONSTELLATION_ROW:"[data-rarity]",PITY_TABLE:"#pity-table",CONSTELLATION_TABLE:"#constellation-table"},B={pitySettings:{[z.CHARACTER]:{pity4:0,pity5:0},[z.WEAPON]:{pity4:0,pity5:0}},isCharacter:!0,isWeapon:!0,isSpecial:!1,constellationColumns:8},N={probability:70,pulls:99};class Lt{constructor(n){this.parts=n,this.persistence=K("wuwa",y);const a=ht({cashbackCalculator:this.parts.cashbackFn,uiUpdater:this.parts.updateTableFn});this.tutorial=new G(Pt);const e={getPageConfiguration:st,getLabels:nt,getPullPlan:at,getTarget:et,updateChart:tt,convertToChartData:Z,recalcInputs:X,calculatorFunction:this.parts.runCalcFn,calculatorConfig:{gachaConfig:this.parts.gachaConfig,CONSTELLATION_MAP:this.parts.CONSTELLATION_MAP},pageConfig:{SELECTORS:y,INITIAL_CONFIG:B},postCalculationHooks:[a],persistence:this.persistence,chibi:this.tutorial};this.validator=new $(this.parts.CONSTELLATION_MAP),this.calculationHandler=new Q(e),this.calculateBtn=document.getElementById("calculate-btn"),this.exportBtn=document.getElementById("export-btn"),this.startTourBtn=document.getElementById("start-tour-btn"),this.toggleButtonsBtn=document.getElementById("toggle-buttons-btn")}initialize(){this.validator.initialize(),ot(this.persistence,this.parts.gachaConfig,this.validator,B,Tt,y),rt(),it(this.persistence),this.#t(),this.#a(),this.tutorial.showTutorialIfNeeded(I)}#t(){lt(),this.calculateBtn&&this.calculateBtn.addEventListener("click",async()=>{this.#e()&&await this.calculationHandler.runCalculation()}),this.exportBtn&&this.exportBtn.addEventListener("click",()=>ct(this.persistence)),this.startTourBtn&&this.startTourBtn.addEventListener("click",()=>{this.tutorial.startTour(I)}),pt(this.persistence,At,this.validator,y,this.tutorial),document.querySelectorAll(".help-btn").forEach(a=>{a.addEventListener("click",e=>{e.preventDefault();const s=a.getAttribute("data-help-key")||a.getAttribute("data-tour-step-id");if(s&&O[s]){const o=O[s];this.tutorial.showHelp(o,a)}else console.warn(`ChibiTutorial: No help configuration found for key '${s}'.`,a)})}),this.toggleButtonsBtn&&this.toggleButtonsBtn.addEventListener("click",()=>{document.querySelectorAll(".help-btn").forEach(e=>{e.classList.toggle("hidden")}),this.persistence.saveButtons()})}#e(){if(document.querySelectorAll(".is-invalid").forEach(s=>s.classList.remove("is-invalid")),this.validator.isDataValid())return!0;console.warn("Validation failed. Calculation blocked."),this.validator.validateAll();const n=document.querySelectorAll(".is-invalid"),a=new Set;n.forEach(s=>{const o=s.closest(".tab-pane");if(o){const i=document.querySelector(`.tab-link[data-tab-target="#${o.id}"]`);i&&a.add(i)}s.classList.add("flicker"),s.addEventListener("animationend",()=>s.classList.remove("flicker"),{once:!0})}),a.forEach(s=>{s.classList.add("is-invalid","flicker"),s.addEventListener("animationend",()=>s.classList.remove("flicker"),{once:!0})});const e=Array.from(a)[0];return e&&e.click(),setTimeout(()=>{n[0]?.scrollIntoView({behavior:"smooth",block:"center"})},100),!1}#a(){const n=this.persistence.loadCalculation(),a=n?n.input:null;n?(E(this.parts.gachaConfig.paths,a),x(N,n),D(n.persistInput)):(E(this.parts.gachaConfig.paths),x(N),D()),this.calculationHandler.runCalculation()}}function Wt(t){const n=new Array(t.length);for(let a=0;a<t.length;a++){let e=0;const s=t[a].states;for(let o=0;o<s.length;o++){const i=s[o];for(const l of i.values())e+=l.prob}n[a]=e}return n}function It(t){const n=new Array(t.length);for(let a=0;a<t.length;a++){let e=0;const s=t[a].states;for(let o=0;o<s.length;o++)e+=s[o];n[a]=e}return n}function Ot(t){let a=0;for(let e=0,s=t.length;e<s;e++){const o=t[e].states;for(let i=0,l=o.length;i<l;i++)o[i]>0&&o[i]<=1e-10&&(a+=o[i],o[i]=0)}if(a>0){const e=1/(1-a);for(let s=0,o=t.length;s<o;s++){const i=t[s].states;for(let l=0,c=i.length;l<c;l++)i[l]!=0&&(i[l]*=e)}}}function zt(t,n){let a=!0;if(n)for(let e=0;e<t.length-1;e++){let s=!0;for(const o of t[e].states)o>0&&(s=!1,a=!1);t[e].isEmpty=s}else for(let e=0;e<t.length-1;e++){let s=!0;for(const o of t[e].states)o.size>0&&(s=!1,a=!1);t[e].isEmpty=s}return a}function Bt(t){const n=[];for(let e=0;e<t.length;e++){const s=t[e].states;let o="None";e>0&&e<=t.length&&t[e-1]&&(o=t[e-1].type||"None");let i={offRates:new Map,type:o};for(const l of s)l.size>0&&a(i.offRates,l);n.push(i)}return n;function a(e,s){for(const[o,i]of s)e.has(o)?e.get(o).prob+=i.prob:e.set(o,{...i})}}function Nt(t){for(let n=0;n<t.length;n++){const a=t[n].states;for(let e=0;e<a.length;e++){const s=a[e];let o=0;for(const i of s.values())o+=i.prob;a[e]=o}}}const g=1e-10;function Mt(t,n,a,e,s,o){const i=t.length-2;for(let l=i;l>=0;l--){const c=t[l],p=o[l+1];if(!c.isEmpty)if(c.type==="Character")M(n,l,t,e,c.type,p);else if(c.type==="Weapon")M(a,l,t,s,c.type,p);else throw new Error(`Unknown SSR array type: ${c.type}`)}}function M(t,n,a,e,s,o){const i=a[n].states.length;let l=.5;const c=a[n].states,p=a[n+1].states;for(let r=i-1;r>=0;r--){const u=c[r];let h,f;s==="Weapon"?(h=!0,f=t[r]):(h=r>=e,f=t[r-e*h]);const S=u*f,d=u-S;let b=S;if(b>g&&(h||(b*=l),p[o]+=b),!h){let A=S*(1-l);A>g&&(c[e]+=A)}let U=d;U>g&&(c[r+1]+=U),c[r]=0}}const _t={pullLogic:"wuwa",helpers:"wuwa"},_=C.pity.pitySSRChar,F=C.pity.pitySSRWep,Ft=C.pity.pitySRChar,Y={CHARACTER:C.pity.pitySSRChar*2,WEAPON:C.pity.pitySSRWep,SR:C.pity.pitySRChar*2},Yt={distributionArrays:{makeSSR:(t,n)=>kt(t,n,Y),makeSR:t=>Rt(t,Y),sortPity:t=>vt(t,C.pity)},pullLogic:{rankUpSSRCheap:(t,n)=>Mt(t,w,v,_,F,n)},workerManager:new ft,contexts:{contextSSR:{ODDS_CHARACTER_SSR:w,ODDS_WEAPON_SSR:v,SSR_CHAR_PITY:_,SSR_WEP_PITY:F},contextSR:{ODDS_SR:R,SR_PITY:Ft},moduleType:_t},helpers:{consolidateDistributionForCashback:Bt,consolidateProbabilitiesCheap:It,consolidateProbabilities:Wt,simplifyDistribution:Nt,normalizeCheap:Ot,checkIsEmpty:zt}};function Ht(t,n){return new Ct(C,Yt).runGachaCalculation(t,n)}const J=.5,T=1e-8;function jt(t,n,a,e,s,o,i){a=qt(a),o=St(t.SR.consCount,o,i);const l=dt(t.SR.consCount,n.rateUpCharacterSR,o);bt(l,t.SR.consCount,o);const c=Vt(a,n.poolStandardCharSSR,t.SSR.consCountStandard,t.SSR.cashbackRoadmap,n),p=Jt(l,e,s,n,t),r=c;for(let u=0;u<r.length;u++)r[u].mean+=p.mean,r[u].variance+=p.variance,r[u]=yt(r[u]);return r}function qt(t){let n=0;for(const a of t)for(const[e,s]of a.offRates)n+=s.prob;for(const a of t)for(const[e,s]of a.offRates)s.prob/=n;return t}function Vt(t,n,a,e,s){const{combos:o,maxOffRateCount:i}=mt(t,T),l=[0];let c=0;for(let r=0;r<t.length;r++)e[r-1]==="none"?l.push(c):e[r-1]==="regular"&&(c+=s.configSSR.regularPoints,l.push(c));const p=Array.from({length:t.length},()=>[]);for(const r of o){const u=r.rateUpCount,h=r.probability,f={maxType:7,regularPoints:s.configSSR.regularStandardPoints,specialPoints:s.configSSR.specialStandardPoints},d=new m(a,n,f).runSteps(i),b=gt(r,l,d,s.configWep.pointsSSR);p[u].push({cashback:b,probability:h})}for(let r=0;r<p.length;r++){const u=$t(p[r]);p[r]=H(u)}return p}function Jt(t,n,a,e,s){const{combos:o,maxOffRateCount:i}=P(n,T),{combos:l,maxOffRateCount:c}=P(a,T),p=Kt(t,o,i,e),r=Gt(l,c,e,s);return wt(p,r)}function Kt(t,n,a,e){const s=Math.max(...n.map(i=>i.rateUpCount)),o=[];for(const{rateUps:i,offRates:l,probability:c}of t){const r=new m(i,e.rateUpCharacterSR,e.configSR).runSteps(s),h=new m(l,e.poolCharSR-e.rateUpCharacterSR,e.configSR).runSteps(a),f=j(a,h,e.configWep.pointsSR,J),S=q(n,r,f);o.push({probability:c,cashback:S})}return H(o)}function Gt(t,n,a,e){const s=Math.max(...t.map(r=>r.rateUpCount)),o=p(s,a.configWep.pointsSR),l=new m(e.SR.consCount,a.poolCharSR,a.configSR).runSteps(n),c=j(n,l,a.configWep.pointsSR,J);return q(t,o,c);function p(r,u){return Array.from({length:r+1},(h,f)=>({mean:f*u,variance:0}))}}function $t(t){let n=0;for(const a of t)n+=a.probability;for(const a of t)a.probability/=n;return t}document.addEventListener("DOMContentLoaded",()=>{const t={gachaConfig:C,CONSTELLATION_MAP:k,runCalcFn:Ht,cashbackFn:jt,updateTableFn:ut};new Lt(t).initialize()});

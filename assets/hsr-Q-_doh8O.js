import{e as k,f as y,T as A,h as E,i as L,j as D,l as I,k as O,m as C,n as R,s as f,u as B,q as N}from"./cashback-D3emIPJs.js";/* empty css               */import{C as H,c as w,g as W}from"./genshin_tutorial_config-CLPEu1zz.js";import{s as _,m as F,a as x,r as z,b as m}from"./pullLogic-C2ZBZaH4.js";import{a as o,c as U,s as M}from"./commonHelpers-BPDag3E6.js";class V{constructor(t){this.parts=t,this.persistence=k("hsr");const i=y({cashbackCalculator:this.parts.cashbackFn,uiUpdater:this.parts.updateTableFn}),e={calculatorFunction:this.parts.runCalcFn,calculatorConfig:{gachaConfig:this.parts.gachaConfig,CONSTELLATION_MAP:this.parts.CONSTELLATION_MAP},postCalculationHooks:[i]};this.validator=new A(this.parts.CONSTELLATION_MAP),this.calculationHandler=E(e,this.persistence),this.calculateBtn=document.getElementById("calculate-btn"),this.exportBtn=document.getElementById("export-btn"),this.startTourBtn=document.getElementById("start-tour-btn"),this.tutorial=new H(w)}initialize(){this.validator.initialize(),L(this.persistence,this.parts.gachaConfig,this.validator),D(),this.#t(),this.#i()}#t(){if(!this.calculateBtn){console.error("Calculate button not found!");return}this.calculateBtn.addEventListener("click",()=>{this.#a()&&this.calculationHandler()}),this.exportBtn&&this.exportBtn.addEventListener("click",()=>I(this.persistence)),this.startTourBtn&&this.startTourBtn.addEventListener("click",()=>{this.tutorial.startTour(W)}),O(this.persistence,null,this.validator)}#a(){if(document.querySelectorAll(".is-invalid").forEach(a=>a.classList.remove("is-invalid")),this.validator.isDataValid())return!0;console.warn("Validation failed. Calculation blocked."),this.validator.validateAll();const t=document.querySelectorAll(".is-invalid"),i=new Set;t.forEach(a=>{const n=a.closest(".tab-pane");if(n){const r=document.querySelector(`.tab-link[data-tab-target="#${n.id}"]`);r&&i.add(r)}a.classList.add("flicker"),a.addEventListener("animationend",()=>a.classList.remove("flicker"),{once:!0})}),i.forEach(a=>{a.classList.add("is-invalid","flicker"),a.addEventListener("animationend",()=>a.classList.remove("flicker"),{once:!0})});const e=Array.from(i)[0];return e&&e.click(),setTimeout(()=>{t[0]?.scrollIntoView({behavior:"smooth",block:"center"})},100),!1}#i(){const t=this.persistence.loadCalculation(),i=t?t.input:null;t?(C(this.parts.gachaConfig.paths,i),R(t),f(t.persistInput)):(C(this.parts.gachaConfig.paths),R(),f()),this.calculationHandler()}}const g=[.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.066,.126,.186,.246,.306,.366,.426,.486,.546,.606,.666,.726,.786,.846,.906,.966,1],T=[.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.077,.147,.217,.287,.357,.427,.497,.567,.637,.707,.777,.847,.917,.987,1],c=[.051,.051,.051,.051,.051,.051,.051,.051,.561,1],l={maxCharacterConstelation:6,rateUpCharacterSR:3,rateUpWeaponSR:3,poolStandardCharSSR:7,poolCharSR:23,configSR:{maxType:7,regularPoints:.4,specialPoints:1},configSSR:{maxType:7,regularPoints:2,specialPoints:5},configWep:{pointsSR:.4,pointsSSR:2},paths:{char:["None","e0","e1","e2","e3","e4","e5","e6"],wep:["None","s1","s2","s3","s4","s5"]},pity:{pitySSRChar:g.length,pitySSRWep:T.length,pitySRChar:c.length,pitySRWep:c.length},default:0},q={none:0,e0:1,e1:2,e2:3,e3:4,e4:5,e5:6,e6:7};function G(s){const t={CHARACTER:l.pity.pitySSRChar*2+1,WEAPON:l.pity.pitySSRWep*2+1,SR:l.pity.pitySRChar*2+1,FINAL:1},i=_(s,t);let e={char:{},wep:{}};const{distributionSSR:a}=F(s,i,t),{distributionCharSR:n,distributionWepSR:r}=x(s,t);let h=[],u=[],p=[],d=0;for(;d<.999;){z(a,g,T,i,s.SSR.pullPlan,e,t),m(e.char,n,c,t),m(e.wep,r,c,t);let b=0;for(let v of a[a.length-1])b+=v.totalSum;d=b,h.push(o(a)),u.push(o(r)),p.push(o(n))}const P=o(n);let S=U(P);return S=M(S,l.rateUpCharacterSR),{SSR:h,WepSR:u,CharSR:p}}document.addEventListener("DOMContentLoaded",()=>{const s={gachaConfig:l,CONSTELLATION_MAP:q,runCalcFn:G,cashbackFn:N,updateTableFn:B};new V(s).initialize()});

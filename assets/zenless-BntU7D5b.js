import{e as b,f as R,T as f,h as y,i as g,j as k,l as T,k as P,m as h,n as u,s as d,u as A,q as v}from"./cashback-dbOUira0.js";/* empty css               */import{W as E,g as L}from"./WorkerManager-BG9FWqhX.js";import{c as I,n as D,s as _,a as z,b as O,d as N,r as x,e as W,m as H,f as w}from"./commonPullLogic-YZi-tjpG.js";class F{constructor(t){this.parts=t,this.persistence=b("zzz");const s=R({cashbackCalculator:this.parts.cashbackFn,uiUpdater:this.parts.updateTableFn}),n={calculatorFunction:this.parts.runCalcFn,calculatorConfig:{gachaConfig:this.parts.gachaConfig,CONSTELLATION_MAP:this.parts.CONSTELLATION_MAP},postCalculationHooks:[s]};this.validator=new f(this.parts.CONSTELLATION_MAP),this.calculationHandler=y(n,this.persistence),this.calculateBtn=document.getElementById("calculate-btn"),this.exportBtn=document.getElementById("export-btn")}initialize(){this.validator.initialize(),g(this.persistence,this.parts.gachaConfig,this.validator),k(),this.#t(),this.#i()}#t(){if(!this.calculateBtn){console.error("Calculate button not found!");return}this.calculateBtn.addEventListener("click",()=>{this.#a()&&this.calculationHandler()}),this.exportBtn&&this.exportBtn.addEventListener("click",()=>T(this.persistence)),P(this.persistence,null,this.validator)}#a(){if(document.querySelectorAll(".is-invalid").forEach(i=>i.classList.remove("is-invalid")),this.validator.isDataValid())return!0;console.warn("Validation failed. Calculation blocked."),this.validator.validateAll();const t=document.querySelectorAll(".is-invalid"),s=new Set;t.forEach(i=>{const c=i.closest(".tab-pane");if(c){const p=document.querySelector(`.tab-link[data-tab-target="#${c.id}"]`);p&&s.add(p)}i.classList.add("flicker"),i.addEventListener("animationend",()=>i.classList.remove("flicker"),{once:!0})}),s.forEach(i=>{i.classList.add("is-invalid","flicker"),i.addEventListener("animationend",()=>i.classList.remove("flicker"),{once:!0})});const n=Array.from(s)[0];return n&&n.click(),setTimeout(()=>{t[0]?.scrollIntoView({behavior:"smooth",block:"center"})},100),!1}#i(){const t=this.persistence.loadCalculation(),s=t?t.input:null;t?(h(this.parts.gachaConfig.paths,s),u(t),d(t.persistInput)):(h(this.parts.gachaConfig.paths),u(),d()),this.calculationHandler()}}const o=[.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.006,.066,.126,.186,.246,.306,.366,.426,.486,.546,.606,.666,.726,.786,.846,.906,.966,1],r=[.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.007,.077,.147,.217,.287,.357,.427,.497,.567,.637,.707,.777,.847,.917,.987,1],l=[.051,.051,.051,.051,.051,.051,.051,.051,.561,1],e={maxCharacterConstelation:6,rateUpCharacterSR:2,rateUpWeaponSR:2,poolStandardCharSSR:6,poolCharSR:11,configSR:{maxType:7,regularPoints:.4,specialPoints:1},configSSR:{maxType:7,regularPoints:2,specialPoints:5},configWep:{pointsSR:.4,pointsSSR:2},paths:{char:["None","m0","m1","m2","m3","m4","m5","m6"],wep:["None","r1","r2","r3","r4","r5"]},pity:{pitySSRChar:o.length,pitySSRWep:r.length,pitySRChar:l.length,pitySRWep:l.length},default:0},M={none:0,m0:1,m1:2,m2:3,m3:4,m4:5,m5:6,m6:7},B="common",S=e.pity.pitySSRChar,m=e.pity.pitySSRWep,U=e.pity.pitySRChar,C={CHARACTER:e.pity.pitySSRChar*2+1,WEAPON:e.pity.pitySSRWep*2+1,SR:e.pity.pitySRChar*2+1},Z={distributionArrays:{makeSSR:(a,t)=>w(a,t,C),makeSR:a=>H(a,C),sortPity:a=>W(a,e.pity)},pullLogic:{rankUpSSRCheap:(a,t)=>x(a,o,r,S,m,t)},workerManager:new E,contexts:{contextSSR:{ODDS_CHARACTER_SSR:o,ODDS_WEAPON_SSR:r,SSR_CHAR_PITY:S,SSR_WEP_PITY:m},contextSR:{ODDS_SR:l,SR_PITY:U},moduleType:B},helpers:{consolidateDistributionForCashback:N,consolidateProbabilitiesCheap:O,consolidateProbabilities:z,simplifyDistribution:_,normalizeCheap:D,checkIsEmpty:I}};function V(a,t){return new L(e,Z).runGachaCalculation(a,t)}document.addEventListener("DOMContentLoaded",()=>{const a={gachaConfig:e,CONSTELLATION_MAP:M,runCalcFn:V,cashbackFn:v,updateTableFn:A};new F(a).initialize()});
